<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom Chronicles</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --safe-bottom: env(safe-area-inset-bottom);
            --rarity-ur: #ff4500; --rarity-sr: #da70d6; --rarity-s: #ffd700; --rarity-r: #1e90ff; --rarity-c: #aaaaaa;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* í•˜ë‹¨ ì˜ë¦¼ ë°©ì§€ ë ˆì´ì•„ì›ƒ */
        header { padding: calc(env(safe-area-inset-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-weight: bold; }
        .visual-frame { width: 100%; height: 30vh; position: relative; background: #000; border-bottom: 3px solid var(--accent); overflow: hidden; }
        #ui-bg { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        #ui-char { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); height: 90%; z-index: 5; filter: drop-shadow(0 0 10px black); }

        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; color: #666; font-weight: bold; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        .content { flex: 1; overflow-y: auto; padding: 20px; padding-bottom: 40px; }
        .log-entry { margin-bottom: 10px; font-size: 14px; line-height: 1.6; border-left: 2px solid var(--border); padding-left: 10px; }

        /* í« ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .pet-item { background: #1c1c1a; padding: 12px; border-radius: 10px; margin-bottom: 8px; border: 1px solid #333; display: flex; align-items: center; gap: 10px; }
        .pet-item.selected { border-color: var(--accent); background: #262622; }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: #000; }

        /* í‘¸í„° ë° ë²„íŠ¼ (ì•ˆì „ ì˜ì—­ í™•ë³´) */
        footer { padding: 10px 15px calc(var(--safe-bottom) + 15px); background: var(--panel); border-top: 1px solid var(--border); z-index: 100; }
        .btn-stack { display: flex; flex-direction: column; gap: 8px; }
        .action-btn { background: #2a2a26; color: white; padding: 16px; border-radius: 12px; border: 1px solid #444; font-weight: bold; font-size: 15px; width: 100%; }
        .action-btn:active { background: var(--accent); color: #000; }
        .action-btn:disabled { opacity: 0.4; pointer-events: none; }

        /* ì˜¤ë²„ë ˆì´ ì°½ */
        .overlay { display: none; position: fixed; inset: 0; z-index: 1000; background: rgba(0,0,0,0.95); align-items: center; justify-content: center; padding: 20px; }
        .popup { background: #111; border: 2px solid var(--accent); border-radius: 20px; padding: 25px; width: 100%; max-width: 320px; text-align: center; }
        
        #origin-screen { position: fixed; inset: 0; z-index: 2000; background: var(--bg); padding: 20px; overflow-y: auto; display: block; }
        .race-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
    </style>
</head>
<body>

    <div id="origin-screen">
        <h2 style="text-align:center; color:var(--accent); margin-bottom:20px;">ëª¨í—˜ê°€ ë“±ë¡</h2>
        <div id="race-list"></div>
        <div id="reroll-box" style="display:none; background:#222; padding:15px; border-radius:12px; text-align:center;">
            <p id="temp-stats" style="margin-bottom:12px;"></p>
            <button class="action-btn" onclick="game.reroll()" style="margin-bottom:8px;">ğŸ² ë³´ë„ˆìŠ¤ ë¦¬ë¡¤ (50G)</button>
            <button class="action-btn" style="background:var(--accent); color:#000;" onclick="game.start()">ì„ íƒ ì™„ë£Œ</button>
        </div>
    </div>

    <div id="msg-overlay" class="overlay" onclick="this.style.display='none'">
        <div class="popup" onclick="event.stopPropagation()">
            <h3 id="msg-title" style="color:var(--accent); margin-bottom:10px;">ì•Œë¦¼</h3>
            <p id="msg-body" style="margin-bottom:20px; font-size:14px; color:#ccc;"></p>
            <button class="action-btn" onclick="document.getElementById('msg-overlay').style.display='none'">í™•ì¸</button>
        </div>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div><span id="ui-race" style="color:var(--accent)"></span> Lv.<span id="ui-lv">1</span></div>
            <div id="ui-day">Day 1 / 500</div>
        </header>

        <div class="visual-frame">
            <img id="ui-bg" src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000">
            <img id="ui-char" src="">
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" id="tab-l" onclick="game.tab('log')">EXPLORE</button>
            <button class="tab-btn" id="tab-s" onclick="game.tab('stat')">CHARACTER</button>
        </div>

        <div id="pane-log" class="content"></div>
        <div id="pane-stat" class="content" style="display:none;">
            <div id="stat-info" style="margin-bottom:15px; padding:15px; background:#222; border-radius:12px; font-size:13px; line-height:1.6;"></div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="color:var(--accent);">ë‚˜ì˜ í« (<span id="pet-cnt">0</span>)</h3>
                <button id="merge-btn" class="action-btn" style="width:auto; padding:5px 12px; font-size:12px;" onclick="game.merge()" disabled>í•©ì„±</button>
            </div>
            <div id="pet-list"></div>
        </div>

        <footer>
            <div id="action-area" class="btn-stack"></div>
        </footer>
    </div>

<script>
const IMGS = {
    forest: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000",
    village: "https://images.unsplash.com/photo-1506197603052-3cc9c3a201bd?q=80&w=1000",
    forge: "https://i.ibb.co/3sX8s8D/forge.png",
    battle: "https://images.unsplash.com/photo-1534447677768-be436bb09401?q=80&w=1000",
    races: {
        Orc: "https://i.ibb.co/vXy6p0v/golem-pixel.png",
        Halfling: "https://i.ibb.co/3W6f9fP/slime-pixel.png",
        Elf: "https://i.ibb.co/qY7v6p0/thief-pixel.png",
        Human: "https://i.ibb.co/vYm6p0v/hero-pixel.png",
        Beast: "https://i.ibb.co/6P0f9X8/lizard-pixel.png"
    }
};

const RACES = [
    { id:'Orc', name:'ì˜¤í¬', str:18, agi:5, int:2, luk:5, hp:160 },
    { id:'Halfling', name:'í•˜í”Œë§', str:4, agi:12, int:8, luk:16, hp:70 },
    { id:'Elf', name:'ì—˜í”„', str:6, agi:14, int:16, luk:4, hp:85 },
    { id:'Human', name:'ì¸ê°„', str:10, agi:10, int:10, luk:10, hp:100 },
    { id:'Beast', name:'ìˆ˜ì¸', str:13, agi:13, int:6, luk:8, hp:115 }
];

const PET_DB = [
    { name:"ì´ˆë³´ í–„ìŠ¤í„°", grade:"COMMON", bonus:{luk:2}, desc:"í–‰ìš´+2" },
    { name:"ëŒë©©ì´ ê³¨ë ˜", grade:"COMMON", bonus:{str:2}, desc:"ê·¼ë ¥+2" },
    { name:"ê¹œë¹¡ ë°•ì¥", grade:"COMMON", bonus:{agi:2}, desc:"ë¯¼ì²©+2" },
    { name:"ì§€ì‹ ë²„ì„¯", grade:"COMMON", bonus:{int:2}, desc:"ì§€ëŠ¥+2" },
    { name:"í‘¸ë¥¸ ìš”ì •", grade:"RARE", bonus:{hp:30, int:5}, desc:"HP+30, ì§€ëŠ¥+5" },
    { name:"ê°•ì²  ë©§ë¼ì§€", grade:"RARE", bonus:{str:8}, desc:"ê·¼ë ¥+8" },
    { name:"ë‚ ìŒ˜ ë‹¤ëŒì¥", grade:"RARE", bonus:{agi:8}, desc:"ë¯¼ì²©+8" },
    { name:"í–‰ìš´ì˜ ê³ ì–‘ì´", grade:"RARE", bonus:{luk:8}, desc:"í–‰ìš´+8" },
    { name:"ìˆ²ì˜ íŒŒìˆ˜ê¾¼", grade:"SUPER", bonus:{str:15, hp:50}, desc:"ê·¼ë ¥+15, HP+50" },
    { name:"ì§€í˜œë¡œìš´ ì˜¬ë¹¼ë¯¸", grade:"SUPER", bonus:{int:15, exp:1.2}, desc:"ì§€ëŠ¥+15, ê²½í—˜ì¹˜+20%" },
    { name:"ê·¸ë¦¼ì í‘œë²”", grade:"SUPER", bonus:{agi:15, luk:5}, desc:"ë¯¼ì²©+15, í–‰ìš´+5" },
    { name:"í™©ê¸ˆ ì•Œ", grade:"SUPER", bonus:{luk:20}, desc:"í–‰ìš´+20" },
    { name:"í™”ì—¼ ë“œë˜ê³¤", grade:"SUPER RARE", bonus:{str:30, hp:100}, desc:"ê·¼ë ¥+30, HP+100" },
    { name:"ì„œë¦¬ ëŠ‘ëŒ€", grade:"SUPER RARE", bonus:{agi:25, str:10}, desc:"ë¯¼ì²©+25, ê·¼ë ¥+10" },
    { name:"ê³ ëŒ€ ìœ ë ¹", grade:"SUPER RARE", bonus:{int:40}, desc:"ì§€ëŠ¥+40" },
    { name:"ë² í—¤ëª¨ìŠ¤", grade:"ULTRA RARE", bonus:{str:50, hp:200, all:10}, desc:"ì••ë„ì ì¸ íŒŒê´´ì‹ " },
    { name:"í”¼ë‹‰ìŠ¤", grade:"ULTRA RARE", bonus:{all:20, hp:100}, desc:"ë¶ˆì‚¬ì˜ ì˜ì›…" },
    { name:"ì‹œê°„ì˜ êµ°ì£¼", grade:"ULTRA RARE", bonus:{all:30}, desc:"ëª¨ë“  ëŠ¥ë ¥ì¹˜ +30" }
];

const game = {
    p: { race:null, day:1, lv:1, exp:0, gold:300, hp:100, maxHp:100, str:0, agi:0, int:0, luk:0, pets:[], bonus:{} },
    selected: [], mode: 'forest', forgeDone: false,

    init() {
        const list = document.getElementById('race-list');
        RACES.forEach(r => {
            const d = document.createElement('div'); d.className = 'race-card';
            d.innerHTML = `<img src="${IMGS.races[r.id]}" style="width:50px; height:50px; border-radius:8px;">
            <div><b>${r.name}</b><br><small>STR:${r.str} HP:${r.hp}</small></div>`;
            d.onclick = () => { this.p.race = r; this.reroll(); document.getElementById('reroll-box').style.display='block'; };
            list.appendChild(d);
        });
    },

    reroll() {
        if(this.p.gold < 50 && this.p.race) { this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
        if(this.p.race) this.p.gold -= 50;
        this.p.bonus = { str:rand(1,5), agi:rand(1,5), int:rand(1,5), luk:rand(1,5) };
        document.getElementById('temp-stats').innerHTML = `ë³´ë„ˆìŠ¤: STR+${this.p.bonus.str} AGI+${this.p.bonus.agi} INT+${this.p.bonus.int} LUK+${this.p.bonus.luk}`;
    },

    start() {
        const r = this.p.race; const b = this.p.bonus;
        this.p.str = r.str + b.str; this.p.agi = r.agi + b.agi; this.p.int = r.int + b.int; this.p.luk = r.luk + b.luk;
        this.p.hp = r.hp; this.p.maxHp = r.hp;
        document.getElementById('origin-screen').style.display='none';
        document.getElementById('game-ui').style.display='flex';
        document.getElementById('ui-race').innerText = r.name;
        document.getElementById('ui-char').src = IMGS.races[r.id];
        this.renderActions();
        this.log("ëª¨í—˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
    },

    tab(t) {
        document.getElementById('pane-log').style.display = t==='log'?'block':'none';
        document.getElementById('pane-stat').style.display = t==='stat'?'block':'none';
        document.getElementById('tab-l').className = t==='log'?'tab-btn active':'tab-btn';
        document.getElementById('tab-s').className = t==='stat'?'tab-btn active':'tab-btn';
        if(t==='stat') this.renderStats();
    },

    renderStats() {
        document.getElementById('stat-info').innerHTML = `â¤ï¸ HP: ${this.p.hp}/${this.p.maxHp} | ğŸ’° GOLD: ${this.p.gold}G<br>âš”ï¸ STR: ${this.p.str} | ğŸƒ AGI: ${this.p.agi} | ğŸ§  INT: ${this.p.int} | ğŸ€ LUK: ${this.p.luk}`;
        const list = document.getElementById('pet-list'); list.innerHTML = '';
        document.getElementById('pet-cnt').innerText = this.p.pets.length;
        this.p.pets.forEach((p, i) => {
            const d = document.createElement('div'); d.className = `pet-item ${this.selected.includes(i)?'selected':''}`;
            const color = `var(--rarity-${p.grade.toLowerCase().replace(' ','')})`;
            d.innerHTML = `<span class="badge" style="background:${color}">${p.grade}</span><div><b>${p.name}</b><br><small>${p.desc}</small></div>`;
            d.onclick = () => {
                if(this.selected.includes(i)) this.selected = this.selected.filter(x=>x!==i);
                else if(this.selected.length < 2) this.selected.push(i);
                document.getElementById('merge-btn').disabled = this.selected.length !== 2;
                this.renderStats();
            };
            list.appendChild(d);
        });
    },

    merge() {
        const p1 = this.p.pets[this.selected[0]], p2 = this.p.pets[this.selected[1]];
        this.selected.sort((a,b)=>b-a).forEach(i => this.p.pets.splice(i,1));
        this.selected = [];
        const grades = ["COMMON","RARE","SUPER","SUPER RARE","ULTRA RARE"];
        const nextGrade = grades[Math.min(4, Math.max(grades.indexOf(p1.grade), grades.indexOf(p2.grade)) + (Math.random()<0.4?1:0))];
        const res = PET_DB.filter(x=>x.grade===nextGrade)[rand(0, PET_DB.filter(x=>x.grade===nextGrade).length-1)];
        this.p.pets.push(res); this.apply(res);
        this.pop("í•©ì„± ê²°ê³¼", `${res.name}(${res.grade})ë¥¼ íšë“í–ˆìŠµë‹ˆë‹¤!`);
        this.renderStats();
    },

    renderActions() {
        const area = document.getElementById('action-area'); area.innerHTML = '';
        if(this.mode === 'forest') {
            this.addBtn("ğŸŒ² ìˆ² íƒí—˜ (Day+1)", () => this.explore());
            this.addBtn("ğŸ•ï¸ ìº í•‘ (HP+30)", () => { this.p.hp=Math.min(this.p.maxHp, this.p.hp+30); this.next(); this.log("íœ´ì‹ì„ ì·¨í–ˆìŠµë‹ˆë‹¤."); });
        } else if(this.mode === 'village') {
            this.addBtn("âš’ï¸ ëŒ€ì¥ê°„ ë°©ë¬¸", () => this.visit('forge'));
            this.addBtn("ğŸ›Œ ì—¬ê´€ (HPíšŒë³µ/50G)", () => { if(this.p.gold>=50){this.p.gold-=50; this.p.hp=this.p.maxHp; this.log("ì™„ì „íˆ íšŒë³µí–ˆìŠµë‹ˆë‹¤."); this.update();} });
            this.addBtn("ğŸ”® ì ìˆ ì§‘ (ìŠ¤íƒ¯+1/100G)", () => { if(this.p.gold>=100){this.p.gold-=100; const s=['str','agi','int','luk'][rand(0,3)]; this.p[s]++; this.log(`${s}ê°€ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤.`); this.update();} });
            this.addBtn("ğŸ›’ ì¡í™”ì  (EXP+50/100G)", () => { if(this.p.gold>=100){this.p.gold-=100; this.p.exp+=50; this.log("ê²½í—˜ì¹˜ë¥¼ ìŒ“ì•˜ìŠµë‹ˆë‹¤."); this.checkLv();} });
            this.addBtn("ğŸŒ² ë§ˆì„ ë– ë‚˜ê¸°", () => { this.mode='forest'; this.renderActions(); document.getElementById('ui-bg').src=IMGS.forest; });
        } else if(this.mode === 'forge') {
            const btn = this.addBtn("ğŸ¾ í« ê°€ì±  (300G/1íšŒ)", () => {
                if(this.p.gold>=300 && !this.forgeDone){
                    this.p.gold-=300; this.forgeDone=true;
                    const r=Math.random()*100; let p;
                    if(r<2) p=7; else if(r<10) p=12; else if(r<30) p=8; else if(r<60) p=4; else p=0;
                    const res = PET_DB[p+rand(0,3)]; this.p.pets.push(res); this.apply(res);
                    this.pop("ê°€ì±  ê²°ê³¼", `${res.name} ë“±ì¥!`); this.update(); this.renderActions();
                }
            });
            if(this.forgeDone) btn.disabled = true;
            this.addBtn("âš’ï¸ ë¬´ê¸° ê°•í™” (STR+2/100G)", () => { if(this.p.gold>=100){this.p.gold-=100; this.p.str+=2; this.log("ê°•í•´ì¡ŒìŠµë‹ˆë‹¤."); this.update();} });
            this.addBtn("â†©ï¸ ê´‘ì¥ìœ¼ë¡œ", () => this.visit('village'));
        }
    },

    explore() {
        this.p.exp += 20; this.checkLv();
        const r = Math.random();
        if(r < 0.1) { this.visit('village'); this.pop("ë§ˆì„ ë°œê²¬", "ì•ˆê°œ ë„ˆë¨¸ ë§ˆì„ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤."); }
        else if(r < 0.4) this.battle();
        else this.log("ì¡°ìš©í•œ í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤.");
        this.next();
    },

    visit(m) { this.mode = m; this.renderActions(); document.getElementById('ui-bg').src = IMGS[m] || IMGS.village; if(m==='village') this.forgeDone=false; },

    battle() {
        document.getElementById('ui-bg').src = IMGS.battle;
        let dmg = Math.max(5, 20-this.p.agi); this.p.hp -= dmg; this.p.gold += (50+this.p.luk);
        this.log(`ì „íˆ¬ ë°œìƒ! HP -${dmg}, ê³¨ë“œ +${50+this.p.luk}`);
        if(this.p.hp<=0) { alert("ê²Œì„ ì˜¤ë²„"); location.reload(); }
        setTimeout(()=>document.getElementById('ui-bg').src=IMGS[this.mode]||IMGS.forest, 1000);
    },

    apply(p) {
        if(p.bonus.all) { ['str','agi','int','luk'].forEach(s=>this.p[s]+=p.bonus.all); }
        for(let s in p.bonus) { if(s!=='all' && s!=='exp') this.p[s]+=p.bonus[s]; if(s==='hp') this.p.maxHp+=p.bonus[s]; }
    },

    checkLv() { if(this.p.exp>=100){ this.p.lv++; this.p.exp=0; this.p.str+=2; this.p.agi+=2; this.log("ë ˆë²¨ì—…!"); } },
    next() { this.p.day++; if(this.p.day>500) alert("ì—¬ì • ì¢…ë£Œ"); this.update(); },
    update() { document.getElementById('ui-lv').innerText=this.p.lv; document.getElementById('ui-day').innerText=`Day ${this.p.day} / 500`; },
    log(m) { const p=document.getElementById('pane-log'); const d=document.createElement('div'); d.className='log-entry'; d.innerHTML=`> ${m}`; p.prepend(d); },
    pop(t, b) { document.getElementById('msg-title').innerText=t; document.getElementById('msg-body').innerText=b; document.getElementById('msg-overlay').style.display='flex'; },
    addBtn(t, f) { const b=document.createElement('button'); b.className='action-btn'; b.innerText=t; b.onclick=f; document.getElementById('action-area').appendChild(b); return b; }
};

function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
game.init();
</script>
</body>
</html>
