<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom Chronicles</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --safe-bottom: env(safe-area-inset-bottom);
            --rarity-ur: #ff4500; --rarity-sr: #da70d6; --rarity-s: #ffd700; --rarity-r: #1e90ff; --rarity-c: #aaaaaa;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* í—¤ë” ë° ìƒë‹¨ ë¹„ì£¼ì–¼ */
        header { padding: calc(env(safe-area-inset-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-weight: bold; z-index: 10; }
        .visual-frame { width: 100%; height: 25vh; position: relative; background: #000; border-bottom: 3px solid var(--accent); overflow: hidden; flex-shrink: 0; }
        #ui-bg { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.6); }
        #ui-char { position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); height: 110%; z-index: 5; filter: drop-shadow(0 0 15px black); }

        /* íƒ­ ë©”ë‰´ */
        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; color: #666; font-weight: bold; font-size: 14px; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        /* ë©”ì¸ ë¡œê·¸ ì˜ì—­ (ê°€ë³€ ë†’ì´ í™•ë³´) */
        .content { flex: 1; overflow-y: auto; padding: 15px; background: #111; position: relative; }
        .log-entry { margin-bottom: 8px; font-size: 14px; line-height: 1.5; border-left: 3px solid var(--border); padding-left: 10px; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* í•˜ë‹¨ ì•¡ì…˜ ë²„íŠ¼ ì˜ì—­ (ë“œë˜ê·¸/ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */
        footer { background: var(--panel); border-top: 1px solid var(--border); flex-shrink: 0; padding-bottom: var(--safe-bottom); }
        .action-scroll-area { max-height: 180px; overflow-y: auto; padding: 12px 15px; display: flex; flex-direction: column; gap: 8px; scroll-behavior: smooth; }
        .action-btn { background: #2a2a26; color: white; padding: 14px; border-radius: 10px; border: 1px solid #444; font-weight: bold; font-size: 14px; text-align: center; cursor: pointer; }
        .action-btn:active { background: var(--accent); color: #000; }
        .action-btn:disabled { opacity: 0.3; pointer-events: none; }

        /* í« ì•„ì´í…œ */
        .pet-item { background: #222; padding: 10px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #333; display: flex; align-items: center; gap: 10px; font-size: 13px; }
        .pet-item.selected { border-color: var(--accent); background: #2a2a22; }
        .badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: #000; }

        /* ì´ˆê¸° ì„ íƒ í™”ë©´ */
        #origin-screen { position: fixed; inset: 0; z-index: 2000; background: var(--bg); padding: 20px; overflow-y: auto; }
        .race-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
        
        .overlay { display: none; position: fixed; inset: 0; z-index: 3000; background: rgba(0,0,0,0.9); align-items: center; justify-content: center; padding: 20px; }
        .popup { background: #161614; border: 2px solid var(--accent); border-radius: 20px; padding: 20px; width: 100%; max-width: 300px; text-align: center; }
    </style>
</head>
<body>

    <div id="origin-screen">
        <h2 style="text-align:center; color:var(--accent); margin-bottom:20px;">ì˜ì›…ì˜ í˜ˆí†µ ì„ íƒ</h2>
        <div id="race-list"></div>
        <div id="reroll-box" style="display:none; background:#222; padding:15px; border-radius:12px; text-align:center; margin-top:10px;">
            <p id="temp-stats" style="margin-bottom:12px; font-size:14px;"></p>
            <button class="action-btn" onclick="game.reroll()" style="width:100%; margin-bottom:8px;">ğŸ² ë³´ë„ˆìŠ¤ ë¦¬ë¡¤ (50G)</button>
            <button class="action-btn" style="width:100%; background:var(--accent); color:#000;" onclick="game.start()">ëª¨í—˜ ì‹œì‘</button>
        </div>
    </div>

    <div id="msg-overlay" class="overlay" onclick="this.style.display='none'">
        <div class="popup" onclick="event.stopPropagation()">
            <h3 id="msg-title" style="color:var(--accent); margin-bottom:10px;">ì•Œë¦¼</h3>
            <p id="msg-body" style="margin-bottom:20px; font-size:14px; color:#ccc;"></p>
            <button class="action-btn" style="width:100%" onclick="document.getElementById('msg-overlay').style.display='none'">ë‹«ê¸°</button>
        </div>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div><span id="ui-race" style="color:var(--accent)"></span> Lv.<span id="ui-lv">1</span></div>
            <div id="ui-day">Day 1 / 500</div>
        </header>

        <div class="visual-frame">
            <img id="ui-bg" src="https://image.lexica.art/full_webp/cc2057ae-e069-450f-a2e6-a94b595bb919">
            <img id="ui-char" src="">
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" id="tab-l" onclick="game.tab('log')">íƒí—˜ ë¡œê·¸</button>
            <button class="tab-btn" id="tab-s" onclick="game.tab('stat')">ì •ë³´/ì¸ë²¤í† ë¦¬</button>
        </div>

        <div id="pane-log" class="content"></div>
        <div id="pane-stat" class="content" style="display:none;">
            <div id="stat-info" style="margin-bottom:15px; padding:12px; background:#222; border-radius:10px; font-size:13px; border-left:4px solid var(--accent);"></div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h4 style="color:var(--accent);">ë‚˜ì˜ ë™ë£Œ (<span id="pet-cnt">0</span>)</h4>
                <button id="merge-btn" class="action-btn" style="padding:4px 12px; font-size:11px;" onclick="game.merge()" disabled>í•©ì„±(2ë§ˆë¦¬ ì„ íƒ)</button>
            </div>
            <div id="pet-list"></div>
        </div>

        <footer>
            <div id="action-area" class="action-scroll-area"></div>
        </footer>
    </div>

<script>
const IMGS = {
    forest: "https://image.lexica.art/full_webp/cc2057ae-e069-450f-a2e6-a94b595bb919",
    village: "https://image.lexica.art/full_webp/51351532-3580-4963-8a9d-b8733b1e967a",
    forge: "https://image.lexica.art/full_webp/711a43a0-7b24-4f40-b6f4-c9b008d6c810",
    shop: "https://image.lexica.art/full_webp/176974fb-1698-4560-a292-1264c76747b4",
    battle: "https://image.lexica.art/full_webp/e8a8b11a-42c2-491a-969c-735955b2521b",
    races: {
        Orc: "https://image.lexica.art/full_webp/01017b2b-6d65-4f35-9c88-12d770512803",
        Halfling: "https://image.lexica.art/full_webp/26253907-f377-497d-b14e-b830d1e39a58",
        Elf: "https://image.lexica.art/full_webp/60183021-d779-4447-b50a-e373449c2505",
        Human: "https://image.lexica.art/full_webp/023193e3-a6b1-4f32-849c-f7267d30f551",
        Beast: "https://image.lexica.art/full_webp/6e22f281-705b-4395-8884-60ff868b1ee4"
    }
};

const PET_DB = [
    { name:"ì´ˆë³´ í–„ìŠ¤í„°", grade:"COMMON", bonus:{luk:2}, price:50 },
    { name:"ëŒë©©ì´ ê³¨ë ˜", grade:"COMMON", bonus:{str:2}, price:50 },
    { name:"ê¹œë¹¡ ë°•ì¥", grade:"COMMON", bonus:{agi:2}, price:50 },
    { name:"ì§€ì‹ ë²„ì„¯", grade:"COMMON", bonus:{int:2}, price:50 },
    { name:"í‘¸ë¥¸ ìš”ì •", grade:"RARE", bonus:{hp:30, int:5}, price:150 },
    { name:"ê°•ì²  ë©§ë¼ì§€", grade:"RARE", bonus:{str:8}, price:150 },
    { name:"ë‚ ìŒ˜ ë‹¤ëŒì¥", grade:"RARE", bonus:{agi:8}, price:150 },
    { name:"í–‰ìš´ì˜ ê³ ì–‘ì´", grade:"RARE", bonus:{luk:8}, price:150 },
    { name:"ìˆ²ì˜ íŒŒìˆ˜ê¾¼", grade:"SUPER", bonus:{str:15, hp:50}, price:400 },
    { name:"ê³ ëŒ€ ìœ ë ¹", grade:"SUPER RARE", bonus:{int:40}, price:1000 },
    { name:"ë² í—¤ëª¨ìŠ¤", grade:"ULTRA RARE", bonus:{str:50, hp:200, all:10}, price:3000 }
];

const game = {
    p: { race:null, day:1, lv:1, exp:0, gold:300, hp:100, maxHp:100, str:0, agi:0, int:0, luk:0, pets:[], bonus:{} },
    selected: [], mode: 'forest', forgeUsed: false,

    init() {
        const list = document.getElementById('race-list');
        const races = [
            { id:'Orc', name:'ì˜¤í¬', str:18, agi:5, int:2, luk:5, hp:160 },
            { id:'Halfling', name:'í•˜í”Œë§', str:4, agi:12, int:8, luk:16, hp:70 },
            { id:'Elf', name:'ì—˜í”„', str:6, agi:14, int:16, luk:4, hp:85 },
            { id:'Human', name:'ì¸ê°„', str:10, agi:10, int:10, luk:10, hp:100 },
            { id:'Beast', name:'ìˆ˜ì¸', str:13, agi:13, int:6, luk:8, hp:115 }
        ];
        races.forEach(r => {
            const card = document.createElement('div'); card.className = 'race-card';
            card.innerHTML = `<img src="${IMGS.races[r.id]}" style="width:60px; height:60px; border-radius:10px; border:1px solid #555;">
            <div><b>${r.name}</b><br><small style="color:#aaa;">STR:${r.str} HP:${r.hp} LUK:${r.luk}</small></div>`;
            card.onclick = () => { this.p.race = r; this.reroll(); document.getElementById('reroll-box').style.display='block'; };
            list.appendChild(card);
        });
    },

    reroll() {
        if(this.p.gold < 50 && this.p.race) { this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
        if(this.p.race) this.p.gold -= 50;
        this.p.bonus = { str:rand(1,5), agi:rand(1,5), int:rand(1,5), luk:rand(1,5) };
        document.getElementById('temp-stats').innerHTML = `<b>ğŸ² ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ ì ìš©ë¨</b><br>STR+${this.p.bonus.str} AGI+${this.p.bonus.agi} INT+${this.p.bonus.int} LUK+${this.p.bonus.luk}`;
    },

    start() {
        const r = this.p.race; const b = this.p.bonus;
        this.p.str = r.str + b.str; this.p.agi = r.agi + b.agi; this.p.int = r.int + b.int; this.p.luk = r.luk + b.luk;
        this.p.hp = r.hp; this.p.maxHp = r.hp;
        document.getElementById('origin-screen').style.display='none';
        document.getElementById('game-ui').style.display='flex';
        document.getElementById('ui-race').innerText = r.name;
        document.getElementById('ui-char').src = IMGS.races[r.id];
        this.renderActions();
        this.log("ì—ë²„ë¸”ë£¸ì˜ ì—¬ì •ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
    },

    tab(t) {
        document.getElementById('pane-log').style.display = t==='log'?'block':'none';
        document.getElementById('pane-stat').style.display = t==='stat'?'block':'none';
        document.getElementById('tab-l').className = t==='log'?'tab-btn active':'tab-btn';
        document.getElementById('tab-s').className = t==='stat'?'tab-btn active':'tab-btn';
        if(t==='stat') this.renderStats();
    },

    renderStats() {
        document.getElementById('stat-info').innerHTML = `<b>${this.p.race.name} (Day ${this.p.day})</b><br>
        â¤ï¸ HP: ${this.p.hp}/${this.p.maxHp} | ğŸ’° GOLD: ${this.p.gold}G<br>
        âš”ï¸ STR: ${this.p.str} | ğŸƒ AGI: ${this.p.agi} | ğŸ§  INT: ${this.p.int} | ğŸ€ LUK: ${this.p.luk}`;
        const list = document.getElementById('pet-list'); list.innerHTML = '';
        document.getElementById('pet-cnt').innerText = this.p.pets.length;
        this.p.pets.forEach((p, i) => {
            const d = document.createElement('div'); d.className = `pet-item ${this.selected.includes(i)?'selected':''}`;
            const color = `var(--rarity-${p.grade.toLowerCase().replace(' ','')})`;
            d.innerHTML = `<span class="badge" style="background:${color}">${p.grade}</span><div><b>${p.name}</b><br><small>ê°€ì¹˜: ${Math.floor(p.price*0.7)}G</small></div>`;
            d.onclick = () => {
                if(this.selected.includes(i)) this.selected = this.selected.filter(x=>x!==i);
                else if(this.selected.length < 2) this.selected.push(i);
                document.getElementById('merge-btn').disabled = this.selected.length !== 2;
                this.renderStats();
            };
            list.appendChild(d);
        });
    },

    merge() {
        const p1 = this.p.pets[this.selected[0]], p2 = this.p.pets[this.selected[1]];
        this.selected.sort((a,b)=>b-a).forEach(i => this.p.pets.splice(i,1));
        this.selected = [];
        const next = PET_DB[rand(0, PET_DB.length-1)]; // ì‹¤ì œ ê²Œì„ì—ì„  ë“±ê¸‰ ê°€ì¤‘ì¹˜ ì ìš© ê°€ëŠ¥
        this.p.pets.push(next); this.apply(next);
        this.pop("í•©ì„± ì„±ê³µ", `${next.name}ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!`);
        this.renderStats();
    },

    renderActions() {
        const area = document.getElementById('action-area'); area.innerHTML = '';
        if(this.mode === 'forest') {
            this.addBtn("ğŸŒ² ê¹Šì€ ìˆ² íƒí—˜ (Day+1)", () => this.explore());
            this.addBtn("ğŸ•ï¸ ìº í•‘ ë° íœ´ì‹ (HP+40)", () => { this.p.hp=Math.min(this.p.maxHp, this.p.hp+40); this.next(); this.log("íœ´ì‹ì„ í†µí•´ ê¸°ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤."); });
        } else if(this.mode === 'village') {
            this.addBtn("âš’ï¸ ëŒ€ì¥ê°„ (ê°€ì± /ê°•í™”)", () => this.visit('forge'));
            this.addBtn("ğŸ›’ ì¡í™”ì  (êµ¬ë§¤/íŒë§¤)", () => this.visit('shop'));
            this.addBtn("ğŸ›Œ ì—¬ê´€ (ìˆ™ë°•-50G/HPì™„ì¶©)", () => { if(this.p.gold>=50){this.p.gold-=50; this.p.hp=this.p.maxHp; this.log("ì—¬ê´€ì—ì„œ í‘¹ ì‰¬ì—ˆìŠµë‹ˆë‹¤."); this.update();} });
            this.addBtn("ğŸŒ² ë§ˆì„ ë– ë‚˜ê¸°", () => { this.mode='forest'; document.getElementById('ui-bg').src=IMGS.forest; this.renderActions(); });
        } else if(this.mode === 'forge') {
            const gbtn = this.addBtn("ğŸ¾ í« ê°€ì±  (300G/1íšŒ)", () => {
                if(this.p.gold>=300 && !this.forgeUsed){
                    this.p.gold-=300; this.forgeUsed=true;
                    const res = PET_DB[rand(0, 5)]; this.p.pets.push(res); this.apply(res);
                    this.pop("ê°€ì±  ê²°ê³¼", `${res.name}ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤!`); this.update(); this.renderActions();
                }
            });
            if(this.forgeUsed) { gbtn.disabled = true; gbtn.innerText = "ê°€ì±  (ì˜¤ëŠ˜ ì™„ë£Œ)"; }
            this.addBtn("âš’ï¸ ë¬´ê¸° ê°•í™” (100G/STR+2)", () => { if(this.p.gold>=100){this.p.gold-=100; this.p.str+=2; this.log("ë¬´ê¸°ê°€ ë”ìš± ë‚ ì¹´ë¡œì›Œì¡ŒìŠµë‹ˆë‹¤."); this.update();} });
            this.addBtn("â†©ï¸ ë§ˆì„ ê´‘ì¥", () => this.visit('village'));
        } else if(this.mode === 'shop') {
            this.addBtn("ğŸ’Š íšŒë³µ í¬ì…˜ (30G/HP+50)", () => { if(this.p.gold>=30){this.p.gold-=30; this.p.hp=Math.min(this.p.maxHp, this.p.hp+50); this.log("í¬ì…˜ì„ ë§ˆì…¨ìŠµë‹ˆë‹¤."); this.update();} });
            this.addBtn("ğŸ’ ë¬´ì‘ìœ„ í« êµ¬ë§¤ (500G)", () => { if(this.p.gold>=500){this.p.gold-=500; const p=PET_DB[rand(0, 7)]; this.p.pets.push(p); this.apply(p); this.pop("êµ¬ë§¤ ì™„ë£Œ", `${p.name}ì„(ë¥¼) ë°ë ¤ì™”ìŠµë‹ˆë‹¤.`); this.update();} });
            this.addBtn("ğŸ’° í« íŒë§¤ (ì„ íƒëœ í« íŒë§¤)", () => {
                if(this.selected.length > 0) {
                    let total = 0;
                    this.selected.sort((a,b)=>b-a).forEach(i => {
                        total += Math.floor(this.p.pets[i].price * 0.7);
                        this.p.pets.splice(i, 1);
                    });
                    this.p.gold += total; this.selected = [];
                    this.log(`${total}ê³¨ë“œë¥¼ ë°›ê³  í«ì„ íŒë§¤í–ˆìŠµë‹ˆë‹¤.`);
                    this.renderStats(); this.update();
                } else { this.log("íŒë§¤í•  í«ì„ ì¸ë²¤í† ë¦¬ì—ì„œ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”."); }
            });
            this.addBtn("â†©ï¸ ë§ˆì„ ê´‘ì¥", () => this.visit('village'));
        }
        area.scrollTop = 0;
    },

    explore() {
        this.p.exp += 20; if(this.p.exp>=100){this.p.lv++; this.p.exp=0; this.p.str+=1; this.log("ë ˆë²¨ì—…!");}
        if(Math.random() < 0.15) { this.visit('village'); this.pop("ë§ˆì„ ì…êµ¬", "í™œê¸°ì°¬ ë§ˆì„ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤."); }
        else if(Math.random() < 0.4) this.battle();
        else this.log("í‰í™”ë¡œìš´ ìˆ²ì„ ìˆ˜ìƒ‰í–ˆìŠµë‹ˆë‹¤.");
        this.next();
    },

    visit(m) { this.mode = m; document.getElementById('ui-bg').src = IMGS[m] || IMGS.village; if(m==='village') this.forgeUsed=false; this.renderActions(); },

    battle() {
        const b = document.getElementById('ui-bg'); const old = b.src; b.src = IMGS.battle;
        let dmg = Math.max(5, 20-this.p.agi); this.p.hp -= dmg; this.p.gold += (40+this.p.luk);
        this.log(`ì „íˆ¬ ë°œìƒ! HP -${dmg}, ê³¨ë“œ +${40+this.p.luk}`);
        if(this.p.hp<=0) { alert("ì‚¬ë§í•˜ì˜€ìŠµë‹ˆë‹¤."); location.reload(); }
        setTimeout(() => b.src = old, 800);
    },

    apply(p) { if(p.bonus.all) { ['str','agi','int','luk'].forEach(s=>this.p[s]+=p.bonus.all); } for(let s in p.bonus) { if(s!=='all') this.p[s]+=p.bonus[s]; if(s==='hp') this.p.maxHp+=p.bonus[s]; } },
    next() { this.p.day++; this.update(); },
    update() { document.getElementById('ui-lv').innerText=this.p.lv; document.getElementById('ui-day').innerText=`Day ${this.p.day} / 500`; },
    log(m) { const p=document.getElementById('pane-log'); const d=document.createElement('div'); d.className='log-entry'; d.innerHTML=`> ${m}`; p.prepend(d); },
    pop(t, b) { document.getElementById('msg-title').innerText=t; document.getElementById('msg-body').innerText=b; document.getElementById('msg-overlay').style.display='flex'; },
    addBtn(t, f) { const b=document.createElement('button'); b.className='action-btn'; b.innerText=t; b.onclick=f; document.getElementById('action-area').appendChild(b); return b; }
};

function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
game.init();
</script>
</body>
</html>
