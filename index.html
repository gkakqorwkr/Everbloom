<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom: Forge & Familiar</title>
    <style>
        :root {
            --bg: #0a0a09; --panel: #161614; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
            --rarity-ur: #ff4500; --rarity-sr: #da70d6; --rarity-s: #ffd700; --rarity-r: #1e90ff; --rarity-c: #aaaaaa;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* ë°°ê²½ ë° ìºë¦­í„° ë¹„ì£¼ì–¼ */
        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .visual-frame { width: 100%; height: 28vh; position: relative; background: #000; border-bottom: 2px solid var(--accent); overflow: hidden; }
        #ui-bg { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; transition: 0.5s; }
        .char-sprite { position: absolute; bottom: 0; left: 5%; height: 85%; z-index: 5; filter: drop-shadow(0 0 10px black); }

        /* íƒ­ ì‹œìŠ¤í…œ */
        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); }
        .tab-btn { flex: 1; padding: 15px; border: none; background: none; color: #666; font-weight: bold; font-size: 14px; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        .content { flex: 1; overflow-y: auto; padding: 20px; background: linear-gradient(to bottom, #111, #000); }
        .log-entry { margin-bottom: 10px; font-size: 15px; line-height: 1.6; border-left: 2px solid var(--border); padding-left: 12px; animation: fadeIn 0.3s; }
        
        /* ìŠ¤íƒ¯ ë° í« UI */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: #1c1c1a; padding: 15px; border-radius: 12px; border: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .up-btn { background: var(--accent); color: #000; border: none; width: 30px; height: 30px; border-radius: 5px; font-weight: bold; }
        .up-btn:disabled { background: #444; opacity: 0.5; }

        .pet-card { background: #252522; padding: 12px; border-radius: 10px; border-left: 4px solid var(--rarity-c); margin-bottom: 8px; display: flex; align-items: center; gap: 12px; }
        .pet-card.UR { border-color: var(--rarity-ur); }
        .pet-card.SR { border-color: var(--rarity-sr); }

        /* í•˜ë‹¨ ë²„íŠ¼ */
        footer { padding: 15px 15px calc(var(--safe-bottom) + 20px); background: var(--panel); border-top: 1px solid var(--border); }
        .btn-stack { display: flex; flex-direction: column; gap: 8px; }
        .action-btn { background: #2a2a26; color: white; padding: 18px; border-radius: 12px; border: 1px solid #444; font-weight: bold; text-align: center; }
        .action-btn:active { background: var(--accent); color: #000; }

        /* ê°€ì±  ê²°ê³¼ íŒì—… */
        #gacha-overlay { display: none; position: fixed; inset: 0; z-index: 2000; background: rgba(0,0,0,0.95); flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .gacha-box { border: 2px solid var(--accent); padding: 40px; border-radius: 20px; background: #111; animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        @keyframes pop { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* ì´ˆê¸° í™”ë©´ */
        #origin-screen { position: fixed; inset: 0; z-index: 3000; background: var(--bg); padding: 20px; overflow-y: auto; }
        .race-btn { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; width: 100%; text-align: left; color: #fff; }
    </style>
</head>
<body>

    <div id="origin-screen">
        <h2 style="text-align:center; margin-bottom:20px; color:var(--accent);">ì¢…ì¡±ì„ ì„ íƒí•˜ê³  ì—¬ì •ì„ ì‹œì‘í•˜ì‹­ì‹œì˜¤</h2>
        <div id="race-list"></div>
    </div>

    <div id="gacha-overlay">
        <div class="gacha-box">
            <h2 id="g-grade" style="margin-bottom:10px;">ë“±ê¸‰</h2>
            <h1 id="g-name" style="color:#fff; margin-bottom:20px;">í« ì´ë¦„</h1>
            <p id="g-desc" style="color:#aaa; margin-bottom:30px;"></p>
            <button class="action-btn" style="width:100%" onclick="game.closeGacha()">ìˆ˜ë ¹í•˜ê¸°</button>
        </div>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div><span id="ui-race" style="color:var(--accent)"></span> Lv.<span id="ui-lv">1</span></div>
            <div id="ui-day">Day 1 / 500</div>
        </header>

        <div class="visual-frame">
            <img id="ui-bg" src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000">
            <img class="char-sprite" id="ui-char" src="">
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" id="tab-l" onclick="game.tab('log')">EXPLORE</button>
            <button class="tab-btn" id="tab-s" onclick="game.tab('stat')">CHARACTER</button>
        </div>

        <div id="pane-log" class="content"></div>
        <div id="pane-stat" class="content" style="display:none;">
            <div style="color:var(--accent); font-weight:bold; margin-bottom:10px;">ë‚¨ì€ í¬ì¸íŠ¸: <span id="ui-pt">0</span></div>
            <div class="stat-grid" id="stat-grid"></div>
            <div id="base-stats" style="background:#222; padding:15px; border-radius:10px; font-size:13px; margin-bottom:20px;"></div>
            <h3 style="margin-bottom:10px; color:var(--accent);">ë‚˜ì˜ í« (<span id="pet-count">0</span>)</h3>
            <div id="pet-list"></div>
        </div>

        <footer>
            <div id="action-area" class="btn-stack"></div>
        </footer>
    </div>

<script>
const RACES = [
    { id:'Human', name:'ì¸ê°„', img:'https://i.ibb.co/vYm6p0v/hero-pixel.png', str:10, agi:10, int:10, luk:10, hp:100 },
    { id:'Elf', name:'ì—˜í”„', img:'https://i.ibb.co/qY7v6p0/thief-pixel.png', str:5, agi:15, int:15, luk:5, hp:80 },
    { id:'Orc', name:'ì˜¤í¬', img:'https://i.ibb.co/vXy6p0v/golem-pixel.png', str:20, agi:5, int:2, luk:3, hp:180 },
    { id:'Halfling', name:'í•˜í”Œë§', img:'https://i.ibb.co/3W6f9fP/slime-pixel.png', str:4, agi:12, int:8, luk:20, hp:70 },
    { id:'Beast', name:'ìˆ˜ì¸', img:'https://i.ibb.co/6P0f9X8/lizard-pixel.png', str:14, agi:14, int:4, luk:8, hp:110 },
    { id:'Angel', name:'ì²œì‚¬', str:8, agi:8, int:15, luk:15, hp:100, img:'https://img.freepik.com/free-photo/mystical-ancient-ruins-forest-digital-art_23-2151121014.jpg' },
    { id:'Demon', name:'ì•…ë§ˆ', str:18, agi:10, int:10, luk:2, hp:130, img:'https://img.freepik.com/free-photo/fierce-warrior-confronting-monster-forest-digital-art_23-2151121050.jpg' }
];

const PET_DATA = [
    { name: "ê¸¸ê³ ì–‘ì´", grade: "COMMON", bonus: {luk:2}, desc: "ì–´ë””ì„ ê°€ ë”°ë¼ì˜¨ í‰ë²”í•œ ê³ ì–‘ì´ì…ë‹ˆë‹¤." },
    { name: "ê°•ì²  ë©§ë¼ì§€", grade: "RARE", bonus: {str:5}, desc: "ë‹¨ë‹¨í•œ ê°€ì£½ì„ ê°€ì§„ ë©§ë¼ì§€ì…ë‹ˆë‹¤." },
    { name: "ì€ë¹› ì—¬ìš°", grade: "SUPER", bonus: {agi:8, int:4}, desc: "ë§¤ìš° ë¯¼ì²©í•˜ê³  ì˜ë¦¬í•œ ì—¬ìš°ì…ë‹ˆë‹¤." },
    { name: "í™”ì—¼ ë“œë˜ê³¤", grade: "SUPER RARE", bonus: {str:15, hp:50}, desc: "ê°•ë ¥í•œ í™”ì—¼ì„ ë‚´ë¿œëŠ” ì–´ë¦° ìš©ì…ë‹ˆë‹¤." },
    { name: "ì‹¬ì—°ì˜ ë² í—¤ëª¨ìŠ¤", grade: "ULTRA RARE", bonus: {str:30, agi:10, int:10, luk:10, hp:100}, desc: "ì „ì„¤ ì†ì˜ ê´´ìˆ˜ì…ë‹ˆë‹¤. ë‹¹ì‹ ì„ ì‹ ì˜ ì˜ì—­ìœ¼ë¡œ ì´ë•ë‹ˆë‹¤." }
];

const game = {
    p: { race:null, day:1, lv:1, exp:0, maxExp:100, pt:0, hp:100, maxHp:100, gold:500, str:0, agi:0, int:0, luk:0, pets:[] },

    init() {
        const list = document.getElementById('race-list');
        RACES.forEach(r => {
            const b = document.createElement('button');
            b.className = 'race-btn';
            b.innerHTML = `<img src="${r.img}" style="width:40px;"> <b>${r.name}</b>`;
            b.onclick = () => this.start(r);
            list.appendChild(b);
        });
    },

    start(race) {
        this.p.race = race; this.p.str = race.str; this.p.agi = race.agi; this.p.int = race.int; this.p.luk = race.luk;
        this.p.hp = race.hp; this.p.maxHp = race.hp;
        document.getElementById('origin-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        document.getElementById('ui-race').innerText = race.name;
        document.getElementById('ui-char').src = race.img;
        this.renderActions();
        this.log("ì—ë²„ë¸”ë£¸ì˜ ìˆ²ì— ì²« ë°œì„ ë‚´ë””ë ìŠµë‹ˆë‹¤. 500ì¼ì˜ ì‹œê°„ì´ ì£¼ì–´ì§‘ë‹ˆë‹¤.");
    },

    tab(t) {
        document.getElementById('pane-log').style.display = t==='log'?'block':'none';
        document.getElementById('pane-stat').style.display = t==='stat'?'block':'none';
        document.getElementById('tab-l').className = t==='log'?'tab-btn active':'tab-btn';
        document.getElementById('tab-s').className = t==='stat'?'tab-btn active':'tab-btn';
        if(t==='stat') this.renderStats();
    },

    renderStats() {
        const grid = document.getElementById('stat-grid'); grid.innerHTML = '';
        ['str', 'agi', 'int', 'luk'].forEach(s => {
            const card = document.createElement('div'); card.className = 'stat-card';
            card.innerHTML = `<span>${s.toUpperCase()}: <b>${this.p[s]}</b></span>
            <button class="up-btn" onclick="game.upgrade('${s}')" ${this.p.pt<=0?'disabled':''}>+</button>`;
            grid.appendChild(card);
        });
        document.getElementById('ui-pt').innerText = this.p.pt;
        document.getElementById('base-stats').innerHTML = `HP: ${this.p.hp}/${this.p.maxHp} | GOLD: ${this.p.gold}G | EXP: ${this.p.exp}/${this.p.maxExp}`;
        
        const plist = document.getElementById('pet-list'); plist.innerHTML = '';
        document.getElementById('pet-count').innerText = this.p.pets.length;
        this.p.pets.forEach(pet => {
            const pc = document.createElement('div'); pc.className = `pet-card ${pet.grade.split(' ').join('')}`;
            pc.innerHTML = `<div><b>${pet.name}</b> <small>(${pet.grade})</small><br><small>${pet.desc}</small></div>`;
            plist.appendChild(pc);
        });
    },

    upgrade(s) {
        if(this.p.pt > 0) { this.p[s]++; this.p.pt--; if(s==='str') this.p.maxHp += 10; this.renderStats(); this.checkEnding(); }
    },

    renderActions() {
        const area = document.getElementById('action-area'); area.innerHTML = '';
        this.addBtn("ğŸŒ² ê¹Šì€ ìˆ² íƒí—˜ (Day +1)", () => this.explore());
        this.addBtn("â›º íœ´ì‹ ë° ëª…ìƒ", () => { this.p.hp = Math.min(this.p.maxHp, this.p.hp+30); this.nextDay(); this.log("íœ´ì‹ì„ í†µí•´ ê¸°ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤."); });
        this.updateUI();
    },

    explore() {
        this.p.exp += (20 + this.p.int); this.checkLvUp();
        const roll = Math.random();
        if(roll < 0.2) this.enterForge();
        else if(roll < 0.5) this.battle();
        else this.log("ìˆ²ì„ ìˆ˜ìƒ‰í–ˆìœ¼ë‚˜ ë³„ë‹¤ë¥¸ ì¼ì€ ì—†ì—ˆìŠµë‹ˆë‹¤.");
        this.nextDay();
    },

    enterForge() {
        this.log("ì•ˆê°œ ì†ì—ì„œ ì‹ ë¹„ë¡œìš´ ëŒ€ì¥ê°„ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤!");
        document.getElementById('ui-bg').src = "https://i.ibb.co/3sX8s8D/forge.png";
        const area = document.getElementById('action-area'); area.innerHTML = '';
        this.addBtn("ğŸ’ í« ê°€ì±  (300G ì†Œëª¨)", () => this.gacha());
        this.addBtn("âš’ï¸ ì¥ë¹„ ê°•í™” (100G / STR+2)", () => {
            if(this.p.gold >= 100) { this.p.gold -= 100; this.p.str += 2; this.log("ë¬´ê¸°ë¥¼ ê°•í™”í•˜ì—¬ ê·¼ë ¥ì´ ìƒìŠ¹í–ˆìŠµë‹ˆë‹¤!"); this.updateUI(); }
            else this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
        });
        this.addBtn("ğŸŒ² ìˆ²ìœ¼ë¡œ ëŒì•„ê°€ê¸°", () => { document.getElementById('ui-bg').src = "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000"; this.renderActions(); });
    },

    gacha() {
        if(this.p.gold < 300) { this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤! (300G í•„ìš”)"); return; }
        this.p.gold -= 300;
        const r = Math.random() * 100;
        let p;
        if(r < 1) p = PET_DATA[4]; // UR 1%
        else if(r < 5) p = PET_DATA[3]; // SR 4%
        else if(r < 15) p = PET_DATA[2]; // S 10%
        else if(r < 40) p = PET_DATA[1]; // R 25%
        else p = PET_DATA[0]; // C 60%

        this.p.pets.push(p);
        for(let s in p.bonus) { this.p[s] += p.bonus[s]; if(s==='hp') this.p.maxHp += p.bonus[s]; }
        
        document.getElementById('g-grade').innerText = p.grade;
        document.getElementById('g-grade').style.color = `var(--rarity-${p.grade.toLowerCase().split(' ').join('')})`;
        document.getElementById('g-name').innerText = p.name;
        document.getElementById('g-desc').innerText = p.desc;
        document.getElementById('gacha-overlay').style.display = 'flex';
    },

    closeGacha() { document.getElementById('gacha-overlay').style.display = 'none'; this.updateUI(); },

    battle() {
        let dmg = Math.max(5, 20 - this.p.agi);
        this.p.hp -= dmg; this.p.gold += (30 + this.p.luk);
        this.log(`ëª¬ìŠ¤í„°ì™€ì˜ ì „íˆ¬! HP -${dmg}, ê³¨ë“œ +${30 + this.p.luk}G.`);
        if(this.p.hp <= 0) { alert("ì‚¬ë§í•˜ì˜€ìŠµë‹ˆë‹¤..."); location.reload(); }
    },

    checkLvUp() {
        while(this.p.exp >= this.p.maxExp) {
            this.p.lv++; this.p.exp -= this.p.maxExp; this.p.maxExp = Math.floor(this.p.maxExp * 1.3);
            this.p.pt += 5; this.log(`ë ˆë²¨ ì—…! ${this.p.lv}ì´ ë˜ì—ˆìŠµë‹ˆë‹¤. í¬ì¸íŠ¸ +5.`);
        }
    },

    nextDay() { this.p.day++; if(this.p.day >= 500) this.end("ë°©ë‘ì˜ ë", "500ì¼ì˜ ì—¬ì •ì´ ëë‚¬ìŠµë‹ˆë‹¤."); },

    updateUI() {
        document.getElementById('ui-lv').innerText = this.p.lv;
        document.getElementById('ui-day').innerText = `Day ${this.p.day} / 500`;
    },

    checkEnding() {
        if(this.p.str >= 100) this.end("íˆ¬ì‹  ê°•ë¦¼", "ê·¼ë ¥ì´ 100ì„ ëŒíŒŒí–ˆìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ëŒ€ë¥™ ìµœê°•ì˜ ì „ì‚¬ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.");
        if(this.p.int >= 100) this.end("ì§„ë¦¬ì˜ ëˆˆ", "ì§€ë ¥ì´ 100ì„ ëŒíŒŒí–ˆìŠµë‹ˆë‹¤. ì„¸ìƒì˜ ëª¨ë“  ì„­ë¦¬ë¥¼ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤.");
    },

    end(t, d) {
        document.body.innerHTML = `<div style="padding:50px; text-align:center; height:100vh; display:flex; flex-direction:column; justify-content:center; background:#000;">
            <h1 style="color:var(--accent); font-size:2.5rem; margin-bottom:20px;">${t}</h1>
            <p style="line-height:1.8; margin-bottom:40px;">${d}</p>
            <button class="action-btn" onclick="location.reload()">ìƒˆë¡œìš´ ì „ì„¤ ì‹œì‘</button>
        </div>`;
    },

    log(m) {
        const pane = document.getElementById('pane-log');
        const div = document.createElement('div'); div.className = 'log-entry'; div.innerHTML = `> ${m}`;
        pane.prepend(div);
    },

    addBtn(t, f) {
        const b = document.createElement('button'); b.className = 'action-btn'; b.innerText = t;
        b.onclick = (e) => { e.stopPropagation(); f(); };
        document.getElementById('action-area').appendChild(b);
    }
};

game.init();
</script>
</body>
</html>
