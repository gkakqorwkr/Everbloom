<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Everbloom: EryStart</title>
    <style>
        :root {
            --bg-color: #2e2624; /* ì „ì²´ ë°°ê²½ìƒ‰ */
            --panel-bg: #4a3e3b; /* íŒ¨ë„ ë°°ê²½ìƒ‰ */
            --border-color: #7a6a67; /* í…Œë‘ë¦¬ìƒ‰ */
            --text-color: #f7e7d6; /* ê¸°ë³¸ í…ìŠ¤íŠ¸ìƒ‰ */
            --accent-color: #c08d4b; /* ê°•ì¡°ìƒ‰ (ê³¨ë“œ/ë¸Œë¼ìš´) */
            --button-color: #6a5e5c; /* ë²„íŠ¼ ë°°ê²½ìƒ‰ */
            --button-hover: #8a7e7c; /* ë²„íŠ¼ í˜¸ë²„/í´ë¦­ìƒ‰ */
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* iOS í„°ì¹˜ í•˜ì´ë¼ì´íŠ¸ ì œê±° */
            font-family: 'DotGothic16', 'Press Start 2P', 'Apple SD Gothic Neo', sans-serif; /* í”½ì…€ ì•„íŠ¸ í°íŠ¸ ìš°ì„  */
        }

        body {
            background: var(--bg-color); color: var(--text-color);
            height: 100vh; overflow: hidden; /* ìŠ¤í¬ë¡¤ë°” ë°©ì§€ */
            display: flex; flex-direction: column;
        }

        /* í°íŠ¸ ì„ë² ë”© (Google Fontsì—ì„œ í”½ì…€ì•„íŠ¸ í°íŠ¸ ë¡œë“œ) */
        @import url('https://fonts.googleapis.com/css2?family=DotGothic16&family=Press+Start+2P&display=swap');

        /* ì‹œì‘ í™”ë©´ (ì´ì „ì²˜ëŸ¼ ìœ ì§€) */
        #splash {
            position: fixed; inset: 0; z-index: 1000;
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1518709268805-4e9042af9f23?q=80&w=1000&auto=format&fit=crop');
            background-size: cover; background-position: center;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
        }
        .start-btn { margin-top: 50vh; font-size: 1.2rem; font-weight: bold; animation: blink 1.5s infinite; text-shadow: 0 0 10px #000; }

        /* ë©”ì¸ ê²Œì„ ì»¨í…Œì´ë„ˆ */
        #game-container {
            display: none; /* JSë¡œ 'flex'ë¡œ ë³€ê²½ */
            flex-direction: column;
            height: 100%;
            padding: var(--safe-top) 10px var(--safe-bottom); /* ì „ì²´ ì—¬ë°± */
            background: var(--bg-color);
        }

        /* ìƒë‹¨ í—¤ë” & ìƒíƒœì°½ */
        .header-panel {
            background: var(--panel-bg); border: 2px solid var(--border-color);
            border-radius: 8px; margin-bottom: 10px; padding: 8px 10px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            font-size: 0.9rem;
        }
        .header-title { color: var(--accent-color); font-weight: bold; }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ (ë¡œê·¸ + ì´ë¯¸ì§€) */
        .main-content {
            flex: 1; /* ë‚¨ì€ ê³µê°„ ì°¨ì§€ */
            display: grid;
            grid-template-columns: 2fr 1fr; /* ë¡œê·¸ 2 / ì´ë¯¸ì§€ 1 */
            gap: 10px;
            margin-bottom: 10px;
        }

        /* ë¡œê·¸ íŒ¨ë„ (ì™¼ìª½) */
        .log-panel {
            background: var(--panel-bg); border: 2px solid var(--border-color);
            border-radius: 8px; padding: 10px; overflow-y: auto;
            display: flex; flex-direction: column-reverse; /* ìµœì‹  ë¡œê·¸ê°€ ìœ„ë¡œ */
            font-size: 0.8rem; line-height: 1.4;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .log-entry { margin-bottom: 5px; color: #d6c6b4; }
        .log-entry.event { color: var(--accent-color); font-weight: bold; }

        /* ì´ë¯¸ì§€ íŒ¨ë„ (ì˜¤ë¥¸ìª½) */
        .image-panel {
            background: var(--panel-bg); border: 2px solid var(--border-color);
            border-radius: 8px; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        #event-canvas {
            width: 100%; height: 100%;
            image-rendering: pixelated; /* í”½ì…€ ì•„íŠ¸ ë Œë”ë§ */
            background: #000;
        }

        /* í•˜ë‹¨ ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            background: var(--panel-bg); border: 2px solid var(--border-color);
            border-radius: 8px; padding: 10px;
            display: flex; flex-direction: column;
            gap: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        /* í–‰ë™ ë²„íŠ¼ ê·¸ë¦¬ë“œ */
        .action-grid {
            display: grid; grid-template-columns: 1fr 1fr; /* 2ì—´ */
            gap: 8px;
        }
        .action-btn {
            background: var(--button-color); color: var(--text-color);
            border: 1px solid var(--border-color); border-radius: 6px;
            padding: 12px; font-size: 0.9rem; font-weight: bold;
            text-align: center; cursor: pointer;
        }
        .action-btn:active { background: var(--button-hover); }

        /* í« í˜¸ê°ë„ ë°” */
        .pet-affection {
            margin-top: 5px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 0.8rem;
        }
        .progress-bar {
            flex-grow: 1; height: 10px; background: #333; border-radius: 5px; overflow: hidden;
            margin: 0 8px; border: 1px solid #555;
        }
        .progress-fill { height: 100%; background: var(--accent-color); transition: width 0.3s ease; }

        /* ê¸°íƒ€ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    </style>
</head>
<body onclick="handleGlobalClick()">

    <div id="splash">
        <h1 style="font-size: 3rem; color: var(--text-color);">EVERBLOOM</h1>
        <div style="color: var(--text-color); margin-top: 5px;">RUINS & FOREST</div>
        <div class="start-btn">í™”ë©´ì„ í„°ì¹˜í•˜ì—¬ ëª¨í—˜ ì‹œì‘</div>
    </div>

    <div id="game-container">
        <div class="header-panel">
            <span class="header-title">EVERBLOOM: EryStart</span>
            <span id="turn-display">í„´ 1</span>
        </div>

        <div class="main-content">
            <div class="log-panel" id="log-box">
                <div class="log-entry event">ëª¨í—˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
                <div class="log-entry">ì—ë²„ë¸”ë£¸ì˜ ê³ ëŒ€ ìˆ²ì´ ë‹¹ì‹ ì„ ë§ì´í•©ë‹ˆë‹¤.</div>
            </div>
            <div class="image-panel">
                <canvas id="event-canvas" width="128" height="128"></canvas>
            </div>
        </div>

        <div class="control-panel">
            <div class="action-grid">
                <button class="action-btn" onclick="takeAction('explore')">ğŸ” íƒí—˜</button>
                <button class="action-btn" onclick="takeAction('town')">ğŸ¡ ë§ˆì„</button>
                <button class="action-btn" onclick="takeAction('battle')">âš”ï¸ ì‚¬ê±´</button>
                <button class="action-btn" onclick="takeAction('pet')">ğŸ¾ í« êµê°</button>
            </div>
            <div class="pet-affection">
                <span>í« í˜¸ê°ë„</span>
                <div class="progress-bar"><div id="affection-fill" class="progress-fill" style="width: 50%;"></div></div>
                <span id="affection-value">50%</span>
            </div>
        </div>
    </div>

<script>
    let gameStarted = false;
    let currentTurn = 1;
    let petAffection = 50; // í« í˜¸ê°ë„ ì´ˆê¸°ê°’

    // ì´ë¯¸ì§€ ìƒì„± ëª¨ë¸ì— ë³´ë‚¼ ìš”ì²­ íƒœê·¸ë¥¼ í¬í•¨í•œ í”½ì…€ ì•„íŠ¸ ë°ì´í„°
    const pixelArtScenes = {
        'default': { type: 'tile', color: '#6a5e5c', description: 'trpg pixel art, ancient ruins in deep forest, wisteria, detailed, top-down view' },
        'explore': { type: 'tile', color: '#3b5f3d', description: 'trpg pixel art, adventurer finding ancient artifact in lush forest, detailed, side view' },
        'town': { type: 'tile', color: '#c08d4b', description: 'trpg pixel art, medieval town market, stalls, merchant, top-down view' },
        'battle': { type: 'tile', color: '#8d4b4b', description: 'trpg pixel art, battle scene, adventurer fighting orc, dark forest, side view' },
        'pet': { type: 'tile', color: '#5b8e72', description: 'trpg pixel art, adventurer playing with cute pet, green field, sunny, side view' }
    };

    function handleGlobalClick() {
        if (!gameStarted) {
            gameStarted = true;
            document.getElementById('splash').style.display = 'none';
            document.getElementById('game-container').style.display = 'flex';
            drawScene('default'); // ê²Œì„ ì‹œì‘ ì‹œ ê¸°ë³¸ ë°°ê²½ ê·¸ë¦¬ê¸°
        }
    }

    function addLogEntry(message, isEvent = false) {
        const logBox = document.getElementById('log-box');
        const entry = document.createElement('div');
        entry.className = `log-entry ${isEvent ? 'event' : ''}`;
        entry.textContent = message;
        logBox.prepend(entry); // ìµœì‹  ë¡œê·¸ê°€ ë§¨ ìœ„ë¡œ ì˜¤ë„ë¡
        // logBox.scrollTop = logBox.scrollHeight; // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
        if (logBox.children.length > 20) { // ë¡œê·¸ ìµœëŒ€ 20ê°œ ìœ ì§€
            logBox.removeChild(logBox.lastChild);
        }
    }

    function takeAction(actionType) {
        currentTurn++;
        document.getElementById('turn-display').textContent = `í„´ ${currentTurn}`;

        if (actionType === 'explore') {
            addLogEntry("ê¹Šì€ ìˆ² ì†ì„ íƒí—˜í•˜ì—¬ ê³ ëŒ€ ìœ ë¬¼ì˜ íŒŒí¸ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.", true);
            drawScene('explore');
        } else if (actionType === 'town') {
            addLogEntry("ë§ˆì„ ì‹œì¥ì—ì„œ í¬ê·€í•œ ì•½ì´ˆë¥¼ êµ¬ì…í–ˆìŠµë‹ˆë‹¤.");
            drawScene('town');
        } else if (actionType === 'battle') {
            addLogEntry("ê±°ëŒ€í•œ ìˆ²ì˜ ê´´ë¬¼ì´ ë‚˜íƒ€ë‚˜ ë‹¹ì‹ ì„ ê³µê²©í•©ë‹ˆë‹¤!", true);
            drawScene('battle');
        } else if (actionType === 'pet') {
            petAffection = Math.min(100, petAffection + 10);
            addLogEntry(`í«ê³¼ êµê°í–ˆìŠµë‹ˆë‹¤. í˜¸ê°ë„ê°€ ${petAffection}%ë¡œ ìƒìŠ¹!`);
            document.getElementById('affection-fill').style.width = petAffection + '%';
            document.getElementById('affection-value').textContent = petAffection + '%';
            drawScene('pet');
        }
    }

    function drawScene(sceneKey) {
        const scene = pixelArtScenes[sceneKey];
        if (!scene) return;

        const canvas = document.getElementById('event-canvas');
        const ctx = canvas.getContext('2d');
        const size = canvas.width; // 128
        ctx.clearRect(0, 0, size, size);

        // ê¸°ë³¸ ë°°ê²½ìƒ‰
        ctx.fillStyle = scene.color;
        ctx.fillRect(0, 0, size, size);
        
        // í”½ì…€ ì•„íŠ¸ ìŠ¤íƒ€ì¼ì˜ ë””í…Œì¼
        if (sceneKey === 'explore') {
            // ê°„ë‹¨í•œ ìœ ì  ë¬¸ì–‘
            ctx.fillStyle = '#a0908d';
            ctx.fillRect(size / 4, size / 2, size / 2, size / 4);
            ctx.fillRect(size / 4 + 10, size / 4, size / 2 - 20, size / 4);
        } else if (sceneKey === 'battle') {
            // ëª¬ìŠ¤í„° ì‹¤ë£¨ì—£
            ctx.fillStyle = '#6d2828';
            ctx.fillRect(size / 2 - 20, size / 2 - 30, 40, 60);
            ctx.fillStyle = '#ff0000';
            ctx.fillRect(size / 2 - 10, size / 2 - 20, 5, 5);
            ctx.fillRect(size / 2 + 5, size / 2 - 20, 5, 5);
        } else if (sceneKey === 'pet') {
            // í« ì‹¤ë£¨ì—£
            ctx.fillStyle = '#eab308';
            ctx.fillRect(size / 2 - 15, size / 2, 30, 30);
            ctx.fillRect(size / 2 - 10, size / 2 - 15, 20, 20);
            ctx.fillStyle = '#000';
            ctx.fillRect(size / 2 - 5, size / 2 - 5, 2, 2);
            ctx.fillRect(size / 2 + 3, size / 2 - 5, 2, 2);
        } else if (sceneKey === 'town') {
            // ì§‘ ì‹¤ë£¨ì—£
            ctx.fillStyle = '#a0a0a0';
            ctx.fillRect(size / 4, size / 2, size / 2, size / 4);
            ctx.fillStyle = '#808080';
            ctx.fillRect(size / 4, size / 2 - 15, size / 2, 15);
        }
        // ìµœì¢…ì ìœ¼ë¡œ ì´ë¯¸ì§€ ìƒì„± ëª¨ë¸ì— ìš”ì²­ì„ ë³´ë‚¼ ë•ŒëŠ” scene.description ì‚¬ìš©
        console.log("Image generation prompt:", scene.description); 
    }

    // ì´ˆê¸° ë¡œë“œ ì‹œ í« í˜¸ê°ë„ UI ì—…ë°ì´íŠ¸
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('affection-fill').style.width = petAffection + '%';
        document.getElementById('affection-value').textContent = petAffection + '%';
        drawScene('default'); // ê¸°ë³¸ í™”ë©´ ê·¸ë¦¬ê¸°
    });

</script>
</body>
</html>
