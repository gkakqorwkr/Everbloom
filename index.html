<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom Chronicles</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --safe-top: env(safe-area-inset-top);
            --rarity-ur: #ff4500; --rarity-sr: #da70d6; --rarity-s: #ffd700; --rarity-r: #1e90ff; --rarity-c: #aaaaaa;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* ì‹œì‘ í™”ë©´ (íƒ­ íˆ¬ ìŠ¤íƒ€íŠ¸) */
        #start-screen { position: fixed; inset: 0; z-index: 5000; background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.8)), url('https://images.unsplash.com/photo-1518709268805-4e9042af9f23?q=80&w=1000') center/cover; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; transition: 0.5s; }
        #start-screen h1 { font-size: 3rem; color: var(--accent); text-shadow: 0 0 20px rgba(212, 163, 115, 0.5); margin-bottom: 10px; }
        .blink { animation: blink 2s infinite; color: #fff; font-weight: bold; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* ì¢…ì¡± ì„ íƒ & ë¦¬ë¡¤ */
        #origin-screen { position: fixed; inset: 0; z-index: 4000; background: var(--bg); padding: 20px; overflow-y: auto; display: none; }
        .race-card { background: var(--panel); border: 1px solid var(--border); border-radius: 15px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; gap: 15px; }
        .race-img { width: 70px; height: 70px; border-radius: 10px; object-fit: cover; border: 1px solid var(--accent); }
        .reroll-section { background: #222; padding: 15px; border-radius: 10px; margin-top: 10px; text-align: center; border: 1px dashed var(--accent); }

        /* ë©”ì¸ UI */
        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-weight: bold; }
        .visual-frame { width: 100%; height: 32vh; position: relative; background: #000; border-bottom: 3px solid var(--accent); overflow: hidden; }
        #ui-bg { width: 100%; height: 100%; object-fit: cover; transition: 0.8s; filter: brightness(0.7); }
        #ui-char { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); height: 90%; z-index: 5; transition: 0.3s; filter: drop-shadow(0 0 15px black); }

        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); }
        .tab-btn { flex: 1; padding: 18px; border: none; background: none; color: #666; font-weight: bold; font-size: 15px; }
        .tab-btn.active { color: var(--accent); border-bottom: 3px solid var(--accent); }

        .content { flex: 1; overflow-y: auto; padding: 20px; }
        .log-entry { margin-bottom: 12px; font-size: 15px; line-height: 1.6; border-left: 3px solid var(--border); padding-left: 12px; animation: slideIn 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(-10px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* í« í•©ì„± UI */
        .pet-item { background: #1c1c1a; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #333; display: flex; align-items: center; gap: 12px; position: relative; }
        .pet-item.selected { border-color: var(--accent); background: #2a2a24; }
        .pet-badge { padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; color: #000; }

        footer { padding: 15px 15px calc(env(safe-area-inset-bottom) + 15px); background: var(--panel); border-top: 1px solid var(--border); }
        .action-btn { background: #2a2a26; color: white; padding: 16px; border-radius: 12px; border: 1px solid #444; font-weight: bold; font-size: 16px; width: 100%; margin-bottom: 8px; transition: 0.2s; }
        .action-btn:active { transform: scale(0.98); background: var(--accent); color: #000; }
        .action-btn:disabled { opacity: 0.5; }

        #gacha-overlay { display: none; position: fixed; inset: 0; z-index: 6000; background: rgba(0,0,0,0.95); align-items: center; justify-content: center; }
        .gacha-card { border: 2px solid var(--accent); padding: 30px; border-radius: 20px; background: #111; text-align: center; max-width: 300px; animation: pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes pop { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

    <div id="start-screen" onclick="game.showOrigin()">
        <h1>EVERBLOOM</h1>
        <p style="color: var(--accent); margin-bottom: 30px;">Chronicles</p>
        <p class="blink">TAP TO START</p>
    </div>

    <div id="origin-screen">
        <h2 style="text-align:center; color:var(--accent); margin-bottom:20px;">ëª¨í—˜ì˜ ì‹œì‘</h2>
        <div id="race-list"></div>
        <div class="reroll-section" id="reroll-box" style="display:none;">
            <p id="temp-stats" style="margin-bottom:10px;"></p>
            <button class="action-btn" onclick="game.rerollStats()">ğŸ² ë³´ë„ˆìŠ¤ ìŠ¤íƒ¯ ë¦¬ë¡¤</button>
            <button class="action-btn" style="background:var(--accent); color:#000;" onclick="game.confirmStart()">ì„ íƒ ì™„ë£Œ</button>
        </div>
    </div>

    <div id="gacha-overlay" onclick="this.style.display='none'">
        <div class="gacha-card">
            <h3 id="g-grade">ë“±ê¸‰</h3>
            <h2 id="g-name" style="margin: 15px 0;">ì´ë¦„</h2>
            <p id="g-desc" style="font-size:14px; color:#aaa;"></p>
        </div>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div><span id="ui-race" style="color:var(--accent)"></span> Lv.<span id="ui-lv">1</span></div>
            <div id="ui-day">Day 1 / 500</div>
        </header>

        <div class="visual-frame">
            <img id="ui-bg" src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000">
            <img id="ui-char" src="">
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" id="tab-l" onclick="game.tab('log')">EXPLORE</button>
            <button class="tab-btn" id="tab-s" onclick="game.tab('stat')">CHARACTER</button>
        </div>

        <div id="pane-log" class="content"></div>
        <div id="pane-stat" class="content" style="display:none;">
            <div id="basic-info" style="margin-bottom:15px; padding:15px; background:#222; border-radius:12px;"></div>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 style="color:var(--accent);">ë³´ìœ  í« (<span id="pet-cnt">0</span>)</h3>
                <button id="merge-btn" class="action-btn" style="width:auto; padding:5px 15px; font-size:12px;" onclick="game.tryMerge()" disabled>í•©ì„± ì‹¤í–‰ (2ë§ˆë¦¬ ì„ íƒ)</button>
            </div>
            <div id="pet-list"></div>
        </div>

        <footer>
            <div id="action-area" class="btn-stack"></div>
        </footer>
    </div>

<script>
// ì´ë¯¸ì§€ ì†ŒìŠ¤ ì •ì˜ (ê¹¨ì§ ë°©ì§€ìš© ê³ ì • ê²½ë¡œ)
const IMGS = {
    forest: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000",
    forge: "https://i.ibb.co/3sX8s8D/forge.png",
    battle: "https://images.unsplash.com/photo-1534447677768-be436bb09401?q=80&w=1000", // ì–´ë‘ìš´ ìˆ² ì „ê²½
    races: {
        Human: "https://i.ibb.co/vYm6p0v/hero-pixel.png",
        Elf: "https://i.ibb.co/qY7v6p0/thief-pixel.png",
        Orc: "https://i.ibb.co/vXy6p0v/golem-pixel.png",
        Beast: "https://i.ibb.co/6P0f9X8/lizard-pixel.png",
        Angel: "https://i.ibb.co/pXWdGqM/angel.png",
        Demon: "https://i.ibb.co/B2v8Z7t/demon.png"
    }
};

const RACES = [
    { id:'Human', name:'ì¸ê°„', str:10, agi:10, int:10, luk:10, hp:100 },
    { id:'Elf', name:'ì—˜í”„', str:5, agi:15, int:15, luk:5, hp:80 },
    { id:'Orc', name:'ì˜¤í¬', str:20, agi:5, int:2, luk:3, hp:180 },
    { id:'Beast', name:'ìˆ˜ì¸', str:14, agi:14, int:4, luk:8, hp:110 },
    { id:'Angel', name:'ì²œì‚¬', str:8, agi:8, int:15, luk:15, hp:100 },
    { id:'Demon', name:'ì•…ë§ˆ', str:18, agi:10, int:10, luk:2, hp:130 }
];

const PETS = [
    { id:1, name:"ê¸¸ê³ ì–‘ì´", grade:"COMMON", bonus:{luk:2}, desc:"ì‘ì€ í–‰ìš´ì„ ì£¼ëŠ” ê³ ì–‘ì´" },
    { id:2, name:"ê¼¬ë§ˆ ëŒê³¨ë ˜", grade:"COMMON", bonus:{str:2}, desc:"ì‘ì§€ë§Œ ë‹¨ë‹¨í•œ ë°”ìœ„" },
    { id:3, name:"íŒŒë€ í¬ë§", grade:"RARE", bonus:{hp:30, luk:5}, desc:"ë§ë‘ë§ë‘í•œ ì •ë ¹" },
    { id:4, name:"ë°”ëŒ ë‹¤ëŒì¥", grade:"RARE", bonus:{agi:10}, desc:"ëˆˆì— ë³´ì´ì§€ ì•Šì„ ë§Œí¼ ë¹ ë¦„" },
    { id:5, name:"ì§€ì˜¥ê²¬", grade:"SUPER", bonus:{str:15, agi:5}, desc:"ì‹¬ì—°ì—ì„œ ì˜¨ ì‚¬ëƒ¥ê°œ" },
    { id:6, name:"ë§ˆë‚˜ ë²„ì„¯", grade:"SUPER", bonus:{int:20}, desc:"ì§€ëŠ¥ì„ ë†’ì—¬ì£¼ëŠ” ì‹ ë¹„í•œ ë²„ì„¯" },
    { id:7, name:"ë² ì´ë¹„ ë“œë˜ê³¤", grade:"SUPER RARE", bonus:{str:25, hp:100}, desc:"ì ì¬ë ¥ì´ ì—„ì²­ë‚œ ìš©" },
    { id:8, name:"ì‹œê°„ì˜ ì •ë ¹", grade:"ULTRA RARE", bonus:{all:15}, desc:"ëª¨ë“  ìŠ¤íƒ¯ì„ ë¹„ì•½ì ìœ¼ë¡œ ìƒìŠ¹" }
];

const game = {
    p: { race:null, day:1, lv:1, exp:0, maxExp:100, gold:300, hp:100, maxHp:100, str:0, agi:0, int:0, luk:0, pets:[], selectedRace: null, tempBonus:{} },
    selectedPets: [],

    showOrigin() {
        document.getElementById('start-screen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('origin-screen').style.display = 'block';
            this.renderRaceList();
        }, 500);
    },

    renderRaceList() {
        const list = document.getElementById('race-list'); list.innerHTML = '';
        RACES.forEach(r => {
            const card = document.createElement('div'); card.className = 'race-card';
            card.innerHTML = `<img src="${IMGS.races[r.id]}" class="race-img"><div><b>${r.name}</b><br><small>STR:${r.str} AGI:${r.agi} INT:${r.int}</small></div>`;
            card.onclick = () => this.selectRace(r);
            list.appendChild(card);
        });
    },

    selectRace(race) {
        this.p.selectedRace = race;
        document.getElementById('reroll-box').style.display = 'block';
        this.rerollStats();
    },

    rerollStats() {
        const bonus = { str: rand(1,5), agi: rand(1,5), int: rand(1,5), luk: rand(1,5) };
        this.p.tempBonus = bonus;
        document.getElementById('temp-stats').innerHTML = `<span style="color:var(--accent)">ì´ˆê¸° ë³´ë„ˆìŠ¤:</span> STR+${bonus.str}, AGI+${bonus.agi}, INT+${bonus.int}, LUK+${bonus.luk}`;
    },

    confirmStart() {
        const r = this.p.selectedRace; const b = this.p.tempBonus;
        this.p.str = r.str + b.str; this.p.agi = r.agi + b.agi; this.p.int = r.int + b.int; this.p.luk = r.luk + b.luk;
        this.p.hp = r.hp; this.p.maxHp = r.hp;
        document.getElementById('origin-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        document.getElementById('ui-race').innerText = r.name;
        document.getElementById('ui-char').src = IMGS.races[r.id];
        this.renderActions();
        this.log("ì—ë²„ë¸”ë£¸ì˜ ìˆ²ì— ì²« ë°œì„ ë‚´ë””ë ìŠµë‹ˆë‹¤.");
    },

    tab(t) {
        document.getElementById('pane-log').style.display = t==='log'?'block':'none';
        document.getElementById('pane-stat').style.display = t==='stat'?'block':'none';
        document.getElementById('tab-l').className = t==='log'?'tab-btn active':'tab-btn';
        document.getElementById('tab-s').className = t==='stat'?'tab-btn active':'tab-btn';
        if(t==='stat') this.renderStats();
    },

    renderStats() {
        document.getElementById('basic-info').innerHTML = `â¤ï¸ HP: ${this.p.hp}/${this.p.maxHp} | ğŸ’° GOLD: ${this.p.gold}G | âœ¨ EXP: ${this.p.exp}/${this.p.maxExp}<br>âš”ï¸ STR: ${this.p.str} | ğŸƒ AGI: ${this.p.agi} | ğŸ§  INT: ${this.p.int} | ğŸ€ LUK: ${this.p.luk}`;
        const list = document.getElementById('pet-list'); list.innerHTML = '';
        document.getElementById('pet-cnt').innerText = this.p.pets.length;
        
        this.p.pets.forEach((pet, idx) => {
            const item = document.createElement('div');
            item.className = `pet-item ${this.selectedPets.includes(idx) ? 'selected' : ''}`;
            const gradeColor = `var(--rarity-${pet.grade.toLowerCase().split(' ').join('')})`;
            item.innerHTML = `
                <div style="background:${gradeColor}" class="pet-badge">${pet.grade}</div>
                <div><b>${pet.name}</b><br><small>${pet.desc}</small></div>
            `;
            item.onclick = () => this.togglePetSelect(idx);
            list.appendChild(item);
        });
    },

    togglePetSelect(idx) {
        const pos = this.selectedPets.indexOf(idx);
        if(pos > -1) this.selectedPets.splice(pos, 1);
        else if(this.selectedPets.length < 2) this.selectedPets.push(idx);
        document.getElementById('merge-btn').disabled = this.selectedPets.length !== 2;
        this.renderStats();
    },

    tryMerge() {
        const p1 = this.p.pets[this.selectedPets[0]];
        const p2 = this.p.pets[this.selectedPets[1]];
        
        // í•©ì„± ë¡œì§: ê°™ì€ ë“±ê¸‰ì´ë©´ ìƒìœ„ ë“±ê¸‰ í™•ë¥  ì¦ê°€
        this.log(`í« í•©ì„±ì„ ì‹œë„í•©ë‹ˆë‹¤: ${p1.name} + ${p2.name}`);
        
        // ë†’ì€ ì¸ë±ìŠ¤ì˜ í«ì„ ë¨¼ì € ì§€ì›Œì•¼ ë°°ì—´ ê¼¬ì„ ë°©ì§€
        const indices = [...this.selectedPets].sort((a,b) => b-a);
        indices.forEach(i => this.p.pets.splice(i, 1));
        this.selectedPets = [];

        // ê²°ê³¼ ê²°ì • (60% ìƒìœ„ ë“±ê¸‰, 40% ë™ì¼ ë“±ê¸‰ ëœë¤)
        const luck = Math.random();
        let resultPet;
        if(luck < 0.6) resultPet = PETS[Math.min(PETS.length-1, Math.max(p1.id, p2.id))];
        else resultPet = PETS[rand(0, PETS.length-1)];

        this.p.pets.push(resultPet);
        this.applyPetBonus(resultPet);
        this.showPopup("í•©ì„± ì„±ê³µ!", resultPet);
        this.renderStats();
    },

    renderActions() {
        const area = document.getElementById('action-area'); area.innerHTML = '';
        this.addBtn("ğŸŒ² ê¹Šì€ ìˆ² íƒí—˜ (Day +1)", () => this.explore());
        this.addBtn("â›º íœ´ì‹ ë° ëª…ìƒ", () => { this.p.hp = Math.min(this.p.maxHp, this.p.hp+40); this.nextDay(); this.log("ê¸°ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤."); });
        this.updateUI();
    },

    explore() {
        this.p.exp += (15 + Math.floor(this.p.int/2));
        this.checkLvUp();
        const roll = Math.random();
        if(roll < 0.25) this.enterForge();
        else if(roll < 0.55) this.battle();
        else this.log("ìˆ²ì€ ì¡°ìš©í•©ë‹ˆë‹¤. ë¬´ì‚¬íˆ í•˜ë£¨ê°€ ì§€ë‚¬ìŠµë‹ˆë‹¤.");
        this.nextDay();
    },

    battle() {
        document.getElementById('ui-bg').src = IMGS.battle;
        let dmg = Math.max(5, 25 - Math.floor(this.p.agi/2));
        this.p.hp -= dmg; this.p.gold += (50 + this.p.luk);
        this.log(`<span style="color:#ff5555">âš”ï¸ ì „íˆ¬ ëŒì…!</span> HP -${dmg}, ê³¨ë“œ +${50+this.p.luk}G`);
        if(this.p.hp <= 0) { alert("ì‚¬ë§í•˜ì…¨ìŠµë‹ˆë‹¤..."); location.reload(); }
        setTimeout(() => { document.getElementById('ui-bg').src = IMGS.forest; }, 1000);
    },

    enterForge() {
        this.log("âš’ï¸ ì‹ ë¹„ë¡œìš´ ëŒ€ì¥ê°„ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤.");
        document.getElementById('ui-bg').src = IMGS.forge;
        const area = document.getElementById('action-area'); area.innerHTML = '';
        this.addBtn("ğŸ¾ í« ê°€ì±  (300G)", () => this.gacha());
        this.addBtn("ğŸŒ² ë‹¤ì‹œ íƒí—˜í•˜ëŸ¬ ê°€ê¸°", () => { document.getElementById('ui-bg').src = IMGS.forest; this.renderActions(); });
    },

    gacha() {
        if(this.p.gold < 300) { this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); return; }
        this.p.gold -= 300;
        const r = Math.random() * 100;
        let p;
        if(r < 2) p = PETS[7]; else if(r < 8) p = PETS[6]; else if(r < 20) p = PETS[4]; else if(r < 50) p = PETS[2]; else p = PETS[0];

        this.p.pets.push(p);
        this.applyPetBonus(p);
        this.showPopup("í« íšë“!", p);
        this.updateUI();
    },

    applyPetBonus(p) {
        if(p.bonus.all) { this.p.str += p.bonus.all; this.p.agi += p.bonus.all; this.p.int += p.bonus.all; this.p.luk += p.bonus.all; }
        else { for(let s in p.bonus) { this.p[s] += p.bonus[s]; if(s==='hp') this.p.maxHp += p.bonus[s]; } }
    },

    showPopup(title, pet) {
        document.getElementById('g-grade').innerText = pet.grade;
        document.getElementById('g-name').innerText = pet.name;
        document.getElementById('g-desc').innerText = pet.desc;
        document.getElementById('gacha-overlay').style.display = 'flex';
    },

    nextDay() { this.p.day++; this.updateUI(); if(this.p.day > 500) alert("ì—¬ì •ì´ ëë‚¬ìŠµë‹ˆë‹¤."); },
    updateUI() { document.getElementById('ui-lv').innerText = this.p.lv; document.getElementById('ui-day').innerText = `Day ${this.p.day} / 500`; },
    log(m) { const p = document.getElementById('pane-log'); const d = document.createElement('div'); d.className = 'log-entry'; d.innerHTML = `> ${m}`; p.prepend(d); },
    addBtn(t, f) { const b = document.createElement('button'); b.className = 'action-btn'; b.innerText = t; b.onclick = f; document.getElementById('action-area').appendChild(b); },
    checkLvUp() { if(this.p.exp >= this.p.maxExp) { this.p.lv++; this.p.exp = 0; this.p.maxExp = Math.floor(this.p.maxExp * 1.2); this.log("ë ˆë²¨ì—…!"); } }
};

function rand(min, max) { return Math.floor(Math.random() * (max - min + 1)) + min; }
</script>
</body>
</html>
