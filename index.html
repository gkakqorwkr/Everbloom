<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom Chronicles</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --btn-bg: #2a2a26; --safe-top: env(safe-area-inset-top);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* ì‹œì‘ ë° ì„ íƒ í™”ë©´ */
        #start-screen { position: fixed; inset: 0; z-index: 5000; background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.9)), url('https://image.lexica.art/full_webp/cc2057ae-e069-450f-a2e6-a94b595bb919'); background-size: cover; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        #origin-screen { position: fixed; inset: 0; z-index: 4000; background: var(--bg); padding: 20px; overflow-y: auto; display: none; }
        .race-box { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 12px; cursor: pointer; }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 14px; }
        .visual-area { width: 100%; height: 35vh; position: relative; overflow: hidden; border-bottom: 2px solid var(--accent); }
        #bg-img { width: 100%; height: 100%; object-fit: cover; transition: 1s ease-in-out; }
        .location-tag { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.7); padding: 5px 12px; border-radius: 20px; border: 1px solid var(--accent); font-size: 12px; color: var(--accent); }

        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); overflow-x: auto; }
        .tab-btn { flex: 1; min-width: 80px; padding: 12px; border: none; background: none; color: #777; font-weight: bold; font-size: 12px; white-space: nowrap; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content { flex: 1; overflow-y: auto; padding: 15px; background: #111; }
        .log-line { margin-bottom: 6px; font-size: 14px; color: #ccc; border-left: 2px solid var(--border); padding-left: 10px; }
        
        /* ë„ê° ë° ì¸ë²¤í† ë¦¬ ìŠ¬ë¡¯ */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .slot { background: #1c1c1a; padding: 12px; border-radius: 8px; border: 1px solid #333; font-size: 13px; position: relative; }
        .slot.selected { border-color: var(--accent); background: #2a2a22; }
        .slot.locked { opacity: 0.4; filter: grayscale(1); }
        .type-tag { font-size: 9px; padding: 2px 4px; border-radius: 3px; background: #444; margin-right: 4px; }

        /* í•˜ë‹¨ ë²„íŠ¼ */
        footer { background: var(--panel); border-top: 1px solid var(--border); padding-bottom: env(safe-area-inset-bottom); }
        .action-container { max-height: 25vh; overflow-y: auto; padding: 12px 15px; display: flex; flex-direction: column; gap: 8px; }
        .btn { background: var(--btn-bg); color: #fff; padding: 15px; border-radius: 10px; border: 1px solid #444; font-weight: bold; text-align: center; cursor: pointer; }
        .btn:active { background: var(--accent); color: #000; }
    </style>
</head>
<body>

    <div id="start-screen" onclick="game.showOrigin()">
        <h1 class="start-title" style="color:var(--accent); font-size:32px; margin-bottom:10px;">Everbloom</h1>
        <p style="color:#aaa; margin-bottom:30px;">ê¸°ë¡ë˜ì§€ ì•Šì€ ì—°ëŒ€ê¸°</p>
        <div class="tap-msg" style="color:white; font-weight:bold;">íƒ­ í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</div>
    </div>

    <div id="origin-screen">
        <h2 style="text-align:center; color:var(--accent); margin-bottom:20px;">ì¶œì‹  ì„±ë¶„ì„ ê²°ì •í•˜ì‹­ì‹œì˜¤</h2>
        <div id="race-list"></div>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div>Lv.<span id="ui-lv">1</span> <span id="ui-race" style="color:var(--accent)"></span></div>
            <div id="ui-day">Day 1</div>
        </header>

        <div class="visual-area">
            <div id="loc-tag" class="location-tag">ì‹ ë¹„ë¡œìš´ ìˆ²</div>
            <img id="bg-img" src="">
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" onclick="game.tab('log', this)">ë¡œê·¸</button>
            <button class="tab-btn" onclick="game.tab('inv', this)">ê°€ë°©</button>
            <button class="tab-btn" onclick="game.tab('book_item', this)">ì¥ë¹„ë„ê°</button>
            <button class="tab-btn" onclick="game.tab('book_pet', this)">í«ë„ê°</button>
        </div>

        <div id="pane-log" class="main-content"></div>
        <div id="pane-inv" class="main-content" style="display:none;">
            <div id="stat-info" style="margin-bottom:15px; font-size:13px; border-bottom:1px solid #333; padding-bottom:10px;"></div>
            <div id="inv-list" class="grid"></div>
        </div>
        <div id="pane-book_item" class="main-content" style="display:none;"><div id="book-item-list" class="grid"></div></div>
        <div id="pane-book_pet" class="main-content" style="display:none;"><div id="book-pet-list" class="grid"></div></div>

        <footer>
            <div id="action-list" class="action-container"></div>
        </footer>
    </div>

<script>
const DATA = {
    locs: {
        forest: { name: "ì‹ ë¹„ë¡œìš´ ìˆ²", img: "https://image.lexica.art/full_webp/cc2057ae-e069-450f-a2e6-a94b595bb919" },
        sea: { name: "ì°½ê³µì˜ ë°”ë‹¤", img: "https://image.lexica.art/full_webp/1271317e-9777-4402-8611-37d3637e3d1c" },
        ruin: { name: "ìŠí˜€ì§„ ìœ ì ", img: "https://image.lexica.art/full_webp/7376c968-07e3-4770-bc0f-903429215096" },
        cave: { name: "ì‹¬ì—°ì˜ ë™êµ´", img: "https://image.lexica.art/full_webp/4594c798-1755-4672-8884-60ff868b1ee4" },
        village: { name: "ì•ˆì‹ì˜ ë§ˆì„", img: "https://image.lexica.art/full_webp/51351532-3580-4963-8a9d-b8733b1e967a" }
    },
    items: [
        { id:0, name: "ë…¹ìŠ¨ ë‹¨ê²€", stat: "ATK+5", price: 40 },
        { id:1, name: "ê°•ì²  ì¥ê²€", stat: "ATK+15", price: 200 },
        { id:2, name: "ê°€ì£½ ë§ˆë²•ë³´", stat: "DEF+8", price: 150 },
        { id:3, name: "ì˜ê´‘ì˜ ê°‘ì˜·", stat: "DEF+30", price: 800 },
        { id:4, name: "í˜„ìì˜ ì§€íŒ¡ì´", stat: "INT+25", price: 1200 }
    ],
    pets: [
        { id:0, name: "ë°”ëŒ ë‹¤ëŒì¥", stat: "AGI+5", price: 100 },
        { id:1, name: "í™”ì—¼ ìŠ¬ë¼ì„", stat: "ATK+8", price: 300 },
        { id:2, name: "ê³ ëŒ€ ëº˜ëº˜", stat: "LUK+15", price: 1000 },
        { id:3, name: "ê·¸ë¦¼ì í‘œë²”", stat: "AGI+20", price: 2500 }
    ]
};

const game = {
    p: { race:null, day:1, lv:1, exp:0, gold:500, hp:100, maxHp:100, inv:[], discoveredItems:[], discoveredPets:[] },
    loc: 'forest', mode: 'explore', selectedIdx: -1,

    showOrigin() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('origin-screen').style.display = 'block';
        const list = document.getElementById('race-list');
        [{n:'ìˆ˜ì¸', h:140}, {n:'í•˜í”Œë§', h:90}, {n:'ì²œì‚¬', h:110}, {n:'ì•…ë§ˆ', h:150}].forEach(r => {
            const d = document.createElement('div'); d.className = 'race-box';
            d.innerHTML = `<b>${r.n}</b><br><small>ì´ˆê¸° HP: ${r.h}</small>`;
            d.onclick = () => { this.p.race = r; this.start(); };
            list.appendChild(d);
        });
    },

    start() {
        this.p.hp = this.p.race.h; this.p.maxHp = this.p.race.h;
        document.getElementById('origin-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        document.getElementById('ui-race').innerText = this.p.race.n;
        this.updateLoc('forest');
        this.renderActions();
        this.log("ì„¸ìƒì˜ ëì—ì„œ ë‹¹ì‹ ì˜ ê¸°ë¡ì´ ì‹œì‘ë©ë‹ˆë‹¤.");
    },

    updateLoc(key) {
        this.loc = key;
        const info = DATA.locs[key];
        document.getElementById('loc-tag').innerText = info.name;
        document.getElementById('bg-img').src = info.img;
    },

    tab(t, el) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        ['log','inv','book_item','book_pet'].forEach(p => document.getElementById('pane-'+p).style.display = 'none');
        document.getElementById('pane-'+t).style.display = 'block';
        if(t === 'inv') this.renderInv();
        if(t.startsWith('book')) this.renderBook(t.split('_')[1]);
    },

    renderInv() {
        document.getElementById('stat-info').innerHTML = `â¤ï¸ HP: ${this.p.hp}/${this.p.maxHp} | ğŸ’° GOLD: ${this.p.gold}G`;
        const list = document.getElementById('inv-list'); list.innerHTML = '';
        this.p.inv.forEach((it, i) => {
            const d = document.createElement('div'); d.className = `slot ${this.selectedIdx === i ? 'selected' : ''}`;
            d.innerHTML = `<b>${it.name}</b><br><small>${it.stat}</small>`;
            d.onclick = () => { this.selectedIdx = (this.selectedIdx === i) ? -1 : i; this.renderInv(); };
            list.appendChild(d);
        });
    },

    renderBook(type) {
        const list = document.getElementById(`book-${type}-list`); list.innerHTML = '';
        const dataArr = type === 'item' ? DATA.items : DATA.pets;
        const discoveredArr = type === 'item' ? this.p.discoveredItems : this.p.discoveredPets;

        dataArr.forEach(obj => {
            const isFound = discoveredArr.includes(obj.id);
            const d = document.createElement('div'); d.className = `slot ${isFound ? '' : 'locked'}`;
            d.innerHTML = isFound ? `<b>${obj.name}</b><br><small>${obj.stat}</small>` : `<b>???</b><br><small>ë¯¸ë°œê²¬</small>`;
            list.appendChild(d);
        });
    },

    renderActions() {
        const area = document.getElementById('action-list'); area.innerHTML = '';
        if(this.loc !== 'village') {
            this.addBtn("ğŸ§­ ì£¼ë³€ íƒì‚¬ (Day+1)", () => this.explore());
            this.addBtn("â›º íœ´ì‹ (HP+30)", () => { this.p.hp = Math.min(this.p.maxHp, this.p.hp+30); this.nextDay(); this.log("ì•ˆì „í•œ ê³³ì„ ì°¾ì•„ íœ´ì‹í–ˆìŠµë‹ˆë‹¤."); });
        } else {
            this.addBtn("âš’ï¸ ëŒ€ì¥ê°„ (ì¥ë¹„ êµ¬ë§¤)", () => this.buy('item'));
            this.addBtn("ğŸ¾ í« ìƒì  (ë™ë£Œ ì˜ì…)", () => this.buy('pet'));
            this.addBtn("ğŸ’° ì†Œì§€í’ˆ íŒë§¤", () => this.sell());
            this.addBtn("ğŸŒ² ë§ˆì„ ë– ë‚˜ê¸°", () => { this.updateLoc('forest'); this.renderActions(); });
        }
    },

    explore() {
        const rand = Math.random();
        if(rand < 0.2) { this.updateLoc('village'); this.log("ğŸ° ì•ˆì‹ì˜ ë§ˆì„ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤."); }
        else {
            const locs = ['forest','sea','ruin','cave'];
            this.updateLoc(locs[Math.floor(Math.random()*locs.length)]);
            if(Math.random() < 0.3) this.log("ì „íˆ¬ê°€ ë°œìƒí–ˆì§€ë§Œ ë¬´ì‚¬íˆ ë„˜ê²¼ìŠµë‹ˆë‹¤.");
            else this.log(`${DATA.locs[this.loc].name}ì˜ ê¹Šì€ ê³³ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.`);
        }
        this.nextDay();
    },

    buy(type) {
        const pool = type === 'item' ? DATA.items : DATA.pets;
        const res = pool[Math.floor(Math.random()*pool.length)];
        const price = type === 'item' ? 150 : 300;
        if(this.p.gold >= price) {
            this.p.gold -= price;
            this.p.inv.push({...res, type});
            if(type === 'item' && !this.p.discoveredItems.includes(res.id)) this.p.discoveredItems.push(res.id);
            if(type === 'pet' && !this.p.discoveredPets.includes(res.id)) this.p.discoveredPets.push(res.id);
            this.log(`${res.name}ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤.`);
        } else { this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); }
    },

    sell() {
        if(this.selectedIdx > -1) {
            const it = this.p.inv[this.selectedIdx];
            const price = Math.floor(it.price * 0.6);
            this.p.gold += price;
            this.p.inv.splice(this.selectedIdx, 1);
            this.selectedIdx = -1;
            this.log(`${it.name}ì„(ë¥¼) íŒë§¤í•˜ì—¬ ${price}Gë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤.`);
            this.renderInv();
        } else { this.log("íŒë§¤í•  ë¬¼í’ˆì„ ê°€ë°©ì—ì„œ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”."); }
    },

    nextDay() { this.p.day++; document.getElementById('ui-day').innerText = `Day ${this.p.day}`; this.renderActions(); },
    log(m) {
        const p = document.getElementById('pane-log');
        const d = document.createElement('div'); d.className = 'log-line';
        d.innerText = `> ${m}`; p.prepend(d);
    },
    addBtn(t, f) {
        const b = document.createElement('div'); b.className = 'btn'; b.innerText = t; b.onclick = f;
        document.getElementById('action-list').appendChild(b);
    }
};
</script>
</body>
</html>
