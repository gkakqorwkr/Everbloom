<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>ì—ë²„ë¸Œë¦¼ : TRPG ì‹œë®¬ë ˆì´ì…˜</title>

<link rel="manifest" href="data:application/json,{
 &quot;name&quot;:&quot;ì—ë²„ë¸Œë¦¼ TRPG&quot;,
 &quot;short_name&quot;:&quot;ì—ë²„ë¸Œë¦¼&quot;,
 &quot;display&quot;:&quot;standalone&quot;,
 &quot;start_url&quot;:&quot;.&quot;
}">
<meta name="theme-color" content="#0f0f14">

<style>
body{
 margin:0;background:#0f0f14;color:#eee;
 font-family:system-ui;height:100dvh;
 display:flex;justify-content:center;align-items:center;
}
#game{
 width:100%;max-width:760px;height:100%;
 padding:14px;box-sizing:border-box;
 display:flex;flex-direction:column;
}
#log{
 flex:1;overflow-y:auto;
 background:#171720;padding:14px;
 border-radius:14px;
}
#choices{
 display:grid;grid-template-columns:repeat(2,1fr);
 gap:10px;margin-top:10px;
}
button{
 padding:16px;border:none;border-radius:14px;
 background:#2d2d44;color:white;
 font-size:16px;
}
button:active{transform:scale(.97)}
#status{
 margin-top:6px;font-size:12px;
 color:#aaa;text-align:center;
}
</style>
</head>

<body>
<div id="game">
 <div id="log"></div>
 <div id="choices"></div>
 <div id="status"></div>
</div>

<script>
// ================= SAVE =================
const SAVE="everbloom_full";
function save(){localStorage.setItem(SAVE,JSON.stringify(state))}
function load(){
 let d=localStorage.getItem(SAVE);
 if(d){state=JSON.parse(d);write("ğŸ”„ ì €ì¥ëœ ëª¨í—˜ ì¬ê°œ");return true}
 return false
}

// ================= STATE =================
let state={
 job:null,area:"ìˆ²",
 hp:100,food:60,gold:30,fame:0,moral:0,
 turn:0,
 inventory:[],
 companion:null,
 alive:true
}

const jobs={
 ì „ì‚¬:{bonus:20},
 ì •ì°°ì:{bonus:30},
 í•™ì:{bonus:25}
}

const areas={
 ìˆ²:["ìœ ì ","ë§ˆì„"],
 ìœ ì :["ìˆ²","í™©ë¬´ì§€"],
 ë§ˆì„:["ìˆ²"],
 í™©ë¬´ì§€:["ìœ ì "]
}

// ================= UI =================
const log=document.getElementById("log");
const choices=document.getElementById("choices");
const status=document.getElementById("status");

function write(t){
 log.innerHTML+=`â€¢ ${t}<br>`;
 log.scrollTop=log.scrollHeight;
}
function clear(){choices.innerHTML=""}
function btn(t,f){
 let b=document.createElement("button");
 b.textContent=t;b.onclick=f;
 choices.appendChild(b);
}
function update(){
 status.textContent=
 `ì§ì—…:${state.job||"-"} | ì§€ì—­:${state.area} | ì²´:${state.hp} | ì‹:${state.food} | ê¸ˆ:${state.gold} | ëª…:${state.fame} | ë„ë•:${state.moral}`
}

// ================= CORE =================
function roll(p){return Math.random()*100<p}

function chooseJob(){
 write("ë‹¹ì‹ ì€ ì–´ë–¤ ê¸¸ì„ ê±·ê² ëŠ”ê°€?");
 clear();
 Object.keys(jobs).forEach(j=>{
  btn(j,()=>{state.job=j;write(`${j} ì„ íƒ`);next()})
 })
}

function move(){
 clear();
 write("ì´ë™í•  ì§€ì—­ì„ ì„ íƒí•˜ë¼.");
 areas[state.area].forEach(a=>{
  btn(a,()=>{
   state.area=a;
   state.food-=10;
   write(`ğŸ—ºï¸ ${a}ë¡œ ì´ë™`);
   randomEvent();
   next();
  })
 })
}

function explore(){
 state.food-=8;state.turn++;
 write("ğŸ” íƒí—˜ ì¤‘...");
 let chance=40+jobs[state.job].bonus;
 if(roll(chance)){
  state.gold+=20;
  write("ë³´ë¬¼ ë°œê²¬");
  if(Math.random()<0.3){
   state.inventory.push("í¬ì…˜");
   write("í¬ì…˜ íšë“");
  }
 }else{
  state.hp-=20;
  write("í•¨ì • í”¼í•´");
 }
 next();
}

function event(){
 state.turn++;
 write("ğŸ“œ ì‚¬ê±´ ë°œìƒ");
 let r=Math.random();
 if(r<0.33){
  write("ì•½ìë¥¼ ë„ìš¸ ê¸°íšŒ");
  state.moral+=10;state.fame+=5;
 }else if(r<0.66){
  write("ì´ìµì„ ìœ„í•´ ë°°ì‹ ");
  state.moral-=10;state.gold+=15;
 }else{
  write("ì „íˆ¬ ë°œìƒ");
  if(state.companion && Math.random()<0.3){
   write("ğŸ’€ ë™ë£Œ ì „ì‚¬");
   state.companion=null;
  }
  state.hp-=15;
 }
 next();
}

function rest(){
 state.hp+=25;state.food-=5;
 write("ğŸ˜´ íœ´ì‹");
 next();
}

function useItem(){
 if(!state.inventory.length){write("ì•„ì´í…œ ì—†ìŒ");return}
 state.hp+=30;state.inventory.pop();
 write("í¬ì…˜ ì‚¬ìš©");
 next();
}

// ================= RANDOM =================
function randomEvent(){
 if(Math.random()<0.25){
  write("âš ï¸ ëŒë°œ ì´ë²¤íŠ¸!");
  event();
 }
}

// ================= ENDINGS =================
function checkEnding(){
 if(state.hp<=0||state.food<=0){
  write("â˜ ï¸ ìƒì¡´ ì‹¤íŒ¨ ì—”ë”©");
  end();return true
 }
 if(state.fame>=50){
  write("ğŸ‘‘ ì˜ì›… ì—”ë”©");
  end();return true
 }
 if(state.moral<=-30){
  write("ğŸ˜ˆ íƒ€ë½ ì—”ë”©");
  end();return true
 }
 return false
}

function end(){
 clear();
 btn("ì²˜ìŒë¶€í„°",()=>{
  localStorage.removeItem(SAVE);
  location.reload();
 })
}

// ================= FLOW =================
function next(){
 save();update();clear();
 if(checkEnding())return;

 btn("ì´ë™",move);
 btn("íƒí—˜",explore);
 btn("ì‚¬ê±´",event);
 btn("íœ´ì‹",rest);
 btn("ì•„ì´í…œ",useItem);
 btn("ì €ì¥",()=>{save();write("ğŸ’¾ ì €ì¥ë¨")});
}

// ================= INIT =================
write("ğŸ² ì—ë²„ë¸Œë¦¼ : TRPG ì‹œë®¬ë ˆì´ì…˜");
if(!load()) chooseJob();
else next();
update();
</script>
</body>
</html>
