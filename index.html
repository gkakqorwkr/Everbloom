<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Everbloom Studio</title>
    <style>
        :root {
            --bg-color: #0a1f1c;
            --panel-bg: rgba(20, 45, 40, 0.8);
            --accent-color: #2d6a4f;
            --text-color: #e9ecef;
            --glass-border: rgba(255, 255, 255, 0.1);
            --button-bg: #40916c;
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: linear-gradient(135deg, #0a1f1c 0%, #1b4332 100%);
            color: var(--text-color);
            min-height: 100vh;
            padding-bottom: calc(var(--safe-bottom) + 20px);
        }

        header { padding: calc(var(--safe-top) + 20px) 20px 10px; font-size: 1.5rem; font-weight: bold; }
        main { padding: 10px 20px; display: flex; flex-direction: column; gap: 15px; }

        .system-panel {
            background: var(--panel-bg);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 20px;
        }

        .canvas-container {
            width: 190px; height: 190px; 
            margin: 0 auto 15px; background: #000;
            border-radius: 15px; overflow: hidden;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        canvas { width: 100%; height: 100%; image-rendering: pixelated; }

        .input-field {
            width: 100%; background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border);
            border-radius: 10px; padding: 12px; color: #fff; margin-bottom: 10px; font-size: 1rem;
        }

        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        button {
            background: var(--button-bg); color: white; border: none; padding: 14px;
            border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.1s;
        }
        button:active { transform: scale(0.95); opacity: 0.8; }

        /* ìºë¦­í„° ìŠ¤íŠœë””ì˜¤ ë ˆì´ì–´ */
        #charStudio {
            display: none; position: fixed; inset: 0; z-index: 100;
            background: var(--bg-color); padding: calc(var(--safe-top) + 20px) 20px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

    <header>ğŸŒ¿ Everbloom</header>

    <main>
        <section class="system-panel">
            <div style="display:flex; justify-content:space-between;">
                <span>ğŸ§™ ìºë¦­í„°</span>
                <button id="btnOpenStudio" style="padding:5px 15px;">ìŠ¤íŠœë””ì˜¤</button>
            </div>
            <div id="charSummary" style="margin-top:10px; opacity:0.7;">ìƒì„±ëœ ìºë¦­í„° ì—†ìŒ</div>
        </section>

        <section class="system-panel">
            <div class="canvas-container"><canvas id="petCanvas" width="190" height="190"></canvas></div>
            <div id="petStatus" style="text-align:center; margin-bottom:10px;">Seed Beast | Lv.1</div>
            <div class="btn-group">
                <button id="btnFeedPet">ë¨¹ì´ì£¼ê¸°</button>
                <button id="btnBreedPet">ë¬´í•œ êµë°°</button>
            </div>
        </section>

        <section class="system-panel">
            <div class="canvas-container"><canvas id="monsterCanvas" width="190" height="190"></canvas></div>
            <textarea id="monsterPrompt" class="input-field" rows="2" readonly></textarea>
            <button id="btnGenMonster" style="width:100%">ëª¬ìŠ¤í„° ìƒì„±</button>
        </section>
    </main>

    <div id="charStudio">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
            <h2>ìºë¦­í„° ìƒì„±</h2>
            <button id="btnCloseStudio">ë‹«ê¸°</button>
        </div>
        
        <div class="canvas-container"><canvas id="charCanvas" width="190" height="190"></canvas></div>
        
        <input type="text" id="charName" class="input-field" placeholder="ì´ë¦„ ì…ë ¥...">
        
        <select id="speciesSelect" class="input-field">
            <option value="human">ì¸ê°„ (Human)</option>
            <option value="elf">ì—˜í”„ (Elf)</option>
            <option value="tiefling">í‹°í”Œë§ (Tiefling)</option>
            <option value="dragonborn">ë“œë˜ê³¤ë³¸ (Dragonborn)</option>
            <option value="catkin">ìˆ˜ì¸ (Cat-kin)</option>
            <option value="dwarf">ë“œì™€í”„ (Dwarf)</option>
            <option value="orc">ì˜¤í¬ (Orc)</option>
            <option value="aasimar">ì²œì‚¬ (Aasimar)</option>
        </select>

        <div class="btn-group">
            <select id="weaponSelect" class="input-field">
                <option value="katana">ì¹´íƒ€ë‚˜ (ë™ì–‘)</option>
                <option value="longsword">ë¡±ì†Œë“œ (ì„œì–‘)</option>
            </select>
            <select id="armorSelect" class="input-field">
                <option value="kimono">ê¸°ëª¨ë…¸ (ë™ì–‘)</option>
                <option value="plate">í”Œë ˆì´íŠ¸ (ì„œì–‘)</option>
            </select>
        </div>

        <textarea id="charPrompt" class="input-field" rows="3" readonly></textarea>
        
        <div class="btn-group">
            <button id="btnRerollChar">ë„íŠ¸ ë¦¬ë¡¤</button>
            <button id="btnSaveChar">ì €ì¥ ë° ë³µì‚¬</button>
        </div>
    </div>

    <script>
        // --- ë°ì´í„° ì •ì˜ ---
        const ASSETS = {
            species: {
                human: { color: '#ffd1dc', detail: 'fine skin, casual look' },
                elf: { color: '#f5f5dc', detail: 'long pointy ears, elegant' },
                tiefling: { color: '#ffb3b3', detail: 'demonic horns, glowing eyes' },
                dragonborn: { color: '#b3ffb3', detail: 'scales, draconic face' },
                catkin: { color: '#e0c9a6', detail: 'cat ears, whiskers' },
                dwarf: { color: '#d2b48c', detail: 'thick beard, sturdy' },
                orc: { color: '#94aa7b', detail: 'tusks, green skin' },
                aasimar: { color: '#fff9c4', detail: 'halo, shimmering eyes' }
            }
        };

        // --- ë„íŠ¸ ì—”ì§„ (190x190) ---
        const DotEngine = {
            draw: (canvasId, type, key, seed = Math.random()) => {
                const canvas = document.getElementById(canvasId);
                const ctx = canvas.getContext('2d');
                const S = 190;
                ctx.clearRect(0, 0, S, S);
                ctx.imageSmoothingEnabled = false;

                // ë°°ê²½ ì•ˆê°œ
                ctx.fillStyle = `hsla(${seed * 360}, 30%, 20%, 0.5)`;
                ctx.fillRect(0,0,S,S);

                // ë³¸ì²´ ê·¸ë¦¬ê¸°
                ctx.fillStyle = (type === 'char') ? ASSETS.species[key].color : `hsl(${seed*360}, 50%, 50%)`;
                
                if(type === 'char' || type === 'monster') {
                    ctx.fillRect(50, 40, 90, 110); // ê¸°ë³¸ ë°”ë””
                    ctx.fillStyle = 'rgba(0,0,0,0.3)';
                    ctx.fillRect(70, 70, 15, 15); ctx.fillRect(105, 70, 15, 15); // ëˆˆ
                } else if (type === 'pet') {
                    // í« ì§„í™” ë‹¨ê³„ë³„ í¬ê¸° ì¡°ì ˆ ë¡œì§ ì ìš© ê°€ëŠ¥
                    ctx.beginPath(); ctx.arc(95, 110, 40 + (seed*20), 0, Math.PI*2); ctx.fill();
                }
            }
        };

        // --- ì´ë²¤íŠ¸ ë°”ì¸ë”© (pointerup ìµœì í™”) ---
        function bind(id, fn) {
            const el = document.getElementById(id);
            if(el) el.addEventListener('pointerup', (e) => { e.preventDefault(); fn(); });
        }

        // --- ì‹œìŠ¤í…œ ë¡œì§ ---
        bind('btnOpenStudio', () => {
            document.getElementById('charStudio').style.display = 'block';
            DotEngine.draw('charCanvas', 'char', 'human');
        });

        bind('btnCloseStudio', () => document.getElementById('charStudio').style.display = 'none');

        bind('btnRerollChar', () => {
            const sp = document.getElementById('speciesSelect').value;
            DotEngine.draw('charCanvas', 'char', sp);
            
            // í”„ë¡¬í”„íŠ¸ ì—…ë°ì´íŠ¸
            const prompt = `Japanese anime, ${sp}, ${ASSETS.species[sp].detail}, Everbloom forest`;
            document.getElementById('charPrompt').value = prompt;
        });

        bind('btnGenMonster', () => {
            DotEngine.draw('monsterCanvas', 'monster', null);
            document.getElementById('monsterPrompt').value = "Japanese monster, beast, forest ruins, high detail";
        });

        // í« êµë°° ë° ì§„í™”
        let petLv = 1;
        bind('btnBreedPet', () => {
            petLv++;
            DotEngine.draw('petCanvas', 'pet', null, Math.random());
            document.getElementById('petStatus').innerText = `Evolved Beast | Lv.${petLv}`;
        });

        // ì´ˆê¸° ì‹¤í–‰
        window.onload = () => {
            DotEngine.draw('petCanvas', 'pet', null, 0.1);
            DotEngine.draw('monsterCanvas', 'monster', null, 0.5);
        };
    </script>
</body>
</html>
