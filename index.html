<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom Chronicles</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --btn-bg: #2a2a26; --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); color: var(--text); 
            height: 100vh; height: -webkit-fill-available;
            display: flex; flex-direction: column; overflow: hidden; 
        }

        #start-screen { position: fixed; inset: 0; z-index: 9999; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; cursor: pointer; }
        .title-main { font-size: 32px; color: var(--accent); font-weight: bold; letter-spacing: 2px; margin-bottom: 10px; }
        .title-sub { font-size: 16px; color: #888; margin-bottom: 40px; }
        .tap-msg { font-size: 14px; color: #fff; animation: blink 1.5s infinite; }

        #origin-screen { position: fixed; inset: 0; z-index: 9000; background: var(--bg); padding: 25px; padding-top: calc(var(--safe-top) + 20px); overflow-y: auto; display: none; }
        .race-card { background: var(--panel); border: 1px solid var(--border); padding: 20px; border-radius: 12px; margin-bottom: 15px; cursor: pointer; }

        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 14px; z-index: 100; flex-shrink: 0; }
        
        .visual-area { width: 100%; height: 25vh; position: relative; overflow: hidden; border-bottom: 2px solid var(--accent); flex-shrink: 0; }
        #bg-img { width: 100%; height: 100%; object-fit: cover; transition: 0.8s; }
        .location-tag { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); padding: 5px 12px; border-radius: 4px; border-left: 3px solid var(--accent); font-size: 12px; z-index: 10; }

        .equip-slots { display: flex; gap: 8px; padding: 10px; background: #111; justify-content: center; border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .equip-box { width: 30%; height: 45px; border: 1px solid var(--border); border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #666; background: rgba(255,255,255,0.03); }

        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; color: #666; font-weight: bold; font-size: 12px; cursor: pointer; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        /* ë¡œê·¸ ì°½ ìˆ˜ì • í•µì‹¬ ë¶€ë¶„ */
        .main-content { 
            flex: 1; 
            overflow-y: auto; 
            padding: 15px; 
            background: #0a0a0a; 
            -webkit-overflow-scrolling: touch; 
            overscroll-behavior: contain; /* ë¶€ëª¨ ìŠ¤í¬ë¡¤ ë°©í•´ ê¸ˆì§€ */
        }
        .log-line { margin-bottom: 8px; font-size: 13px; color: #ccc; border-left: 2px solid var(--border); padding-left: 10px; line-height: 1.6; animation: fadeIn 0.3s ease; }
        
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .slot { background: #1c1c1a; padding: 12px; border-radius: 8px; border: 1px solid #333; font-size: 12px; cursor: pointer; }
        .slot.selected { border-color: var(--accent); background: #2a2a22; }

        footer { 
            background: var(--panel); 
            border-top: 1px solid var(--border); 
            padding: 12px 15px calc(var(--safe-bottom) + 12px); 
            flex-shrink: 0; 
        }
        
        #action-list { 
            display: flex; 
            flex-direction: column; 
            gap: 8px; 
        }

        .scrollable-actions {
            max-height: 180px;
            overflow-y: auto;
            overscroll-behavior: contain;
        }

        .btn { background: var(--btn-bg); color: #fff; padding: 15px; border-radius: 10px; border: 1px solid #444; font-weight: bold; text-align: center; cursor: pointer; font-size: 14px; }
        .btn:active { background: var(--accent); color: #000; }
        .btn.choice { background: #3d3d34; border-color: var(--accent); }

        @keyframes fadeIn { from { opacity: 0; transform: translateX(-5px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div id="start-screen" onclick="game.showOrigin()">
        <div class="title-main">Everbloom</div>
        <div class="title-sub">ê¸°ë¡ë˜ì§€ ì•Šì€ ì—°ëŒ€ê¸°</div>
        <div class="tap-msg">íƒ­ í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</div>
    </div>

    <div id="origin-screen">
        <h2 style="text-align:center; color:var(--accent); margin-bottom:25px;">ì¢…ì¡±ì„ ì„ íƒí•˜ì‹­ì‹œì˜¤</h2>
        <div id="race-list"></div>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div>Lv.<span id="ui-lv">1</span> <span id="ui-race" style="color:var(--accent)"></span></div>
            <div id="ui-gold">ğŸ’° 500G</div>
        </header>

        <div class="visual-area">
            <div id="loc-tag" class="location-tag">ë¯¸ì§€ì˜ ìœ ì </div>
            <img id="bg-img" src="">
        </div>

        <div class="equip-slots">
            <div class="equip-box" id="eq-weapon"><b>WEAPON</b><span style="font-size:9px">Empty</span></div>
            <div class="equip-box" id="eq-armor"><b>ARMOR</b><span style="font-size:9px">Empty</span></div>
            <div class="equip-box" id="eq-pet"><b>PET</b><span style="font-size:9px">Empty</span></div>
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" onclick="game.tab('log', this)">ë¡œê·¸</button>
            <button class="tab-btn" onclick="game.tab('inv', this)">ê°€ë°©</button>
            <button class="tab-btn" onclick="game.tab('pet', this)">í«/í•©ì„±</button>
            <button class="tab-btn" onclick="game.tab('ency', this)">ë°±ê³¼ì‚¬ì „</button>
        </div>

        <div id="pane-log" class="main-content"></div>
        
        <div id="pane-inv" class="main-content" style="display:none;"><div id="inv-list" class="grid"></div></div>
        <div id="pane-pet" class="main-content" style="display:none;">
            <div style="font-size:11px; margin-bottom:10px; color:var(--accent)">* 2ë§ˆë¦¬ë¥¼ ì„ íƒí•˜ì—¬ í•©ì„±ì„ ì‹œë„í•˜ì„¸ìš”.</div>
            <div id="pet-list" class="grid"></div>
        </div>
        <div id="pane-ency" class="main-content" style="display:none;"><div id="ency-list" class="grid"></div></div>

        <footer>
            <div id="action-list"></div>
        </footer>
    </div>

<script>
// DBì™€ ê¸°ë³¸ ë°ì´í„°ëŠ” ë™ì¼
const DB = {
    races: [
        { id:'human', name:'ì¸ê°„', hp:100, desc:'ê· í˜• ì¡íŒ ìœ¡ì²´ì™€ ì ì‘ë ¥ì„ ê°€ì¡ŒìŠµë‹ˆë‹¤.' },
        { id:'elf', name:'ì—˜í”„', hp:80, desc:'ìì—°ê³¼ êµê°í•˜ë©° ë¯¼ì²©í•¨ì´ ë›°ì–´ë‚©ë‹ˆë‹¤.' },
        { id:'orc', name:'ì˜¤í¬', hp:150, desc:'ì••ë„ì ì¸ ì™„ë ¥ê³¼ ìƒì¡´ë ¥ì„ ìë‘í•©ë‹ˆë‹¤.' },
        { id:'beast', name:'ìˆ˜ì¸', hp:120, desc:'ì•¼ìƒì˜ ê°ê°ìœ¼ë¡œ ì¹˜ëª…íƒ€ìœ¨ì´ ë†’ìŠµë‹ˆë‹¤.' }
    ],
    locs: {
        ruin: { n: "ìŠí˜€ì§„ ìœ ì ", img: "https://image.lexica.art/full_webp/7376c968-07e3-4770-bc0f-903429215096" },
        forest: { n: "ì‹ ë¹„ë¡œìš´ ìˆ²", img: "https://image.lexica.art/full_webp/cc2057ae-e069-450f-a2e6-a94b595bb919" },
        sea: { n: "ì‹¬í•´ì˜ í•´ì•ˆ", img: "https://image.lexica.art/full_webp/1271317e-9777-4402-8611-37d3637e3d1c" },
        snow: { n: "ëˆˆ ë®ì¸ ê³ ì‚°", img: "https://image.lexica.art/full_webp/76508933-289b-433b-8263-547a06655a6d" },
        cave: { n: "ì‹¬ì—°ì˜ ë™êµ´", img: "https://image.lexica.art/full_webp/4594c798-1755-4672-8884-60ff868b1ee4" },
        village: { n: "ì•ˆì‹ì˜ ë§ˆì„", img: "https://image.lexica.art/full_webp/51351532-3580-4963-8a9d-b8733b1e967a" },
        forge: { n: "ë¶ˆíƒ€ëŠ” ëŒ€ì¥ê°„", img: "https://r.jina.ai/i/6f99f36f2f014e7a835a840e69882956" }
    },
    items: Array.from({length: 40}, (_, i) => ({
        id: i, type: i%2===0?'weapon':'armor',
        name: `${['ë‚¡ì€','ê°•ì² ','ìš©ì‚¬ì˜','ì˜ê²ì˜'][i%4]} ${i%2===0?'ê²€':'ê°‘ì˜·'}`,
        stat: i+5, desc: `ì—°ëŒ€ê¸° #${i} ì¥ë¹„.`, price: (i+1)*50
    })),
    pets: Array.from({length: 10}, (_, i) => ({
        id: i, name: `${['ì•„ê¸°','ìš©ê°í•œ'][i%2]} ${['ëŠ‘ëŒ€','ìŠ¬ë¼ì„','ë¶€ì—‰ì´'][i%3]}`,
        stat: i+1, desc: `í•¨ê»˜ ì—¬í–‰í•˜ëŠ” ë™ë£Œ.`, price: 300
    }))
};

const game = {
    p: { gold:500, hp:100, inv:[], pets:[], equip:{weapon:null, armor:null, pet:null}, found:new Set(), day:1 },
    loc: 'ruin',
    selPets: [],

    showOrigin() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('origin-screen').style.display = 'block';
        const list = document.getElementById('race-list');
        list.innerHTML = '';
        DB.races.forEach(r => {
            const d = document.createElement('div'); d.className = 'race-card';
            d.innerHTML = `<h3>${r.name}</h3><p style="font-size:12px; color:#aaa;">${r.desc}</p>`;
            d.onclick = () => { this.p.race = r; this.start(); };
            list.appendChild(d);
        });
    },

    start() {
        document.getElementById('origin-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        document.getElementById('ui-race').innerText = this.p.race.name;
        this.updateLocUI();
        this.log("ëª¨í—˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
        this.renderActions();
    },

    tab(t, el) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        ['log','inv','pet','ency'].forEach(p => document.getElementById('pane-'+p).style.display = 'none');
        document.getElementById('pane-'+t).style.display = 'block';
        if(t === 'inv') this.renderInv();
        if(t === 'pet') this.renderPets();
        if(t === 'ency') this.renderEncy();
    },

    renderInv() {
        const list = document.getElementById('inv-list'); list.innerHTML = '';
        this.p.inv.forEach((it, i) => {
            const isEq = (this.p.equip.weapon === it || this.p.equip.armor === it);
            const d = document.createElement('div'); d.className = `slot ${isEq ? 'selected' : ''}`;
            d.innerHTML = `<b>${it.name}</b><br><small>Stat +${it.stat}</small>`;
            d.onclick = () => this.toggleEquip(it);
            list.appendChild(d);
        });
    },

    toggleEquip(it) {
        if(this.p.equip[it.type] === it) this.p.equip[it.type] = null;
        else this.p.equip[it.type] = it;
        this.updateEquipUI();
        this.renderInv();
    },

    updateEquipUI() {
        document.getElementById('eq-weapon').querySelector('span').innerText = this.p.equip.weapon?.name || 'Empty';
        document.getElementById('eq-armor').querySelector('span').innerText = this.p.equip.armor?.name || 'Empty';
        document.getElementById('eq-pet').querySelector('span').innerText = this.p.equip.pet?.name || 'Empty';
    },

    renderPets() {
        const list = document.getElementById('pet-list'); list.innerHTML = '';
        this.p.pets.forEach((pt, i) => {
            const isSel = this.selPets.includes(i);
            const d = document.createElement('div'); d.className = `slot ${isSel ? 'selected' : ''}`;
            d.innerHTML = `<b>${pt.name}</b><br><small>í•©ì„± ì¬ë£Œ</small>`;
            d.onclick = () => {
                if(isSel) this.selPets = this.selPets.filter(idx => idx !== i);
                else if(this.selPets.length < 2) this.selPets.push(i);
                this.renderPets();
                this.renderActions();
            };
            list.appendChild(d);
        });
    },

    renderEncy() {
        const list = document.getElementById('ency-list'); list.innerHTML = '';
        DB.items.slice(0, 10).forEach(it => {
            const found = this.p.found.has(it.id);
            const d = document.createElement('div'); d.className = `slot ${found ? '' : 'locked'}`;
            d.innerHTML = found ? `<b>${it.name}</b>` : `<b>???</b>`;
            list.appendChild(d);
        });
    },

    renderActions() {
        const area = document.getElementById('action-list'); 
        area.innerHTML = '';
        
        if (this.loc === 'village' || this.loc === 'forge') {
            area.classList.add('scrollable-actions');
        } else {
            area.classList.remove('scrollable-actions');
        }

        if (this.loc === 'village') {
            this.addBtn("ğŸ›ï¸ ì—¬ê´€ (ì²´ë ¥ íšŒë³µ)", () => { this.p.hp = 100; this.log("ì—¬ê´€ì—ì„œ íœ´ì‹í–ˆìŠµë‹ˆë‹¤."); this.p.day++; });
            this.addBtn("âš’ï¸ ëŒ€ì¥ê°„ ë°©ë¬¸", () => { this.loc = 'forge'; this.updateLocUI(); this.renderActions(); });
            this.addBtn("ğŸ”® ì ìˆ ì§‘ (í« ê°€ì±  - 300G)", () => this.petGacha());
            this.addBtn("ğŸŒ² ë§ˆì„ ë– ë‚˜ê¸°", () => this.moveNext());
        } else if (this.loc === 'forge') {
            this.addBtn("ğŸ”¨ ì¥ë¹„ ì œì‘ (200G)", () => this.forge());
            this.addBtn("â¬…ï¸ ë§ˆì„ ê´‘ì¥ìœ¼ë¡œ", () => { this.loc = 'village'; this.updateLocUI(); this.renderActions(); });
        } else if (this.selPets.length === 2) {
            this.addBtn("ğŸ§¬ í« í•©ì„± ì‹¤í–‰", () => this.petFusion());
            this.addBtn("âŒ ì·¨ì†Œ", () => { this.selPets = []; this.renderPets(); this.renderActions(); });
        } else {
            this.addBtn("ğŸ§­ ì£¼ë³€ íƒì‚¬ (Day +1)", () => this.explore());
            this.addBtn("â›º íœ´ì‹í•˜ê¸°", () => { this.p.hp = Math.min(100, this.p.hp + 10); this.p.day++; this.log("ìº í”„ì—ì„œ íœ´ì‹í–ˆìŠµë‹ˆë‹¤."); });
        }
    },

    explore() {
        this.p.day++;
        if(Math.random() < 0.25) { 
            this.loc = 'village';
            this.updateLocUI();
            this.log("ğŸ° ì•ˆì‹ì˜ ë§ˆì„ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤.");
        } else {
            this.triggerEvent();
        }
        this.renderActions();
    },

    triggerEvent() {
        const events = [
            { 
                t: "ë„ì¿¨ì— ë’¤ë®ì¸ ê³ ëŒ€ ìœ ê³¨ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.",
                choices: [
                    { n: "ìœ ê³¨ì„ ìˆ˜ìƒ‰í•œë‹¤ (ìœ„í—˜)", r: () => Math.random() < 0.4 ? this.loot(1.0) : (this.p.hp -= 15, this.log("ğŸ’€ í•¨ì •ì— ê±¸ë ¤ ì²´ë ¥ì´ 15 ê°ì†Œí–ˆìŠµë‹ˆë‹¤!")) },
                    { n: "ì •ì¤‘íˆ ì•ˆì‹ì„ ë¹ˆë‹¤ (ì•ˆì „)", r: () => { this.p.hp = Math.min(100, this.p.hp + 5); this.log("ğŸ™ ì²´ë ¥ì´ 5 íšŒë³µë©ë‹ˆë‹¤."); }},
                    { n: "ìœ ê³¨ì˜ ë°˜ì§€ë¥¼ í›”ì¹œë‹¤ (100G)", r: () => { this.p.gold += 100; this.log("ğŸ’° 100Gë¥¼ ì±™ê²¼ìŠµë‹ˆë‹¤."); }}
                ]
            }
            // ... ë‹¤ë¥¸ ì´ë²¤íŠ¸ë“¤
        ];

        const ev = events[Math.floor(Math.random()*events.length)];
        this.log(`[ì´ë²¤íŠ¸] ${ev.t}`);
        const area = document.getElementById('action-list'); 
        area.innerHTML = '';
        area.classList.add('scrollable-actions');

        ev.choices.forEach(choice => {
            this.addBtn(choice.n, () => {
                choice.r();
                this.renderActions();
            }, true);
        });
    },

    moveNext() {
        const keys = ['ruin','forest','sea','snow','cave'];
        this.loc = keys[Math.floor(Math.random()*keys.length)];
        this.updateLocUI();
        this.log(`${DB.locs[this.loc].n}ìœ¼ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤.`);
        this.renderActions();
    },

    updateLocUI() {
        const info = DB.locs[this.loc];
        document.getElementById('loc-tag').innerText = info.n;
        document.getElementById('bg-img').src = info.img;
    },

    loot(chance) {
        if(Math.random() < chance) {
            const it = DB.items[Math.floor(Math.random()*DB.items.length)];
            this.p.inv.push(it);
            this.p.found.add(it.id);
            this.log(`âœ¨ ìœ ë¬¼ ë°œê²¬: [${it.name}]!`);
        } else {
            this.log("ìƒìê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
        }
    },

    forge() {
        if(this.p.gold >= 200) {
            this.p.gold -= 200;
            const it = DB.items[Math.floor(Math.random()*DB.items.length)];
            this.p.inv.push(it);
            this.p.found.add(it.id);
            this.log(`âš’ï¸ ì¥ë¹„ ì œì‘ ì™„ë£Œ: [${it.name}]`);
            document.getElementById('ui-gold').innerText = `ğŸ’° ${this.p.gold}G`;
        } else { this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); }
    },

    petGacha() {
        if(this.p.gold >= 300) {
            this.p.gold -= 300;
            const pt = DB.pets[Math.floor(Math.random()*DB.pets.length)];
            this.p.pets.push(pt);
            this.log(`ğŸ”® í« ë¶€í™”: [${pt.name}]`);
            document.getElementById('ui-gold').innerText = `ğŸ’° ${this.p.gold}G`;
        } else { this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤."); }
    },

    petFusion() {
        this.p.pets = this.p.pets.filter((_, i) => !this.selPets.includes(i));
        const newPet = DB.pets[0]; 
        this.p.pets.push(newPet);
        this.log(`ğŸ§¬ í•©ì„± ì„±ê³µ! ìƒˆë¡œìš´ ë™ë£Œ íƒ„ìƒ.`);
        this.selPets = [];
        this.tab('pet', document.querySelectorAll('.tab-btn')[2]);
    },

    // ìˆ˜ì •ëœ ë¡œê·¸ í•¨ìˆ˜
    log(m) {
        const p = document.getElementById('pane-log');
        const d = document.createElement('div'); d.className = 'log-line';
        d.innerText = `> ${m}`; 
        
        p.appendChild(d); // ì•„ë˜ì— ì¶”ê°€ (ì •ì„ì ì¸ ë¡œê·¸ ë°©ì‹)
        
        // ë¡œê·¸ê°€ 100ê°œ ë„˜ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì‚­ì œ (ì„±ëŠ¥ ìµœì í™”)
        if(p.childNodes.length > 100) p.removeChild(p.firstChild);
        
        // ìŠ¤í¬ë¡¤ì„ í•­ìƒ ì•„ë˜ë¡œ (ì‚¬ìš©ìê°€ ìˆ˜ë™ìœ¼ë¡œ ì˜¬ë¦´ ë•ŒëŠ” ë°©í•´í•˜ì§€ ì•ŠìŒ)
        // setTimeoutì„ ì‚¬ìš©í•˜ì—¬ ë Œë”ë§ í›„ ìŠ¤í¬ë¡¤ ê³„ì‚°
        setTimeout(() => {
            p.scrollTop = p.scrollHeight;
        }, 10);
    },
    
    addBtn(t, f, isChoice = false) {
        const b = document.createElement('div'); 
        b.className = isChoice ? 'btn choice' : 'btn';
        b.innerText = t; b.onclick = () => { f(); if(isChoice) this.renderActions(); };
        document.getElementById('action-list').appendChild(b);
    }
};
</script>
</body>
</html>
