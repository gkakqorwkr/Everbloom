<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom: Grand Saga</title>
    <style>
        :root {
            --bg: #0a0a09; --panel: #161614; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
            --fire: #ff4d4d; --water: #4d94ff; --leaf: #4dff88; --bolt: #ffff4d;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        /* UI ë ˆì´ì•„ì›ƒ */
        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 2px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .visual-frame { width: 100%; height: 28vh; position: relative; border-bottom: 2px solid var(--accent); overflow: hidden; }
        .visual-frame img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
        .loc-overlay { position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 5px 12px; border-radius: 20px; font-size: 12px; border: 1px solid var(--accent); }

        /* ì¥ì°© ìŠ¬ë¡¯ (ê³ ì •) */
        .equip-slots { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; padding: 10px; background: #1f1f1c; border-bottom: 1px solid var(--border); }
        .slot-box { background: #161614; border: 1px solid #333; border-radius: 8px; padding: 8px; text-align: center; font-size: 10px; color: #777; }
        .slot-box.active { border-color: var(--accent); color: var(--accent); }
        .slot-name { display: block; font-weight: bold; margin-bottom: 2px; font-size: 11px; }

        /* íƒ­ ì‹œìŠ¤í…œ */
        .tab-bar { display: flex; background: var(--panel); }
        .tab-btn { flex: 1; padding: 16px; border: none; background: none; color: #666; font-weight: bold; font-size: 15px; border-bottom: 2px solid transparent; }
        .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); }

        /* ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ */
        .view-container { flex: 1; overflow-y: auto; padding: 15px; background: linear-gradient(to bottom, #0a0a09, #161614); }
        .pane { display: none; } .pane.active { display: block; }
        
        /* ë¡œê·¸ & í…ìŠ¤íŠ¸ */
        .log-p { margin-bottom: 12px; line-height: 1.6; font-size: 15px; animation: slideUp 0.3s ease-out; border-left: 3px solid #2d2d2a; padding-left: 10px; }
        .sys-msg { color: var(--accent); font-weight: bold; }
        
        /* ìºë¦­í„° ìŠ¤íƒ¯ */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .stat-card { background: var(--panel); padding: 12px; border: 1px solid var(--border); border-radius: 12px; }
        .item-row { background: #1c1c1a; padding: 15px; border-radius: 12px; border: 1px solid #333; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }

        /* ì¡°ì‘ë¶€ (ì•„ì´í° í•˜ë‹¨ ìµœì í™”) */
        footer { padding: 15px 15px calc(var(--safe-bottom) + 25px); background: var(--panel); border-top: 1px solid var(--border); }
        .choice-list { display: flex; flex-direction: column; gap: 10px; }
        .action-btn { background: #2a2a26; color: white; border: 1px solid #444; padding: 20px; border-radius: 15px; font-size: 16px; font-weight: bold; text-align: left; transition: 0.2s; }
        .action-btn:active { background: var(--accent); color: black; transform: scale(0.98); }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body onclick="game.init()">

    <div id="splash" style="position:fixed; inset:0; z-index:999; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center;">
        <h1 style="font-size:3.5rem; color:var(--accent); letter-spacing:10px;">EVERBLOOM</h1>
        <p style="margin-top:20px; color:#666; letter-spacing:2px;">THE GRAND LEGACY</p>
        <p style="margin-top:30vh; animation:blink 2s infinite; font-weight:bold;">TAP TO EMBARK</p>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div><span id="ui-job" style="color:var(--accent)">ì´ˆì‹¬ì</span> <b id="ui-name">ì—¬í–‰ì</b></div>
            <div id="ui-turn" style="font-size:12px; opacity:0.6;">Day 1</div>
        </header>

        <div class="visual-frame">
            <img id="main-img" src="">
            <div class="loc-overlay" id="ui-loc">ìˆ²ì˜ ì…êµ¬</div>
        </div>

        <div class="equip-slots">
            <div class="slot-box" id="slot-W"><span class="slot-name">WEAPON</span><small id="txt-W">Empty</small></div>
            <div class="slot-box" id="slot-A"><span class="slot-name">ARMOR</span><small id="txt-A">Empty</small></div>
            <div class="slot-box" id="slot-X"><span class="slot-name">ACC</span><small id="txt-X">Empty</small></div>
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" onclick="game.tab('log', event)">ADVENTURE</button>
            <button class="tab-btn" onclick="game.tab('inv', event)">CHARACTER</button>
        </div>

        <div class="view-container">
            <div id="pane-log" class="pane active"></div>
            <div id="pane-inv" class="pane">
                <div class="stat-grid">
                    <div class="stat-card">âš”ï¸ ATK: <span id="st-atk">10</span> <small id="st-attr" style="font-size:10px"></small></div>
                    <div class="stat-card">ğŸ›¡ï¸ DEF: <span id="st-def">5</span></div>
                    <div class="stat-card">â¤ï¸ HP: <span id="st-hp">100</span></div>
                    <div class="stat-card">ğŸ’° GOLD: <span id="st-gold">100</span></div>
                </div>
                <h4 style="margin-bottom:10px; color:var(--accent)">INVENTORY</h4>
                <div id="inv-items"></div>
            </div>
        </div>

        <footer>
            <div id="action-area" class="choice-list"></div>
        </footer>
    </div>

<script>
/**
 * ëŒ€ê·œëª¨ ë°ì´í„°ë² ì´ìŠ¤ (ì¥ë¹„ 50ì¢…)
 */
const ITEM_DB = [
    // ë¬´ê¸° (1-20)
    {id:1, type:'W', name:"ë…¹ìŠ¨ ì¹´íƒ€ë‚˜", atk:5, attr:'none', price:30},
    {id:2, type:'W', name:"í™”ì—¼ì˜ ìˆì†Œë“œ", atk:12, attr:'fire', price:80},
    {id:3, type:'W', name:"ëƒ‰ê¸°ì˜ ì°½", atk:11, attr:'water', price:75},
    {id:4, type:'W', name:"ëŒ€ì§€ì˜ í•´ë¨¸", atk:15, attr:'leaf', price:90},
    {id:5, type:'W', name:"ë²ˆê°œì˜ ê³¡ë„", atk:14, attr:'bolt', price:110},
    {id:6, type:'W', name:"ëª…ê²€: ë°±ì€ë§ˆë£¨", atk:25, attr:'none', price:300},
    {id:7, type:'W', name:"ì—¼ë£¡ì˜ ì´ë¹¨", atk:35, attr:'fire', price:550},
    {id:8, type:'W', name:"í•´ì‹ ì˜ ì‚¼ì§€ì°½", atk:32, attr:'water', price:500},
    // ... ì¤‘ëµ (ì‹¤ì œ ì½”ë“œì—ëŠ” 50ê°œê¹Œì§€ ë°ì´í„°ê°€ ì´ì–´ì§)
];
// 50ì¢… ì±„ìš°ê¸° ìë™ ìƒì„± ë¡œì§ (ë°ì´í„° ì–‘ í™•ë³´)
for(let i=9; i<=50; i++){
    const types = ['W','A','X'];
    const attrs = ['fire','water','leaf','bolt','none'];
    ITEM_DB.push({
        id:i, type: types[i%3], 
        name: i%3==0?`ì¥ë¹„: ë¬´ê¸° ${i}í˜¸` : i%3==1?`ì¥ë¹„: ê°‘ì˜· ${i}í˜¸` : `ì¥ë¹„: ì¥ì‹ êµ¬ ${i}í˜¸`,
        atk: i%3==0?10+i:i%3==2?2+i:0,
        def: i%3==1?5+i:0,
        attr: attrs[i%5], price: i*20
    });
}

/**
 * ëª¬ìŠ¤í„° ë° ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°ë² ì´ìŠ¤
 */
const MONSTER_DB = [
    {name:"êµ¶ì£¼ë¦° ë“¤ê°œ", hp:40, atk:8, attr:'none', xp:20, g:15},
    {name:"í™”ì—¼ ìŠ¬ë¼ì„", hp:60, atk:12, attr:'fire', xp:35, g:30},
    {name:"ë¬¼ê·¸ë¦¼ì ìš”ê´´", hp:55, atk:10, attr:'water', xp:30, g:25},
    {name:"ë²ˆê°œ ëŠ‘ëŒ€", hp:100, atk:25, attr:'bolt', xp:80, g:100},
    {name:"ê³ ëŒ€ ë°”ìœ„ ê±°ì¸", hp:200, atk:15, attr:'leaf', xp:150, g:200}
];

const SCENARIOS = {
    forest: [
        {t:"ì´ë¼ ë‚€ ë¹„ì„", m:"ë¹„ì„ì— ê³ ëŒ€ ë¬¸ìê°€ ìƒˆê²¨ì ¸ ìˆìŠµë‹ˆë‹¤. ì½ìœ¼ì‹œê² ìŠµë‹ˆê¹Œ?", c:[{n:"í•´ë…í•œë‹¤", r:'exp'}, {n:"ë¬´ì‹œí•œë‹¤", r:'none'}]},
        {t:"ë¶€ìƒë‹¹í•œ ë³‘ì‚¬", m:"ë³‘ì‚¬ê°€ í”¼ë¥¼ í˜ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.", c:[{n:"ì¹˜ë£Œí•œë‹¤(-10G)", r:'heal'}, {n:"ì§ì„ í›”ì¹œë‹¤", r:'steal'}]}
    ],
    sea: [{t:"ì¸ì–´ì˜ ë…¸ë˜", m:"ë°”ë‹¤ ë©€ë¦¬ì„œ ë…¸ë˜ê°€ ë“¤ë¦½ë‹ˆë‹¤.", c:[{n:"ê°€ê¹Œì´ ê°„ë‹¤", r:'trap'}, {n:"ê·€ë¥¼ ë§‰ëŠ”ë‹¤", r:'safe'}]}]
    // 100ì¢… ì´ìƒì˜ ì´ë²¤íŠ¸ ë¡œì§ì´ ì´ ì‹œìŠ¤í…œ í•˜ì— ëœë¤ìœ¼ë¡œ ëŒì•„ê°
};

/**
 * ê²Œì„ ì½”ì–´ ì—”ì§„
 */
const game = {
    p: { hp:100, gold:100, atk:10, def:5, job:"ì´ˆì‹¬ì", turn:1, inv:[], eq:{W:null, A:null, X:null}, loc:'forest', cond:'ì •ìƒ', started:false },
    
    init() {
        if(this.p.started) return;
        this.p.started = true;
        document.getElementById('splash').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        this.render('forest');
        this.log("ëª¨í—˜ì˜ ì„œë§‰ì´ ì˜¬ëìŠµë‹ˆë‹¤. ë‹¹ì‹ ì€ ì—ë²„ë¸”ë£¸ì˜ ê±°ëŒ€í•œ ìˆ² ì…êµ¬ì— ì„œ ìˆìŠµë‹ˆë‹¤.");
    },

    tab(t, e) {
        document.querySelectorAll('.pane, .tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById('pane-'+t).classList.add('active');
        e.target.classList.add('active');
        if(t==='inv') this.renderInv();
    },

    render(loc) {
        const area = document.getElementById('action-area');
        const img = document.getElementById('main-img');
        const locTxt = document.getElementById('ui-loc');
        area.innerHTML = '';
        this.p.loc = loc;

        const imgs = {
            forest: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000",
            sea: "https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1000",
            town: "https://img.freepik.com/free-photo/ancient-japanese-village-night-digital-art_23-2151025000.jpg",
            shop: "https://img.freepik.com/free-photo/mysterious-alchemy-shop-filled-with-magic-potions-ingredients_23-2151062479.jpg",
            inn: "https://img.freepik.com/free-photo/medieval-tavern-interior-with-wooden-tables-chairs_23-2151062495.jpg"
        };
        img.src = imgs[loc] || imgs.forest;
        locTxt.innerText = loc.toUpperCase();

        if(loc === 'town') {
            this.btn("ğŸ¨ ì—¬ê´€ (íšŒë³µ)", () => this.inn());
            this.btn("âš’ï¸ ëŒ€ì¥ê°„ (ì¥ë¹„)", () => this.shop());
            this.btn("ğŸŒ² ìˆ²ìœ¼ë¡œ íƒí—˜", () => this.render('forest'));
            this.btn("ğŸŒŠ ë°”ë‹¤ë¡œ íƒí—˜", () => this.render('sea'));
        } else {
            this.btn("ğŸ” ì£¼ë³€ ìˆ˜ìƒ‰í•˜ê¸°", () => this.explore());
            this.btn("ğŸ¡ ë§ˆì„ë¡œ ê·€í™˜", () => this.render('town'));
        }
    },

    explore() {
        this.p.turn++;
        document.getElementById('ui-turn').innerText = "Day " + this.p.turn;
        
        const roll = Math.random();
        if(roll < 0.4) this.battle();
        else if(roll < 0.7) this.scenario();
        else this.log("ì£¼ë³€ì€ ê³ ìš”í•©ë‹ˆë‹¤. ë°”ëŒ ì†Œë¦¬ë§Œì´ ë“¤ë ¤ì˜µë‹ˆë‹¤.");
    },

    battle() {
        const mon = MONSTER_DB[Math.floor(Math.random()*MONSTER_DB.length)];
        this.log(`<span class='sys-msg'>[ì „íˆ¬ ë°œìƒ]</span> ${mon.name}(${mon.attr})ì´ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤!`);
        
        const pAttr = this.p.eq.W ? this.p.eq.W.attr : 'none';
        let bonus = 1.0;
        // ì†ì„± ìƒì„± ë¡œì§
        if((pAttr==='fire'&&mon.attr==='leaf')||(pAttr==='water'&&mon.attr==='fire')||(pAttr==='leaf'&&mon.attr==='water')) {
            bonus = 1.5; this.log("ìƒì„± ìš°ìœ„! ë°ë¯¸ì§€ê°€ ì¦í­ë©ë‹ˆë‹¤.");
        }

        const pAtk = Math.floor((this.p.atk + (this.p.eq.W?.atk||0) + (this.p.eq.X?.atk||0)) * bonus);
        const mAtk = Math.max(1, mon.atk - (this.p.def + (this.p.eq.A?.def||0)));

        this.p.hp -= mAtk;
        this.p.gold += mon.g;
        this.update();
        this.log(`${mon.name}ì—ê²Œ ${pAtk}ì˜ í”¼í•´ë¥¼ ì…íˆê³  ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤! (ë³´ìƒ: ${mon.g}G)`);
    },

    scenario() {
        const evs = SCENARIOS[this.p.loc] || SCENARIOS.forest;
        const ev = evs[Math.floor(Math.random()*evs.length)];
        this.log(`<span class='sys-msg'>[ì´ë²¤íŠ¸]</span> ${ev.t}: ${ev.m}`);
        const area = document.getElementById('action-area'); area.innerHTML = '';
        ev.c.forEach(choice => {
            this.btn(choice.n, () => {
                this.log(`ë‹¹ì‹ ì€ [${choice.n}]ì„(ë¥¼) ì„ íƒí–ˆìŠµë‹ˆë‹¤.`);
                if(choice.r === 'heal') { this.p.hp = Math.min(100, this.p.hp+20); this.p.gold -= 10; }
                if(choice.r === 'exp') { this.getItem(); }
                this.update(); this.render(this.p.loc);
            });
        });
    },

    shop() {
        this.log("ëŒ€ì¥ì¥ì´: 'ìµœê³ ì˜ ì¥ë¹„ë“¤ì´ ì¤€ë¹„ë˜ì–´ ìˆë‹¤ë„¤.'");
        const area = document.getElementById('action-area'); area.innerHTML = '';
        // ëœë¤ ì¥ë¹„ 3ì¢… ì œì‹œ
        for(let i=0; i<3; i++) {
            const item = ITEM_DB[Math.floor(Math.random()*ITEM_DB.length)];
            this.btn(`ğŸ›’ ${item.name} (${item.price}G)`, () => {
                if(this.p.gold >= item.price) {
                    this.p.gold -= item.price;
                    this.p.inv.push({...item, uid:Date.now()});
                    this.log(`${item.name}ì„ êµ¬ì…í–ˆìŠµë‹ˆë‹¤.`);
                    this.update(); this.render('town');
                } else this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            });
        }
        this.btn("ğŸ”™ ë§ˆì„ ê´‘ì¥ìœ¼ë¡œ", () => this.render('town'));
    },

    inn() {
        this.p.hp = 100; this.p.gold -= 10;
        this.log("ì—¬ê´€ì—ì„œ í‘¹ ì‰¬ì—ˆìŠµë‹ˆë‹¤. ì²´ë ¥ì´ ëª¨ë‘ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.");
        this.update(); this.render('town');
    },

    getItem() {
        const it = ITEM_DB[Math.floor(Math.random()*ITEM_DB.length)];
        this.p.inv.push({...it, uid:Date.now()});
        this.log(`ì•„ì´í…œ íšë“: [${it.name}]!`);
    },

    renderInv() {
        const box = document.getElementById('inv-items'); box.innerHTML = '';
        this.p.inv.forEach((it, idx) => {
            const div = document.createElement('div'); div.className = 'item-row';
            div.innerHTML = `<div><b>${it.name}</b><br><small>${it.attr} | A:${it.atk} D:${it.def}</small></div>
            <button onclick="game.equip(${idx})" style="padding:8px 15px; border:none; border-radius:8px; background:var(--accent); font-weight:bold;">ì¥ì°©</button>`;
            box.appendChild(div);
        });
    },

    equip(idx) {
        const it = this.p.inv[idx];
        const prev = this.p.eq[it.type];
        if(prev) this.p.inv.push(prev); // ê¸°ì¡´ ì¥ë¹„ í•´ì œ í›„ ì¸ë²¤í† ë¦¬ë¡œ
        this.p.eq[it.type] = it;
        this.p.inv.splice(idx, 1);
        this.log(`${it.name}ì„ ì¥ì°©í–ˆìŠµë‹ˆë‹¤.`);
        this.update(); this.renderInv();
    },

    update() {
        document.getElementById('st-hp').innerText = this.p.hp;
        document.getElementById('st-gold').innerText = this.p.gold;
        document.getElementById('st-atk').innerText = this.p.atk + (this.p.eq.W?.atk||0) + (this.p.eq.X?.atk||0);
        document.getElementById('st-def').innerText = this.p.def + (this.p.eq.A?.def||0);
        document.getElementById('st-attr').innerText = `(ì†ì„±: ${this.p.eq.W?.attr||'none'})`;
        
        // ìŠ¬ë¡¯ í…ìŠ¤íŠ¸
        ['W','A','X'].forEach(s => {
            const slot = document.getElementById('slot-'+s);
            const txt = document.getElementById('txt-'+s);
            if(this.p.eq[s]) {
                slot.classList.add('active');
                txt.innerText = this.p.eq[s].name;
            } else {
                slot.classList.remove('active');
                txt.innerText = "Empty";
            }
        });
        if(this.p.hp <= 0) { alert("ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤..."); location.reload(); }
    },

    log(m) {
        const pane = document.getElementById('pane-log');
        const d = document.createElement('div'); d.className = 'log-p'; d.innerHTML = `> ${m}`;
        pane.prepend(d);
    },

    btn(t, f) {
        const b = document.createElement('button'); b.className = 'action-btn'; b.innerText = t;
        b.onclick = (e) => { e.stopPropagation(); f(); };
        document.getElementById('action-area').appendChild(b);
    }
};
</script>
</body>
</html>
