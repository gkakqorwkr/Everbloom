<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Everbloom</title>

<style>
:root{
  --bg:#121212;
  --panel:#2a2a2a;
  --border:#3f3f3f;
  --accent:#d1a954;
  --text:#e0e0e0;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
  background:var(--bg);
  color:var(--text);
  height:100vh;
  overflow:hidden;
  font-family:-apple-system, BlinkMacSystemFont, system-ui, sans-serif;
  display:flex;
  flex-direction:column;
}

/* UI */
#game{
  flex:1;
  padding:env(safe-area-inset-top) 14px env(safe-area-inset-bottom);
  display:flex;
  flex-direction:column;
  gap:10px;
}
.visual{
  height:34vh;
  background:#000;
  border:2px solid var(--border);
  border-radius:14px;
  display:flex;
  justify-content:center;
  align-items:center;
}
canvas{
  width:100%;
  height:100%;
  image-rendering:pixelated;
}
.log{
  flex:1;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
  overflow-y:auto;
}
.log div{margin-bottom:6px;color:#aaa;}
.log .event{color:var(--accent);font-weight:600;}
.hud{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:14px;
  padding:12px;
}
.hud-top{
  display:flex;
  justify-content:space-between;
  font-size:.85rem;
}
.bar{
  height:8px;
  background:#111;
  border-radius:4px;
  overflow:hidden;
}
.bar > div{height:100%;background:var(--accent);}
.buttons{
  margin-top:10px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}
button{
  padding:16px;
  border-radius:12px;
  background:#3a3a3a;
  border:1px solid #555;
  color:#fff;
  font-weight:600;
}
</style>
</head>

<body>

<div id="game">
  <div class="visual">
    <canvas id="cv" width="360" height="240"></canvas>
  </div>

  <div class="log" id="log"></div>

  <div class="hud">
    <div class="hud-top">
      <span>ÌÑ¥ <b id="turn">1</b></span>
      <span>HP <b id="hp">100</b></span>
    </div>
    <div class="bar"><div id="hpBar" style="width:100%"></div></div>
    <div class="buttons">
      <button onclick="act('explore')">üîç ÌÉêÌóò</button>
      <button onclick="act('town')">üè° ÎßàÏùÑ</button>
      <button onclick="act('battle')">‚öîÔ∏è Ï†ÑÌà¨</button>
      <button onclick="act('pet')">üêæ ÍµêÍ∞ê</button>
    </div>
  </div>
</div>

<script>
/* =========================
   STATE
========================= */
let turn=1;
let hp=100;
let inBattle=false;
let enemyHp=0;

/* =========================
   CANVAS
========================= */
const cv=document.getElementById("cv");
const ctx=cv.getContext("2d");
ctx.imageSmoothingEnabled=false;

/* =========================
   UTIL
========================= */
function px(x,y,c){ctx.fillStyle=c;ctx.fillRect(x,y,1,1);}
function logMsg(msg,event=false){
  const d=document.createElement("div");
  d.className=event?"event":"";
  d.innerText="> "+msg;
  document.getElementById("log").prepend(d);
}

/* =========================
   PALETTE
========================= */
const PALETTE={
  t:null,
  g1:"#1b4332",
  g2:"#163a2b",
  g3:"#0f2e22",
  soil:"#0b1d14",
  skin:"#d7b38c",
  cloth:"#7c2f2f",
  eye:"#1b1b1b",
  orc:"#4a7c44",
  red:"#b00020"
};

/* =========================
   SPRITE DATA (Î∂ÑÎ¶¨ ÌïµÏã¨)
========================= */

/* 0 = transparent */
const HERO_SPRITE=[
"000111110000",
"001111111000",
"001122221000",
"001122221000",
"001100001000",
"001333333000",
"001333333000",
"001333333000",
"000033330000",
"000033330000"
];

const ORC_SPRITE=[
"001111111100",
"011111111110",
"011144441110",
"011144441110",
"011100001110",
"011111111110",
"001111111100"
];

/* =========================
   SPRITE RENDER
========================= */
function drawSprite(sprite,x,y,colorMap){
  for(let sy=0;sy<sprite.length;sy++){
    for(let sx=0;sx<sprite[sy].length;sx++){
      const key=sprite[sy][sx];
      if(key==="0") continue;
      px(x+sx,y+sy,colorMap[key]);
    }
  }
}

/* =========================
   DRAW
========================= */
function drawForest(){
  for(let y=0;y<240;y++){
    for(let x=0;x<360;x++){
      const r=(x+y)%3;
      px(x,y,[PALETTE.g1,PALETTE.g2,PALETTE.g3][r]);
    }
  }
  for(let y=200;y<240;y++)
    for(let x=0;x<360;x++)
      px(x,y,PALETTE.soil);
}

function render(){
  ctx.clearRect(0,0,360,240);
  drawForest();

  drawSprite(
    HERO_SPRITE,
    160,120,
    {
      "1":PALETTE.skin,
      "2":PALETTE.eye,
      "3":PALETTE.cloth
    }
  );

  if(inBattle){
    drawSprite(
      ORC_SPRITE,
      250,125,
      {
        "1":PALETTE.orc,
        "4":PALETTE.red
      }
    );
  }
}

/* =========================
   GAME LOGIC
========================= */
function act(type){
  turn++;
  document.getElementById("turn").innerText=turn;

  if(type==="explore"){
    inBattle=false;
    logMsg("Ïà≤ÏùÑ ÌÉêÌóòÌïòÎ©∞ Ïò§ÎûòÎêú Ïú†Ï†ÅÏùÑ Î∞úÍ≤¨ÌñàÏäµÎãàÎã§.",true);
  }

  if(type==="town"){
    inBattle=false;
    hp=Math.min(100,hp+20);
    logMsg("ÎßàÏùÑÏóêÏÑú Ìú¥ÏãùÏùÑ Ï∑®ÌñàÏäµÎãàÎã§.");
  }

  if(type==="pet"){
    inBattle=false;
    logMsg("Ìé´Í≥º ÍµêÍ∞êÌñàÏäµÎãàÎã§.");
  }

  if(type==="battle"){
    if(!inBattle){
      inBattle=true;
      enemyHp=30;
      logMsg("Ïà≤Ïùò Ïò§ÌÅ¨Í∞Ä ÎÇòÌÉÄÎÇ¨ÏäµÎãàÎã§!",true);
    }else{
      enemyHp-=15;
      hp-=10;
      logMsg("Ï†ÑÌà¨Í∞Ä Ïù¥Ïñ¥ÏßëÎãàÎã§!",true);
      if(enemyHp<=0){
        inBattle=false;
        logMsg("Ïò§ÌÅ¨Î•º Ï≤òÏπòÌñàÏäµÎãàÎã§!");
      }
    }
  }

  hp=Math.max(0,hp);
  document.getElementById("hp").innerText=hp;
  document.getElementById("hpBar").style.width=hp+"%";

  render();
}

/* INIT */
logMsg("ÏóêÎ≤ÑÎ∏îÎ£∏Ïùò Í≥†ÎåÄ Ïà≤Ïóê Îì§Ïñ¥ÏÑ∞ÏäµÎãàÎã§.",true);
render();
</script>

</body>
</html>
