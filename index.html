<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom Chronicles</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --btn-bg: #2a2a26; --safe-top: env(safe-area-inset-top);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* ì‹œì‘ í™”ë©´ */
        #start-screen { position: fixed; inset: 0; z-index: 5000; background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.8)), url('https://image.lexica.art/full_webp/cc2057ae-e069-450f-a2e6-a94b595bb919'); background-size: cover; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .start-title { font-size: 28px; font-weight: bold; color: var(--accent); margin-bottom: 40px; text-shadow: 0 2px 10px rgba(0,0,0,0.8); }
        .tap-msg { font-size: 16px; animation: blink 1.5s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        /* ë ˆì´ì•„ì›ƒ êµ¬ì„± */
        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 14px; z-index: 10; }
        .visual-area { width: 100%; height: 28vh; position: relative; background: #000; border-bottom: 2px solid var(--accent); overflow: hidden; flex-shrink: 0; }
        #char-img { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); height: 90%; z-index: 5; object-fit: contain; }
        #bg-img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.5); }

        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
        .tab-btn { flex: 1; padding: 12px; border: none; background: none; color: #777; font-weight: bold; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        /* ì¤‘ì•™ ë¡œê·¸/ì¸ë²¤í† ë¦¬ ì˜ì—­ (ìœ ë™ì  í™•ë³´) */
        .main-content { flex: 1; overflow-y: auto; padding: 15px; background: #111; }
        .log-line { margin-bottom: 6px; font-size: 14px; color: #ccc; border-left: 2px solid var(--border); padding-left: 10px; }
        
        /* ì¸ë²¤í† ë¦¬ ìŠ¤íƒ€ì¼ */
        .item-slot { background: #222; padding: 12px; border-radius: 8px; margin-bottom: 8px; border: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
        .item-slot.selected { border-color: var(--accent); background: #2a2a22; }

        /* í•˜ë‹¨ ì•¡ì…˜ ì˜ì—­ (ë²„íŠ¼ì´ ë§ì„ ê²½ìš° ë“œë˜ê·¸ ê°€ëŠ¥) */
        footer { background: var(--panel); border-top: 1px solid var(--border); padding-bottom: env(safe-area-inset-bottom); max-height: 40vh; display: flex; flex-direction: column; }
        .action-container { overflow-y: auto; padding: 10px 15px; display: flex; flex-direction: column; gap: 8px; }
        .btn { background: var(--btn-bg); color: #fff; padding: 14px; border-radius: 10px; border: 1px solid #444; font-weight: bold; text-align: center; cursor: pointer; }
        .btn:active { background: var(--accent); color: #000; }
        .btn:disabled { opacity: 0.3; }

        /* ì¢…ì¡± ì„ íƒ */
        #origin-screen { position: fixed; inset: 0; z-index: 4000; background: var(--bg); padding: 20px; overflow-y: auto; display: none; }
        .race-box { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
    </style>
</head>
<body>

    <div id="start-screen" onclick="game.showOrigin()">
        <div class="start-title">Everbloom Chronicles</div>
        <div class="tap-msg">íƒ­ í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</div>
    </div>

    <div id="origin-screen">
        <h2 style="text-align:center; color:var(--accent); margin-bottom:20px;">ì¶œì‹  ì¢…ì¡±ì„ ì„ íƒí•˜ì‹­ì‹œì˜¤</h2>
        <div id="race-list"></div>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div><span id="ui-race" style="color:var(--accent)"></span> Lv.<span id="ui-lv">1</span></div>
            <div id="ui-day">Day 1 / 500</div>
        </header>

        <div class="visual-area">
            <img id="bg-img" src="https://image.lexica.art/full_webp/51351532-3580-4963-8a9d-b8733b1e967a">
            <img id="char-img" src="">
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" onclick="game.tab('log', this)">íƒí—˜ ë¡œê·¸</button>
            <button class="tab-btn" onclick="game.tab('inv', this)">ì •ë³´/ì¸ë²¤í† ë¦¬</button>
        </div>

        <div id="pane-log" class="main-content"></div>
        <div id="pane-inv" class="main-content" style="display:none;">
            <div id="stat-info" style="margin-bottom:15px; font-size:13px; color:var(--accent);"></div>
            <h4 style="margin-bottom:10px; font-size:14px;">ë³´ìœ  ì¥ë¹„ (<span id="inv-count">0</span>/10)</h4>
            <div id="inv-list"></div>
        </div>

        <footer>
            <div id="action-list" class="action-container"></div>
        </footer>
    </div>

<script>
const ITEMS = [
    { name: "ë…¹ìŠ¨ ë‹¨ê²€", type: "ë¬´ê¸°", atk: 5, price: 40 },
    { name: "ê°€ì£½ ê°‘ì˜·", type: "ë°©ì–´êµ¬", def: 3, price: 60 },
    { name: "ì€ì œ ë°˜ì§€", type: "ì¥ì‹ êµ¬", luk: 2, price: 100 },
    { name: "ê°•ì²  ê²€", type: "ë¬´ê¸°", atk: 12, price: 200 },
    { name: "ê¸°ì‚¬ì˜ ê°‘ì˜·", type: "ë°©ì–´êµ¬", def: 10, price: 350 }
];

const game = {
    p: { race:null, day:1, lv:1, exp:0, gold:300, hp:100, maxHp:100, str:10, agi:10, luk:5, inv:[] },
    mode: 'forest', selectedIdx: -1,

    showOrigin() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('origin-screen').style.display = 'block';
        const list = document.getElementById('race-list');
        const races = [
            { id:'orc', name:'ì˜¤í¬', hp:150, str:15, agi:5, img:'https://image.lexica.art/full_webp/01017b2b-6d65-4f35-9c88-12d770512803' },
            { id:'elf', name:'ì—˜í”„', hp:80, str:7, agi:15, img:'https://image.lexica.art/full_webp/60183021-d779-4447-b50a-e373449c2505' },
            { id:'human', name:'ì¸ê°„', hp:100, str:10, agi:10, img:'https://image.lexica.art/full_webp/023193e3-a6b1-4f32-849c-f7267d30f551' }
        ];
        races.forEach(r => {
            const div = document.createElement('div'); div.className = 'race-box';
            div.innerHTML = `<img src="${r.img}" style="width:50px; border-radius:8px;"> <div><b>${r.name}</b><br><small>HP:${r.hp} STR:${r.str} AGI:${r.agi}</small></div>`;
            div.onclick = () => { this.p.race = r; this.start(); };
            list.appendChild(div);
        });
    },

    start() {
        this.p.hp = this.p.race.hp; this.p.maxHp = this.p.race.hp;
        this.p.str = this.p.race.str; this.p.agi = this.p.race.agi;
        document.getElementById('origin-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        document.getElementById('ui-race').innerText = this.p.race.name;
        document.getElementById('char-img').src = this.p.race.img;
        this.renderActions();
        this.log("ì—ë²„ë¸”ë£¸ì˜ ì—¬ì •ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.");
    },

    tab(type, el) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        document.getElementById('pane-log').style.display = type === 'log' ? 'block' : 'none';
        document.getElementById('pane-inv').style.display = type === 'inv' ? 'block' : 'none';
        if(type === 'inv') this.renderInv();
    },

    renderInv() {
        document.getElementById('stat-info').innerHTML = `â¤ï¸ HP: ${this.p.hp}/${this.p.maxHp} | âš”ï¸ STR: ${this.p.str} | ğŸ’° GOLD: ${this.p.gold}G`;
        const list = document.getElementById('inv-list'); list.innerHTML = '';
        document.getElementById('inv-count').innerText = this.p.inv.length;
        this.p.inv.forEach((item, i) => {
            const div = document.createElement('div');
            div.className = `item-slot ${this.selectedIdx === i ? 'selected' : ''}`;
            div.innerHTML = `<div><b>${item.name}</b><br><small>${item.type} | ê°€ì¹˜: ${Math.floor(item.price*0.6)}G</small></div>`;
            div.onclick = () => { this.selectedIdx = (this.selectedIdx === i) ? -1 : i; this.renderInv(); };
            list.appendChild(div);
        });
    },

    renderActions() {
        const area = document.getElementById('action-list'); area.innerHTML = '';
        if(this.mode === 'forest') {
            this.addBtn("ğŸŒ² ê¹Šì€ ìˆ² íƒí—˜ (Day+1)", () => this.explore());
            this.addBtn("ğŸ•ï¸ ìº í•‘ (HP+30)", () => { this.p.hp = Math.min(this.p.maxHp, this.p.hp+30); this.p.day++; this.update(); this.log("íœ´ì‹ì„ ì·¨í•´ ì²´ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤."); });
        } else if(this.mode === 'village') {
            this.addBtn("âš’ï¸ ëŒ€ì¥ê°„ (ì¥ë¹„ íšë“/ê°•í™”)", () => { this.mode = 'forge'; this.renderActions(); });
            this.addBtn("ğŸ›’ ì¡í™”ì  (ì¥ë¹„ íŒë§¤)", () => { this.mode = 'shop'; this.renderActions(); });
            this.addBtn("ğŸŒ² ë§ˆì„ ë– ë‚˜ê¸°", () => { this.mode = 'forest'; this.renderActions(); });
        } else if(this.mode === 'forge') {
            this.addBtn("ğŸ“¦ ë¬´ì‘ìœ„ ì¥ë¹„ ìƒì (150G)", () => {
                if(this.p.gold >= 150) {
                    this.p.gold -= 150;
                    const item = ITEMS[Math.floor(Math.random() * ITEMS.length)];
                    this.p.inv.push(item);
                    this.log(`${item.name}ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤!`); this.update();
                }
            });
            this.addBtn("â†©ï¸ ë§ˆì„ ê´‘ì¥ìœ¼ë¡œ", () => { this.mode = 'village'; this.renderActions(); });
        } else if(this.mode === 'shop') {
            this.addBtn("ğŸ’° ì„ íƒí•œ ì¥ë¹„ íŒë§¤", () => {
                if(this.selectedIdx > -1) {
                    const price = Math.floor(this.p.inv[this.selectedIdx].price * 0.6);
                    this.p.gold += price;
                    this.p.inv.splice(this.selectedIdx, 1);
                    this.selectedIdx = -1;
                    this.log(`${price}Gë¥¼ ë°›ê³  ì¥ë¹„ë¥¼ íŒë§¤í–ˆìŠµë‹ˆë‹¤.`);
                    this.renderInv(); this.update();
                } else { this.log("íŒë§¤í•  ì¥ë¹„ë¥¼ ì¸ë²¤í† ë¦¬ì—ì„œ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”."); }
            });
            this.addBtn("â†©ï¸ ë§ˆì„ ê´‘ì¥ìœ¼ë¡œ", () => { this.mode = 'village'; this.renderActions(); });
        }
    },

    explore() {
        this.p.day++;
        if(Math.random() < 0.2) {
            this.mode = 'village';
            this.log("ğŸ° ë§ˆì„ì— ë„ì°©í–ˆìŠµë‹ˆë‹¤.");
        } else {
            const exp = 20; this.p.exp += exp;
            if(this.p.exp >= 100) { this.p.lv++; this.p.exp=0; this.log("âœ¨ ë ˆë²¨ì—…!"); }
            this.log("í‰í™”ë¡œìš´ ìˆ²ì„ ìˆ˜ìƒ‰í–ˆìŠµë‹ˆë‹¤.");
        }
        this.update(); this.renderActions();
    },

    update() {
        document.getElementById('ui-lv').innerText = this.p.lv;
        document.getElementById('ui-day').innerText = `Day ${this.p.day} / 500`;
        if(this.mode === 'forest') document.getElementById('bg-img').src = "https://image.lexica.art/full_webp/cc2057ae-e069-450f-a2e6-a94b595bb919";
        else document.getElementById('bg-img').src = "https://image.lexica.art/full_webp/51351532-3580-4963-8a9d-b8733b1e967a";
    },

    log(m) {
        const p = document.getElementById('pane-log');
        const d = document.createElement('div'); d.className = 'log-line';
        d.innerText = `> ${m}`; p.prepend(d);
    },

    addBtn(t, f) {
        const b = document.createElement('div'); b.className = 'btn'; b.innerText = t; b.onclick = f;
        document.getElementById('action-list').appendChild(b);
    }
};
</script>
</body>
</html>
