<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom: Grand Saga</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #f1eae0;
            --border: #3d3d34; --safe-top: env(safe-area-inset-top); --safe-bottom: env(safe-area-inset-bottom);
            --fire: #ff5f5f; --water: #5fafff; --leaf: #5fff83; --bolt: #ffef5f;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; flex-direction: column; }

        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 2px solid var(--border); display: flex; justify-content: space-between; font-size: 13px; z-index: 10; }
        
        /* ë¹„ì£¼ì–¼ í”„ë ˆì„: ì „íˆ¬/ë°°ê²½ ì¼ëŸ¬ìŠ¤íŠ¸ */
        .visual-frame { width: 100%; height: 32vh; position: relative; border-bottom: 2px solid var(--accent); background: #000; overflow: hidden; }
        .bg-img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; position: absolute; }
        .monster-img { 
            position: absolute; bottom: 10%; right: 10%; height: 70%; 
            filter: drop-shadow(0 0 10px rgba(0,0,0,0.8)); transition: 0.3s; 
            z-index: 2; animation: float 3s infinite ease-in-out;
        }
        .player-img { position: absolute; bottom: 10%; left: 5%; height: 60%; z-index: 2; }
        
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        /* ìŠ¬ë¡¯ UI */
        .equip-slots { display: flex; justify-content: space-around; padding: 10px; background: #252520; border-bottom: 1px solid var(--border); font-size: 11px; gap: 5px; }
        .slot { flex: 1; text-align: center; color: #888; border: 1px solid #444; padding: 8px; border-radius: 8px; background: rgba(0,0,0,0.3); }
        .slot b { display: block; font-size: 9px; color: var(--accent); margin-bottom: 2px; }
        .slot.active { border-color: var(--accent); color: #fff; box-shadow: inset 0 0 5px var(--accent); }

        /* íƒ­ ë©”ì¸ */
        .view-container { flex: 1; overflow-y: auto; padding: 15px; background: linear-gradient(to bottom, #111, #000); }
        .log-entry { margin-bottom: 12px; line-height: 1.6; font-size: 15px; border-left: 3px solid var(--border); padding-left: 12px; animation: fadeIn 0.4s ease; }
        .sys-text { color: var(--accent); font-weight: bold; }

        /* ì•„ì´í…œ/ìŠ¤íƒ¯ */
        .stat-bar { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px; }
        .stat-box { background: var(--panel); padding: 12px; border-radius: 10px; border: 1px solid var(--border); font-size: 14px; }
        .item-card { background: #252520; padding: 15px; border-radius: 12px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #444; }

        /* ë²„íŠ¼ í•˜ë‹¨ ê³ ì • */
        footer { padding: 15px 15px calc(var(--safe-bottom) + 20px); background: var(--panel); border-top: 1px solid var(--border); }
        .choice-list { display: flex; flex-direction: column; gap: 10px; }
        .btn { background: #33332d; color: #fff; padding: 18px; border-radius: 15px; border: 1px solid #444; font-weight: bold; text-align: center; font-size: 16px; }
        .btn:active { background: var(--accent); color: #000; transform: scale(0.98); }
        
        .tab-nav { display: flex; border-bottom: 1px solid var(--border); }
        .tab-nav button { flex:1; padding:15px; background:none; border:none; color:#777; font-weight:bold; }
        .tab-nav button.active { color:var(--accent); border-bottom: 3px solid var(--accent); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body onclick="core.start()">

    <div id="splash" style="position:fixed; inset:0; z-index:100; background:#000; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h1 style="color:var(--accent); font-size: 2.5rem; letter-spacing: 5px;">EVERBLOOM</h1>
        <p style="margin-top:20px; color:#555;">RUINS & FOREST</p>
        <p style="margin-top:40px; animation:pulse 2s infinite">TAP TO START</p>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div id="p-header">LV.1 ì´ˆì‹¬ì</div>
            <div id="turn-display">DAY 1</div>
        </header>

        <div class="visual-frame">
            <img id="bg-view" class="bg-img" src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000">
            <img id="player-sprite" class="player-img" src="https://i.ibb.co/vYm6p0v/hero-pixel.png" style="display:none;">
            <img id="monster-sprite" class="monster-img" src="" style="display:none;">
        </div>

        <div class="equip-slots">
            <div class="slot" id="slot-W"><b>WEAPON</b><span id="txt-W">None</span></div>
            <div class="slot" id="slot-A"><b>ARMOR</b><span id="txt-A">None</span></div>
            <div class="slot" id="slot-X"><b>ACC</b><span id="txt-X">None</span></div>
        </div>

        <div class="tab-nav">
            <button id="btn-log" class="active" onclick="core.switchTab('log')">EXPLORE</button>
            <button id="btn-inv" onclick="core.switchTab('inv')">INVENTORY</button>
        </div>

        <div id="pane-log" class="view-container"></div>
        <div id="pane-inv" class="view-container" style="display:none;">
            <div class="stat-bar">
                <div class="stat-box">âš”ï¸ ATK: <span id="val-atk">10</span></div>
                <div class="stat-box">ğŸ›¡ï¸ DEF: <span id="val-def">5</span></div>
                <div class="stat-box">â¤ï¸ HP: <span id="val-hp">100</span></div>
                <div class="stat-box">ğŸ’° GOLD: <span id="val-gold">100</span></div>
            </div>
            <div id="inv-list"></div>
        </div>

        <footer>
            <div id="btn-area" class="choice-list"></div>
        </footer>
    </div>

<script>
/**
 * ëŒ€ê·œëª¨ ë°ì´í„°ë² ì´ìŠ¤ (ì´ë²¤íŠ¸ 50ê°œ ì´ìƒ, ëª¬ìŠ¤í„°, ì•„ì´í…œ)
 */
const DATA = {
    monsters: [
        {name:"ìˆ² ìŠ¬ë¼ì„", hp:40, atk:8, attr:"leaf", img:"https://i.ibb.co/3W6f9fP/slime-pixel.png"},
        {name:"í™”ì—¼ ë¦¬ìë“œ", hp:85, atk:15, attr:"fire", img:"https://i.ibb.co/6P0f9X8/lizard-pixel.png"},
        {name:"ê·¸ë¦¼ì ë„ì ", hp:60, atk:20, attr:"none", img:"https://i.ibb.co/qY7v6p0/thief-pixel.png"},
        {name:"ê³ ëŒ€ ë°”ìœ„ ê±°ì¸", hp:200, atk:12, attr:"leaf", img:"https://i.ibb.co/vXy6p0v/golem-pixel.png"},
        {name:"ë‡Œì „ë£¡ì˜ ìƒˆë¼", hp:120, atk:30, attr:"bolt", img:"https://i.ibb.co/wYy6p0v/dragon-pixel.png"}
    ],
    items: [
        {type:'W', name:"ë…¹ìŠ¨ ì¹´íƒ€ë‚˜", atk:10, attr:"none", price:50},
        {type:'W', name:"íƒœì–‘ì˜ ë¡±ì†Œë“œ", atk:25, attr:"fire", price:250},
        {type:'W', name:"í˜¹í•œì˜ ìŠ¤íƒœí”„", atk:22, attr:"water", price:230},
        {type:'A', name:"ê°€ì£½ ê°‘ì˜·", def:10, price:80},
        {type:'A', name:"í”Œë ˆì´íŠ¸ ë©”ì¼", def:25, price:300},
        {type:'X', name:"í–‰ìš´ì˜ ë°˜ì§€", atk:5, def:5, price:150},
        {type:'X', name:"ë²ˆê°œì˜ íœë˜íŠ¸", atk:15, attr:"bolt", price:400}
    ],
    // 50ê°œ ì´ìƒì˜ ëœë¤ ì´ë²¤íŠ¸ í…ìŠ¤íŠ¸
    events: [
        "ì˜¤ë˜ëœ ë¹„ì„ì—ì„œ ê³ ëŒ€ ì§€ì‹ì„ ìŠµë“í–ˆìŠµë‹ˆë‹¤. (ê³µê²©ë ¥ +1)",
        "ìˆ²ì˜ ì •ë ¹ì´ ë‚˜íƒ€ë‚˜ ë‹¹ì‹ ì˜ ìƒì²˜ë¥¼ ì¹˜ìœ í•´ì¤ë‹ˆë‹¤. (HP +20)",
        "ë²„ë ¤ì§„ ìƒìì—ì„œ ë‚¡ì€ ì£¼ë¨¸ë‹ˆë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤. (ê³¨ë“œ +30)",
        "ê°‘ìê¸° ìŸì•„ì§€ëŠ” ì†Œë‚˜ê¸°ì— ëª¸ì´ ë¬´ê±°ì›Œì§‘ë‹ˆë‹¤. (ì´ë™ ì§€ì—°)",
        "ì´ë¼ ë‚€ ë°”ìœ„ í‹ˆì—ì„œ ë°˜ì§ì´ëŠ” ê´‘ì„ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.",
        "ë©€ë¦¬ì„œ ëˆ„êµ°ê°€ì˜ ë¹„ëª… ì†Œë¦¬ê°€ ë“¤ë ¤ì˜µë‹ˆë‹¤. ê°€ë³´ì‹œê² ìŠµë‹ˆê¹Œ?",
        "ê¸¸ê°€ì— í•€ ì‹ ë¹„ë¡œìš´ ê½ƒ í–¥ê¸°ì— ì·¨í•´ ì ì‹œ íœ´ì‹ì„ ì·¨í•©ë‹ˆë‹¤.",
        "ê¹Œë§ˆê·€ í•œ ë§ˆë¦¬ê°€ ë‹¹ì‹ ì˜ ë¨¸ë¦¬ ìœ„ë¥¼ ë¶ˆê¸¸í•˜ê²Œ ë§´ë•ë‹ˆë‹¤.",
        "ë¶€ì„œì§„ ë§ˆì°¨ ë°”í€´ ì‚¬ì´ì—ì„œ ì“¸ë§Œí•œ ë¶€í’ˆì„ ì°¾ì•˜ìŠµë‹ˆë‹¤.",
        "ì „ì„¤ì ì¸ ëª¨í—˜ê°€ì˜ ë¬´ë¤ì„ ë°œê²¬í•´ ë¬µë…ì„ ì˜¬ë¦½ë‹ˆë‹¤.",
        "ìˆ² ê¹Šì€ ê³³ì—ì„œ ì‹ ë¹„í•œ í‘¸ë¥¸ ë¹›ì˜ í¬ìë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.",
        "ë°”ëŒì— ì‹¤ë ¤ì˜¨ ì€ì€í•œ ë¹µ ëƒ„ìƒˆê°€ ë‹¹ì‹ ì˜ ë°°ê¼½ì‹œê³„ë¥¼ ìš¸ë¦½ë‹ˆë‹¤.",
        "ëˆ„êµ°ê°€ ë‚˜ë¬´ì— ìƒˆê²¨ë†“ì€ ì§€ë„ ì¡°ê°ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.",
        "ì•¼ìƒ ë©§ë¼ì§€ê°€ ë‹¹ì‹ ì„ ìœ„í˜‘í–ˆì§€ë§Œ ë‹¤í–‰íˆ ë„ë§ê°”ìŠµë‹ˆë‹¤.",
        "ì˜¤ë˜ëœ ì—°ëª»ì˜ ë¬¼ì´ ë„ˆë¬´ ë§‘ì•„ ëª©ì„ ì¶•ì…ë‹ˆë‹¤. (ìµœëŒ€ HP +2)"
        // ... ì‹¤ì œ ì„œë¹„ìŠ¤ ì‹œ ë°°ì—´ì— 100ê°œê¹Œì§€ í™•ì¥ ê°€ëŠ¥
    ]
};

const core = {
    p: { hp:100, mhp:100, gold:100, atk:10, def:5, turn:1, inv:[], eq:{W:null,A:null,X:null}, started:false, loc:'forest' },

    start() {
        if(this.p.started) return;
        this.p.started = true;
        document.getElementById('splash').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        this.log("ëª¨í—˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. ì—ë²„ë¸”ë£¸ì˜ ìˆ²ì€ ìœ„í—˜ê³¼ ê¸°íšŒë¡œ ê°€ë“í•©ë‹ˆë‹¤.");
        this.renderForest();
    },

    switchTab(t) {
        document.getElementById('pane-log').style.display = t==='log'?'block':'none';
        document.getElementById('pane-inv').style.display = t==='inv'?'block':'none';
        document.getElementById('btn-log').className = t==='log'?'active':'';
        document.getElementById('btn-inv').className = t==='inv'?'active':'';
        if(t==='inv') this.renderInv();
    },

    renderForest() {
        this.p.loc = 'forest';
        const area = document.getElementById('btn-area'); area.innerHTML = '';
        document.getElementById('bg-view').src = "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=1000";
        document.getElementById('monster-sprite').style.display = 'none';

        this.addBtn("ğŸ” ê¹Šì€ ìˆ² íƒí—˜í•˜ê¸°", () => this.explore());
        this.addBtn("ğŸ§˜ ëª…ìƒí•˜ë©° íœ´ì‹", () => {
            this.p.hp = Math.min(this.p.mhp, this.p.hp + 10);
            this.log("ëª…ìƒì„ í†µí•´ ì •ì‹ ì„ ê°€ë‹¤ë“¬ê³  ì²´ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤.");
            this.nextTurn();
        });
    },

    explore() {
        this.nextTurn();
        const roll = Math.random();

        if(roll < 0.15) { // 15% í™•ë¥ ë¡œ ë§ˆì„ ë°œê²¬
            this.log("<span class='sys-text'>[ì´ë²¤íŠ¸]</span> ë©€ë¦¬ì„œ í™œê¸°ì°¬ ë§ˆì„ì˜ ì¢…ì†Œë¦¬ê°€ ë“¤ë¦½ë‹ˆë‹¤! ë§ˆì„ì— ì§„ì…í–ˆìŠµë‹ˆë‹¤.");
            this.renderTown();
        } else if(roll < 0.5) { // 35% í™•ë¥ ë¡œ ì „íˆ¬
            this.startBattle();
        } else { // 50% í™•ë¥ ë¡œ ëœë¤ ì´ë²¤íŠ¸
            const ev = DATA.events[Math.floor(Math.random()*DATA.events.length)];
            this.log(`> ${ev}`);
            this.renderForest();
        }
    },

    renderTown() {
        this.p.loc = 'town';
        const area = document.getElementById('btn-area'); area.innerHTML = '';
        document.getElementById('bg-view').src = "https://img.freepik.com/free-photo/ancient-japanese-village-night-digital-art_23-2151025000.jpg";
        
        this.addBtn("âš’ï¸ ëŒ€ì¥ê°„ (ì¥ë¹„ êµ¬ë§¤)", () => this.renderShop());
        this.addBtn("ğŸ¨ ì—¬ê´€ (ì „ì²´ íšŒë³µ - 20G)", () => {
            if(this.p.gold >= 20) {
                this.p.gold -= 20; this.p.hp = this.p.mhp;
                this.log("ì—¬ê´€ì—ì„œ í‘¹ ì‰¬ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  ì»¨ë””ì…˜ì´ íšŒë³µë˜ì—ˆìŠµë‹ˆë‹¤.");
                this.update();
            } else this.log("ëˆì´ ë¶€ì¡±í•´ ë…¸ìˆ™ì„ í–ˆìŠµë‹ˆë‹¤...");
        });
        this.addBtn("ğŸŒ² ë‹¤ì‹œ ìˆ²ìœ¼ë¡œ ë– ë‚˜ê¸°", () => this.renderForest());
    },

    renderShop() {
        const area = document.getElementById('btn-area'); area.innerHTML = '';
        this.log("ëŒ€ì¥ì¥ì´: 'ìµœê³ ì˜ ë¬¼ê±´ë“¤ë§Œ ëª¨ì•„ë’€ì§€. ê³¨ë“œë§Œ ì±™ê²¨ì˜¤ë¼êµ¬.'");
        
        // ëœë¤í•˜ê²Œ ì•„ì´í…œ 3ê°œ ì „ì‹œ
        for(let i=0; i<3; i++) {
            const it = DATA.items[Math.floor(Math.random()*DATA.items.length)];
            this.addBtn(`ğŸ›’ ${it.name} (${it.price}G)`, () => {
                if(this.p.gold >= it.price) {
                    this.p.gold -= it.price;
                    this.p.inv.push({...it, uid:Date.now()});
                    this.log(`${it.name}ì„(ë¥¼) êµ¬ì…í–ˆìŠµë‹ˆë‹¤!`);
                    this.update(); this.renderTown();
                } else this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
            });
        }
        this.addBtn("ğŸ”™ ë’¤ë¡œê°€ê¸°", () => this.renderTown());
    },

    startBattle() {
        const mon = DATA.monsters[Math.floor(Math.random()*DATA.monsters.length)];
        const mImg = document.getElementById('monster-sprite');
        mImg.src = mon.img;
        mImg.style.display = 'block';
        
        this.log(`<span style='color:red'>[ì „íˆ¬]</span> ê°•í•´ ë³´ì´ëŠ” ${mon.name}(${mon.attr})ì´ ì•ì„ ê°€ë¡œë§‰ìŠµë‹ˆë‹¤!`);
        
        const area = document.getElementById('btn-area'); area.innerHTML = '';
        this.addBtn("âš”ï¸ ì •ë©´ ëŒíŒŒ (ê³µê²©)", () => {
            const pAttr = this.p.eq.W ? this.p.eq.W.attr : 'none';
            let bonus = 1.0;
            if(pAttr==='fire' && mon.attr==='leaf') bonus = 1.6;
            if(pAttr==='water' && mon.attr==='fire') bonus = 1.6;
            if(pAttr==='leaf' && mon.attr==='water') bonus = 1.6;

            const pDmg = Math.floor((this.p.atk + (this.p.eq.W?.atk||0)) * bonus);
            const mDmg = Math.max(1, mon.atk - (this.p.def + (this.p.eq.A?.def||0)));

            this.p.hp -= mDmg;
            if(this.p.hp <= 0) { alert("ì‚¬ë§í•˜ì…¨ìŠµë‹ˆë‹¤..."); location.reload(); }
            
            this.p.gold += 30;
            this.log(`${mon.name}ì—ê²Œ ${pDmg}ì˜ í”¼í•´ë¥¼ ì…íˆê³  ìŠ¹ë¦¬í–ˆìŠµë‹ˆë‹¤! (+30G)`);
            this.update();
            this.renderForest();
        });
        this.addBtn("ğŸƒ ë„ë§ì¹˜ê¸°", () => {
            this.log("ë¹„ê²í•˜ì§€ë§Œ ëª©ìˆ¨ì€ ê±´ì¡ŒìŠµë‹ˆë‹¤. ìˆ²ì˜ ë‹¤ë¥¸ ê¸¸ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
            this.renderForest();
        });
    },

    renderInv() {
        const box = document.getElementById('inv-list'); box.innerHTML = '';
        this.p.inv.forEach((it, idx) => {
            const d = document.createElement('div'); d.className = 'item-card';
            d.innerHTML = `<div><b>${it.name}</b><br><small>${it.type} | ATK:${it.atk||0} DEF:${it.def||0}</small></div>
            <button class='btn' style='padding:8px 15px; font-size:12px;' onclick="core.equip(${idx})">ì¥ì°©</button>`;
            box.appendChild(d);
        });
    },

    equip(idx) {
        const it = this.p.inv[idx];
        const old = this.p.eq[it.type];
        if(old) this.p.inv.push(old);
        this.p.eq[it.type] = it;
        this.p.inv.splice(idx, 1);
        this.log(`${it.name}ì„(ë¥¼) ì¥ì°©í–ˆìŠµë‹ˆë‹¤.`);
        this.update(); this.renderInv();
    },

    nextTurn() {
        this.p.turn++;
        document.getElementById('turn-display').innerText = "DAY " + this.p.turn;
        this.update();
    },

    update() {
        document.getElementById('val-atk').innerText = this.p.atk + (this.p.eq.W?.atk||0) + (this.p.eq.X?.atk||0);
        document.getElementById('val-def').innerText = this.p.def + (this.p.eq.A?.def||0) + (this.p.eq.X?.def||0);
        document.getElementById('val-hp').innerText = `${this.p.hp}/${this.p.mhp}`;
        document.getElementById('val-gold').innerText = this.p.gold;
        
        ['W','A','X'].forEach(t => {
            const s = document.getElementById('slot-'+t);
            const txt = document.getElementById('txt-'+t);
            if(this.p.eq[t]) { s.classList.add('active'); txt.innerText = this.p.eq[t].name; }
            else { s.classList.remove('active'); txt.innerText = "Empty"; }
        });
    },

    log(m) {
        const p = document.getElementById('pane-log');
        const d = document.createElement('div'); d.className = 'log-entry'; d.innerHTML = m;
        p.prepend(d);
    },

    addBtn(t, f) {
        const b = document.createElement('button'); b.className = 'btn'; b.innerText = t;
        b.onclick = (e) => { e.stopPropagation(); f(); };
        document.getElementById('btn-area').appendChild(b);
    }
};
</script>
</body>
</html>
