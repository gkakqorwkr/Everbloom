<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --btn-bg: #2a2a26; --safe-top: env(safe-area-inset-top);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* 1. ì‹œì‘ í™”ë©´ (íƒ­ íˆ¬ ìŠ¤íƒ€íŠ¸) */
        #start-screen {
            position: fixed; inset: 0; z-index: 9999; background: #000;
            display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;
        }
        .title-main { font-size: 32px; color: var(--accent); font-weight: bold; letter-spacing: 2px; }
        .title-sub { font-size: 16px; color: #888; margin-top: 10px; margin-bottom: 40px; }
        .tap-msg { font-size: 14px; color: #fff; animation: blink 1.5s infinite; }

        /* 2. ë ˆì´ì•„ì›ƒ êµ¬ì¡° */
        #game-ui { display: none; height: 100%; flex-direction: column; }
        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 14px; }
        
        .visual-area { width: 100%; height: 25vh; position: relative; overflow: hidden; border-bottom: 2px solid var(--accent); }
        #bg-img { width: 100%; height: 100%; object-fit: cover; filter: brightness(0.8); image-rendering: pixelated; } /* ë„íŠ¸ ëŠë‚Œ ìœ ì§€ */

        /* 3. ì¥ë¹„ ì¥ì°© ìŠ¬ë¡¯ (ì´ë¯¸ì§€ 2ë²ˆ ë°˜ì˜) */
        .equip-slots { display: flex; gap: 8px; padding: 10px; background: #111; justify-content: center; }
        .equip-box { width: 30%; height: 60px; border: 1px solid var(--border); border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #666; background: rgba(255,255,255,0.03); }
        .equip-box.active { border-color: var(--accent); color: var(--accent); }
        .equip-box b { font-size: 11px; margin-bottom: 2px; }

        /* 4. íƒ­ ë°” */
        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); }
        .tab-btn { flex: 1; padding: 14px; border: none; background: none; color: #666; font-weight: bold; font-size: 12px; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }

        /* 5. ì½˜í…ì¸  ì˜ì—­ */
        .main-content { flex: 1; overflow-y: auto; padding: 15px; position: relative; }
        .log-line { margin-bottom: 6px; font-size: 13px; color: #ccc; border-left: 2px solid var(--border); padding-left: 8px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .slot { background: #1c1c1a; padding: 12px; border-radius: 8px; border: 1px solid #333; font-size: 12px; }
        .slot.selected { border-color: var(--accent); background: #2a2a22; }

        /* 6. í•˜ë‹¨ ë²„íŠ¼ (ì˜ë¦¼ ë°©ì§€) */
        footer { background: var(--panel); border-top: 1px solid var(--border); padding: 10px 15px calc(env(safe-area-inset-bottom) + 10px); }
        .btn { background: var(--btn-bg); color: #fff; padding: 14px; border-radius: 8px; border: 1px solid #444; font-weight: bold; text-align: center; margin-bottom: 8px; font-size: 14px; cursor: pointer; }
        .btn:active { background: var(--accent); color: #000; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body>

    <div id="start-screen" onclick="game.showRaceSelect()">
        <div class="title-main">Everbloom</div>
        <div class="title-sub">ê¸°ë¡ë˜ì§€ ì•Šì€ ì—°ëŒ€ê¸°</div>
        <div class="tap-msg">íƒ­ í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”</div>
    </div>

    <div id="origin-screen" style="display:none; position:fixed; inset:0; z-index:9000; background:var(--bg); padding:20px; overflow-y:auto;">
        <h2 style="text-align:center; margin:30px 0; color:var(--accent);">ì¢…ì¡±ì„ ì„ íƒí•˜ì‹­ì‹œì˜¤</h2>
        <div id="race-list"></div>
    </div>

    <div id="game-ui">
        <header>
            <div>Lv.<span id="ui-lv">1</span> <span id="ui-race" style="color:var(--accent)"></span></div>
            <div id="ui-gold">ğŸ’° 500G</div>
        </header>

        <div class="visual-area">
            <img id="bg-img" src="https://image.lexica.art/full_webp/76508933-289b-433b-8263-547a06655a6d"> </div>

        <div class="equip-slots">
            <div class="equip-box" id="slot-weapon"><b>WEAPON</b><span class="val">Empty</span></div>
            <div class="equip-box" id="slot-armor"><b>ARMOR</b><span class="val">Empty</span></div>
            <div class="equip-box" id="slot-pet"><b>PET</b><span class="val">Empty</span></div>
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" onclick="game.tab('log', this)">íƒí—˜ ë¡œê·¸</button>
            <button class="tab-btn" onclick="game.tab('inv', this)">ê°€ë°©/ì¥ë¹„</button>
            <button class="tab-btn" onclick="game.tab('pet', this)">ë‚˜ì˜ í«</button>
            <button class="tab-btn" style="background:#221e1a" onclick="game.tab('ency', this)">ë°±ê³¼ì‚¬ì „</button>
        </div>

        <div id="pane-log" class="main-content"></div>
        <div id="pane-inv" class="main-content" style="display:none;"><div id="inv-list" class="grid"></div></div>
        <div id="pane-pet" class="main-content" style="display:none;">
            <div style="font-size:11px; color:var(--accent); margin-bottom:10px;">* 2ë§ˆë¦¬ë¥¼ ì„ íƒí•˜ì—¬ í•©ì„±ì„ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
            <div id="pet-list" class="grid"></div>
        </div>
        <div id="pane-ency" class="main-content" style="display:none;">
            <div id="ency-progress-text" style="font-size:12px; margin-bottom:10px;"></div>
            <div id="ency-list" class="grid"></div>
        </div>

        <footer>
            <div id="action-list"></div>
        </footer>
    </div>

<script>
const DB = {
    races: [
        { id:'human', name:'ì¸ê°„', hp:100, img:'https://image.lexica.art/full_webp/3044a132-680c-4e8c-99d8-8f83060f04c6' },
        { id:'elf', name:'ì—˜í”„', hp:80, img:'https://image.lexica.art/full_webp/2a1a8c8e-3298-4228-8742-019d08657603' },
        { id:'orc', name:'ì˜¤í¬', hp:150, img:'https://image.lexica.art/full_webp/f0907e54-5221-4475-9c86-8f3b610c950a' }
    ],
    items: Array.from({length: 100}, (_, i) => ({
        id: i, type: i%2===0?'weapon':'armor',
        name: `${['ë…¹ìŠ¨','ê°•ì² ','ë§ˆë²•','ìš©ì‚¬ì˜'][i%4]} ${i%2===0?'ê²€':'ê°‘ì˜·'} +${Math.floor(i/4)}`,
        stat: (i+1)*2, desc: `ê¸°ë¡ #${i+1}: ì´ ì¥ë¹„ëŠ” ì—­ì‚¬ ì†ì— ì ë“¤ì–´ ìˆë˜ ìœ ë¬¼ì…ë‹ˆë‹¤.`, price: (i+1)*50
    })),
    pets: Array.from({length: 20}, (_, i) => ({
        id: i, name: `${['ì•„ê¸°','ì˜ë¦¬í•œ','ë¶ˆíƒ€ëŠ”'][i%3]} ${['ìŠ¬ë¼ì„','ëŠ‘ëŒ€','ê³ ì–‘ì´'][i%3]}`,
        stat: (i+1), desc: `ë‹¹ì‹ ì„ ë”°ë¥´ëŠ” ${i+1}ë²ˆì§¸ ë™ë£Œì…ë‹ˆë‹¤.`, price: 300
    })),
    events: ["ëˆˆë³´ë¼ê°€ ëª°ì•„ì¹˜ëŠ” ìˆ²ì„ ìˆ˜ìƒ‰í–ˆìŠµë‹ˆë‹¤.", "ëŒ€ì¥ê°„ì˜ ë§ì¹˜ ì†Œë¦¬ê°€ ë“¤ë ¤ì˜µë‹ˆë‹¤.", "ì˜¤ë˜ëœ ë¹„ì„ì—ì„œ ê³ ëŒ€ì˜ ê¸°ìš´ì´ ëŠê»´ì§‘ë‹ˆë‹¤."]
};

const game = {
    p: { race:null, gold:500, hp:100, inv:[], pets:[], equip:{weapon:null, armor:null, pet:null}, found:new Set() },
    selIdx: -1,

    showRaceSelect() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('origin-screen').style.display = 'block';
        const list = document.getElementById('race-list');
        DB.races.forEach(r => {
            const d = document.createElement('div'); d.className = 'btn';
            d.innerText = r.name;
            d.onclick = () => { this.p.race = r; this.start(); };
            list.appendChild(d);
        });
    },

    start() {
        document.getElementById('origin-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        document.getElementById('ui-race').innerText = this.p.race.name;
        this.log("ì—ë²„ë¸”ë£¸ì˜ ìˆ²ì— ì²« ë°œì„ ë‚´ë””ë ìŠµë‹ˆë‹¤. 500ì¼ì˜ ì‹œê°„ì´ ì£¼ì–´ì§‘ë‹ˆë‹¤.");
        this.renderActions();
    },

    tab(t, el) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        ['log','inv','pet','ency'].forEach(p => document.getElementById('pane-'+p).style.display = 'none');
        document.getElementById('pane-'+t).style.display = 'block';
        if(t === 'inv') this.renderInv();
        if(t === 'pet') this.renderPets();
        if(t === 'ency') this.renderEncy();
    },

    // ì¥ë¹„ ì°©ìš©/í•´ì œ ë¡œì§
    toggleEquip(idx) {
        const item = this.p.inv[idx];
        const type = item.type;
        if (this.p.equip[type] === item) {
            this.p.equip[type] = null;
            this.log(`${item.name}ì„(ë¥¼) í•´ì œí–ˆìŠµë‹ˆë‹¤.`);
        } else {
            this.p.equip[type] = item;
            this.log(`${item.name}ì„(ë¥¼) ì°©ìš©í–ˆìŠµë‹ˆë‹¤.`);
        }
        this.updateEquipUI();
        this.renderInv();
    },

    updateEquipUI() {
        document.getElementById('slot-weapon').querySelector('.val').innerText = this.p.equip.weapon?.name || 'Empty';
        document.getElementById('slot-armor').querySelector('.val').innerText = this.p.equip.armor?.name || 'Empty';
        document.getElementById('slot-pet').querySelector('.val').innerText = this.p.equip.pet?.name || 'Empty';
    },

    renderInv() {
        const list = document.getElementById('inv-list'); list.innerHTML = '';
        this.p.inv.forEach((it, i) => {
            const isEquipped = this.p.equip.weapon === it || this.p.equip.armor === it;
            const d = document.createElement('div'); d.className = `slot ${isEquipped ? 'selected' : ''}`;
            d.innerHTML = `<b>${it.name}</b><br><small>${it.type.toUpperCase()} / +${it.stat}</small>`;
            d.onclick = () => this.toggleEquip(i);
            list.appendChild(d);
        });
    },

    renderPets() {
        const list = document.getElementById('pet-list'); list.innerHTML = '';
        this.p.pets.forEach((p, i) => {
            const d = document.createElement('div'); d.className = 'slot';
            d.innerHTML = `<b>${p.name}</b><br><small>í•©ì„± ê°€ëŠ¥</small>`;
            list.appendChild(d);
        });
    },

    renderEncy() {
        const list = document.getElementById('ency-list'); list.innerHTML = '';
        DB.items.slice(0, 50).forEach(it => {
            const isFound = this.p.found.has(it.id);
            const d = document.createElement('div'); d.className = `slot ${isFound ? '' : 'locked'}`;
            d.style.opacity = isFound ? "1" : "0.3";
            d.innerHTML = isFound ? `<b>${it.name}</b><br><p style="font-size:10px;">${it.desc}</p>` : `<b>???</b>`;
            list.appendChild(d);
        });
    },

    explore() {
        const ev = DB.events[Math.floor(Math.random()*DB.events.length)];
        this.log(ev);
        if(Math.random() > 0.6) {
            const it = DB.items[Math.floor(Math.random()*DB.items.length)];
            this.p.inv.push(it);
            this.p.found.add(it.id);
            this.log(`ğŸ’ [${it.name}] íšë“!`);
        }
    },

    renderActions() {
        const area = document.getElementById('action-list'); area.innerHTML = '';
        this.addBtn("ğŸŒ² ê¹Šì€ ìˆ² íƒí—˜ (Day +1)", () => this.explore());
        this.addBtn("âš’ï¸ ëŒ€ì¥ê°„ ë°©ë¬¸ (ì¥ë¹„ êµ¬ë§¤)", () => {
            const it = DB.items[Math.floor(Math.random()*10)];
            if(this.p.gold >= 100) { this.p.gold -= 100; this.p.inv.push(it); this.log(`âš’ï¸ ${it.name} ì œì‘!`); }
            document.getElementById('ui-gold').innerText = `ğŸ’° ${this.p.gold}G`;
        });
    },

    log(m) {
        const p = document.getElementById('pane-log');
        const d = document.createElement('div'); d.className = 'log-line';
        d.innerText = `> ${m}`; p.prepend(d);
    },
    addBtn(t, f) {
        const b = document.createElement('div'); b.className = 'btn'; b.innerText = t; b.onclick = f;
        document.getElementById('action-list').appendChild(b);
    }
};
</script>
</body>
</html>
