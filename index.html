<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Everbloom Chronicles</title>
    <style>
        :root {
            --bg: #0d0d0c; --panel: #1a1a17; --accent: #d4a373; --text: #e0dcd3;
            --border: #3d3d34; --btn-bg: #2a2a26; --safe-top: env(safe-area-inset-top);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Apple SD Gothic Neo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* í—¤ë” ë° ë°°ê²½ */
        header { padding: calc(var(--safe-top) + 10px) 20px 10px; background: var(--panel); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; font-size: 14px; z-index: 100; }
        .visual-area { width: 100%; height: 30vh; position: relative; overflow: hidden; border-bottom: 2px solid var(--accent); flex-shrink: 0; }
        #bg-img { width: 100%; height: 100%; object-fit: cover; transition: 0.8s; }
        .location-tag { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.8); padding: 5px 12px; border-radius: 4px; border-left: 3px solid var(--accent); font-size: 12px; }

        /* íƒ­ ì‹œìŠ¤í…œ */
        .tab-bar { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); overflow-x: auto; flex-shrink: 0; }
        .tab-btn { flex: 1; min-width: 70px; padding: 14px; border: none; background: none; color: #666; font-weight: bold; font-size: 13px; cursor: pointer; }
        .tab-btn.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        #tab-ency { background: #221e1a; color: #d4a373; border-left: 1px solid var(--border); }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content { flex: 1; overflow-y: auto; padding: 15px; background: #111; position: relative; }
        .log-line { margin-bottom: 8px; font-size: 14px; color: #ccc; border-left: 2px solid var(--border); padding-left: 10px; line-height: 1.4; }
        
        /* ë„ê°(ë°±ê³¼ì‚¬ì „) ìŠ¤íƒ€ì¼ */
        .ency-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; background: #1a1a17; padding: 10px; border-radius: 8px; border: 1px solid var(--accent); }
        .progress-bar { height: 6px; background: #333; border-radius: 3px; flex: 1; margin: 0 15px; position: relative; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--accent); width: 0%; transition: 0.5s; }

        /* ê·¸ë¦¬ë“œ ì‹œìŠ¤í…œ */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .slot { background: #1c1c1a; padding: 12px; border-radius: 8px; border: 1px solid #333; font-size: 13px; position: relative; cursor: pointer; }
        .slot.selected { border-color: var(--accent); background: #2a2a22; }
        .slot.locked { opacity: 0.4; filter: grayscale(1); }
        .slot .desc { font-size: 11px; color: #888; margin-top: 4px; display: none; }
        .slot.selected .desc { display: block; }

        /* í•˜ë‹¨ ì•¡ì…˜ */
        footer { background: var(--panel); border-top: 1px solid var(--border); padding-bottom: env(safe-area-inset-bottom); flex-shrink: 0; }
        .action-container { max-height: 200px; overflow-y: auto; padding: 10px 15px; display: flex; flex-direction: column; gap: 8px; }
        .btn { background: var(--btn-bg); color: #fff; padding: 16px; border-radius: 10px; border: 1px solid #444; font-weight: bold; text-align: center; cursor: pointer; }
        .btn:active { background: var(--accent); color: #000; }

        /* ì´ˆê¸°í™” í™”ë©´ */
        #origin-screen { position: fixed; inset: 0; z-index: 5000; background: var(--bg); padding: 25px; overflow-y: auto; }
        .race-card { background: var(--panel); border: 1px solid var(--border); padding: 20px; border-radius: 15px; margin-bottom: 15px; }
    </style>
</head>
<body>

    <div id="origin-screen">
        <h2 style="text-align:center; color:var(--accent); margin-bottom:25px;">ì¢…ì¡±ì„ ì„ íƒí•˜ì—¬ ì—°ëŒ€ê¸°ë¥¼ ì‹œì‘í•˜ì‹­ì‹œì˜¤</h2>
        <div id="race-list"></div>
    </div>

    <div id="game-ui" style="display:none; flex-direction:column; height:100%;">
        <header>
            <div>Lv.<span id="ui-lv">1</span> <span id="ui-race" style="color:var(--accent)"></span></div>
            <div id="ui-gold">ğŸ’° 500G</div>
        </header>

        <div class="visual-area">
            <div id="loc-tag" class="location-tag">ë¯¸ì§€ì˜ ì¥ì†Œ</div>
            <img id="bg-img" src="">
        </div>

        <div class="tab-bar">
            <button class="tab-btn active" onclick="game.tab('log', this)">ë¡œê·¸</button>
            <button class="tab-btn" onclick="game.tab('inv', this)">ê°€ë°©</button>
            <button id="tab-ency" class="tab-btn" onclick="game.tab('ency', this)">ë°±ê³¼ì‚¬ì „</button>
        </div>

        <div id="pane-log" class="main-content"></div>

        <div id="pane-inv" class="main-content" style="display:none;">
            <div id="stat-info" style="margin-bottom:15px; font-size:13px; color:var(--accent)"></div>
            <div id="inv-list" class="grid"></div>
        </div>

        <div id="pane-ency" class="main-content" style="display:none;">
            <div class="ency-header">
                <span style="font-size:12px; color:var(--accent)">ë‹¬ì„±ë¥ </span>
                <div class="progress-bar"><div id="ency-progress" class="progress-fill"></div></div>
                <span id="ency-percent" style="font-size:12px;">0%</span>
            </div>
            <div style="display:flex; gap:5px; margin-bottom:15px;">
                <button class="btn" style="flex:1; padding:8px; font-size:11px;" onclick="game.renderEncy('items')">ì¥ë¹„</button>
                <button class="btn" style="flex:1; padding:8px; font-size:11px;" onclick="game.renderEncy('pets')">í«</button>
            </div>
            <div id="ency-list" class="grid"></div>
        </div>

        <footer>
            <div id="action-list" class="action-container"></div>
        </footer>
    </div>

<script>
// ë°ì´í„° ìƒì„± ë° ê´€ë¦¬
const DB = {
    races: [
        { id:'human', name:'ì¸ê°„', hp:100, str:10, agi:10, desc:'ëª¨ë“  ëŠ¥ë ¥ì¹˜ê°€ ê· í˜• ì¡íŒ ì¢…ì¡±ì…ë‹ˆë‹¤.' },
        { id:'elf', name:'ì—˜í”„', hp:80, str:7, agi:15, desc:'ë¯¼ì²©í•˜ê³  ì§€í˜œë¡­ì§€ë§Œ ì²´ë ¥ì´ ë‚®ìŠµë‹ˆë‹¤.' },
        { id:'orc', name:'ì˜¤í¬', hp:150, str:16, agi:5, desc:'ê°•ë ¥í•œ í˜ê³¼ ì²´ë ¥ì„ ì§€ë‹Œ ì „ì‚¬ë“¤ì…ë‹ˆë‹¤.' },
        { id:'beast', name:'ìˆ˜ì¸', hp:120, str:13, agi:12, desc:'ì•¼ìƒì˜ ë³¸ëŠ¥ìœ¼ë¡œ ë¹ ë¥¸ ë°˜ì‘ ì†ë„ë¥¼ ê°€ì§‘ë‹ˆë‹¤.' }
    ],
    locs: {
        forest: { n: "ì‹ ë¹„ë¡œìš´ ìˆ²", img: "https://image.lexica.art/full_webp/cc2057ae-e069-450f-a2e6-a94b595bb919" },
        village: { n: "ì•ˆì‹ì˜ ë§ˆì„", img: "https://image.lexica.art/full_webp/51351532-3580-4963-8a9d-b8733b1e967a" }
    },
    // 100ì¢… ì´ìƒì˜ ì¥ë¹„ ìë™ ìƒì„±
    items: Array.from({length: 105}, (_, i) => ({
        id: i,
        name: `${['ë‚¡ì€','ë‚ ì¹´ë¡œìš´','ì¶•ë³µë°›ì€','ì–´ë‘ ì˜','ë¹›ë‚˜ëŠ”','ì „ì„¤ì˜'][i%6]} ${['ê²€','ë°©íŒ¨','ì§€íŒ¡ì´','ë‹¨ê²€','ê°‘ì˜·','ë°˜ì§€'][i%6]} +${Math.floor(i/6)}`,
        stat: `ëŠ¥ë ¥ì¹˜ +${i+1}`,
        desc: `ì´ ì•„ì´í…œì€ ì—°ëŒ€ê¸°ì˜ ${i+1}ë²ˆì§¸ ê¸°ë¡ì— ë“±ì¥í•˜ëŠ” ìœ ë¬¼ì…ë‹ˆë‹¤.`,
        price: (i + 1) * 50
    })),
    // 20ì¢… ì´ìƒì˜ í« ìë™ ìƒì„±
    pets: Array.from({length: 22}, (_, i) => ({
        id: i,
        name: `${['ì•„ê¸°','ìš©ê°í•œ','ì‹ ë¹„í•œ','ê±°ëŒ€í•œ'][i%4]} ${['ëŠ‘ëŒ€','ê³ ì–‘ì´','ìš©','ìŠ¬ë¼ì„','ë¶€ì—‰ì´'][i%5]}`,
        stat: `ë³´ë„ˆìŠ¤ +${i*2}`,
        desc: `ë‹¹ì‹ ì˜ ê³ì„ ì§€í‚¤ëŠ” ${i+1}ë²ˆì§¸ ì¶©ì§í•œ ë™ë£Œì…ë‹ˆë‹¤.`,
        price: (i + 1) * 100
    })),
    // 50ê°€ì§€ ì´ìƒì˜ ì´ë²¤íŠ¸
    events: Array.from({length: 52}, (_, i) => `ì´ë²¤íŠ¸ #${i+1}: ${['ìƒì¸ì„ ë§Œë‚¬ìŠµë‹ˆë‹¤','ìœ ì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤','ëª¬ìŠ¤í„°ê°€ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤','í–‰ìš´ì˜ ë™ì „ì„ ì£¼ì› ìŠµë‹ˆë‹¤'][i%4]}`)
};

const game = {
    p: { race:null, day:1, lv:1, gold:500, hp:100, inv:[], foundItems:new Set(), foundPets:new Set() },
    selectedIdx: -1,

    init() {
        const list = document.getElementById('race-list');
        DB.races.forEach(r => {
            const d = document.createElement('div'); d.className = 'race-card';
            d.innerHTML = `<h3>${r.name}</h3><p style="font-size:12px; color:#aaa; margin-top:5px;">${r.desc}</p>`;
            d.onclick = () => { this.p.race = r; this.p.hp = r.hp; this.start(); };
            list.appendChild(d);
        });
    },

    start() {
        document.getElementById('origin-screen').style.display = 'none';
        document.getElementById('game-ui').style.display = 'flex';
        document.getElementById('ui-race').innerText = this.p.race.name;
        this.updateLoc('forest');
        this.renderActions();
        this.log("ëª¨í—˜ì˜ ì²« ì¥ì´ í¼ì³ì¡ŒìŠµë‹ˆë‹¤.");
    },

    tab(t, el) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        el.classList.add('active');
        ['log','inv','ency'].forEach(p => document.getElementById('pane-'+p).style.display = 'none');
        document.getElementById('pane-'+t).style.display = 'block';
        if(t === 'inv') this.renderInv();
        if(t === 'ency') this.renderEncy('items');
    },

    renderInv() {
        document.getElementById('stat-info').innerText = `â¤ï¸ HP: ${this.p.hp} | ğŸ’° ê³¨ë“œ: ${this.p.gold}G | Day: ${this.p.day}`;
        const list = document.getElementById('inv-list'); list.innerHTML = '';
        this.p.inv.forEach((it, i) => {
            const d = document.createElement('div'); d.className = `slot ${this.selectedIdx === i ? 'selected' : ''}`;
            d.innerHTML = `<b>${it.name}</b><br><small>${it.stat}</small><div class="desc">${it.desc}</div>`;
            d.onclick = () => { this.selectedIdx = (this.selectedIdx === i) ? -1 : i; this.renderInv(); };
            list.appendChild(d);
        });
    },

    renderEncy(type) {
        const list = document.getElementById('ency-list'); list.innerHTML = '';
        const dataArr = DB[type];
        const foundSet = type === 'items' ? this.p.foundItems : this.p.foundPets;
        
        // ë‹¬ì„±ë¥  ê³„ì‚°
        const percent = Math.floor((foundSet.size / dataArr.length) * 100);
        document.getElementById('ency-progress').style.width = percent + '%';
        document.getElementById('ency-percent').innerText = percent + '%';

        dataArr.forEach(obj => {
            const isFound = foundSet.has(obj.id);
            const d = document.createElement('div'); d.className = `slot ${isFound ? '' : 'locked'}`;
            d.innerHTML = isFound ? `<b>${obj.name}</b><br><small>${obj.stat}</small><div class="desc">${obj.desc}</div>` : `<b>???</b><br><small>ë¯¸íšë“</small>`;
            d.onclick = () => { if(isFound) d.classList.toggle('selected'); };
            list.appendChild(d);
        });
    },

    updateLoc(key) {
        this.loc = key;
        document.getElementById('loc-tag').innerText = DB.locs[key].n;
        document.getElementById('bg-img').src = DB.locs[key].img;
    },

    renderActions() {
        const area = document.getElementById('action-list'); area.innerHTML = '';
        if(this.loc === 'forest') {
            this.addBtn("ğŸ§­ ìˆ² ê¹Šì€ ê³³ íƒì‚¬", () => this.explore());
            this.addBtn("â›º íœ´ì‹ ë° ì •ë¹„", () => { this.p.hp += 20; this.nextDay(); this.log("íœ´ì‹ìœ¼ë¡œ ì²´ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤."); });
        } else {
            this.addBtn("ğŸ›ï¸ ìƒì  ì´ìš© (ë¬´ì‘ìœ„ íšë“)", () => this.shop());
            this.addBtn("ğŸ’° ì†Œì§€í’ˆ íŒë§¤", () => this.sell());
            this.addBtn("ğŸŒ² ë§ˆì„ ë– ë‚˜ê¸°", () => { this.updateLoc('forest'); this.renderActions(); });
        }
    },

    explore() {
        this.p.day++;
        if(Math.random() < 0.2) {
            this.updateLoc('village');
            this.log("ğŸ° ë§ˆì„ì— ë„ì°©í•˜ì—¬ ì§ì„ í’€ì—ˆìŠµë‹ˆë‹¤.");
        } else {
            const ev = DB.events[Math.floor(Math.random()*DB.events.length)];
            this.log(ev);
            if(Math.random() < 0.3) {
                const isItem = Math.random() > 0.5;
                const pool = isItem ? DB.items : DB.pets;
                const res = pool[Math.floor(Math.random()*pool.length)];
                this.gain(res, isItem ? 'items' : 'pets');
            }
        }
        this.renderActions();
    },

    shop() {
        if(this.p.gold >= 200) {
            this.p.gold -= 200;
            const isItem = Math.random() > 0.4;
            const pool = isItem ? DB.items : DB.pets;
            const res = pool[Math.floor(Math.random()*pool.length)];
            this.gain(res, isItem ? 'items' : 'pets');
            document.getElementById('ui-gold').innerText = `ğŸ’° ${this.p.gold}G`;
        } else { this.log("ê³¨ë“œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!"); }
    },

    gain(obj, type) {
        this.p.inv.push(obj);
        if(type === 'items') this.p.foundItems.add(obj.id);
        else this.p.foundPets.add(obj.id);
        this.log(`âœ¨ [${obj.name}]ì„(ë¥¼) íšë“í–ˆìŠµë‹ˆë‹¤! ë°±ê³¼ì‚¬ì „ì— ë“±ë¡ë©ë‹ˆë‹¤.`);
    },

    sell() {
        if(this.selectedIdx > -1) {
            const it = this.p.inv[this.selectedIdx];
            this.p.gold += Math.floor(it.price * 0.5);
            this.p.inv.splice(this.selectedIdx, 1);
            this.selectedIdx = -1;
            this.log(`${it.name}ì„(ë¥¼) íŒë§¤í–ˆìŠµë‹ˆë‹¤.`);
            document.getElementById('ui-gold').innerText = `ğŸ’° ${this.p.gold}G`;
            this.renderInv();
        }
    },

    nextDay() { this.p.day++; this.renderActions(); },
    log(m) {
        const p = document.getElementById('pane-log');
        const d = document.createElement('div'); d.className = 'log-line';
        d.innerText = `> ${m}`; p.prepend(d);
    },
    addBtn(t, f) {
        const b = document.createElement('div'); b.className = 'btn'; b.innerText = t; b.onclick = f;
        document.getElementById('action-list').appendChild(b);
    }
};

game.init();
</script>
</body>
</html>
