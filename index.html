<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Everbloom</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#2fc6b2">

<style>
/* ================= BASE ================= */
:root{
  --bg:#142c2a;
  --panel:rgba(40,90,84,.88);
  --stroke:rgba(140,220,205,.28);
  --txt:#eafffb;
  --muted:rgba(234,255,251,.65);
  --accent:#2fc6b2;
  --radius:18px;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",sans-serif;
  color:var(--txt);
  background:
    radial-gradient(800px 500px at 20% 10%, rgba(47,198,178,.25), transparent 60%),
    radial-gradient(800px 500px at 80% 20%, rgba(184,168,255,.18), transparent 60%),
    var(--bg);
  touch-action:manipulation;
}

/* ================= HEADER ================= */
header{
  padding:16px;
  font-size:22px;
  font-weight:900;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  padding:10px 14px;
  border-radius:14px;
  border:1px solid var(--stroke);
  background:rgba(255,255,255,.08);
  color:inherit;
  font-weight:800;
  touch-action:manipulation;
}
button:active{transform:translateY(1px)}

/* ================= LAYOUT ================= */
main{
  padding:16px;
  display:grid;
  gap:16px;
}
.panel{
  background:var(--panel);
  border:1px solid var(--stroke);
  border-radius:var(--radius);
  padding:14px;
  backdrop-filter: blur(14px);
}
.actions{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}
.action-btn{
  padding:14px;
  border-radius:14px;
  text-align:center;
  font-weight:900;
  background:rgba(47,198,178,.28);
  border:1px solid var(--stroke);
}

/* ================= SETTINGS SLIDE ================= */
#settings{
  position:fixed;
  left:0;right:0;bottom:0;
  height:90vh;
  background:rgba(20,50,48,.96);
  border-top-left-radius:22px;
  border-top-right-radius:22px;
  border:1px solid var(--stroke);
  transform:translateY(100%);
  transition:.35s ease;
  z-index:100;
  overflow-y:auto;
}
#settings.open{transform:translateY(0)}
#settings header{
  padding:14px;
  font-size:18px;
  display:flex;
  justify-content:space-between;
}

/* ================= CHAR STUDIO ================= */
#charStudio select,#charStudio input,#charStudio textarea{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.12);
  background:rgba(255,255,255,.04);
  color:inherit;
}
#csDot{
  width:220px;height:220px;
  image-rendering:pixelated;
  background:#0f0f14;
  border-radius:14px;
  display:block;margin:auto;
}
.csGrid{display:grid;grid-template-columns:220px 1fr;gap:12px}
@media(max-width:720px){.csGrid{grid-template-columns:1fr}}
.csMiniGrid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
@media(max-width:720px){.csMiniGrid{grid-template-columns:1fr}}
.csMiniBox{padding:10px;border-radius:12px;background:rgba(255,255,255,.04)}
#csIllust{width:260px;height:360px;object-fit:cover;border-radius:14px;background:#111}
@media(max-width:720px){#csIllust{width:100%;height:320px}}
</style>
</head>

<body>

<header>
  ğŸŒ¿ Everbloom
  <button id="openSettings">âš™ï¸</button>
</header>

<main>
  <section class="panel">
    <b>ğŸ“œ ì§„í–‰</b><br>
    <span id="log">ì‹œì‘ ì¤€ë¹„ ì™„ë£Œ.</span>
  </section>

  <section class="panel actions">
    <div class="action-btn" id="moveBtn">ğŸ—º ì´ë™</div>
    <div class="action-btn" id="exploreBtn">ğŸ” íƒí—˜</div>
    <div class="action-btn" id="eventBtn">ğŸ“– ì‚¬ê±´</div>
    <div class="action-btn" id="restBtn">ğŸ˜´ íœ´ì‹</div>
  </section>

  <section class="panel">
    <b>ğŸ¾ í«</b><br>
    <span id="petInfo">ì—†ìŒ</span>
  </section>

  <section class="panel">
    <b>ğŸ“Œ ìƒíƒœ</b><br>
    ìºë¦­í„° ì¤€ë¹„ë¨
  </section>
</main>

<!-- ================= SETTINGS ================= -->
<div id="settings">
  <header>
    âš™ï¸ ì„¤ì •
    <button id="closeSettings">ë‹«ê¸°</button>
  </header>

  <!-- CHAR STUDIO -->
  <section class="panel" id="charStudio">
    <b>ğŸƒ ìºë¦­í„° ìŠ¤íŠœë””ì˜¤</b>

    <div class="csGrid">
      <div>
        <canvas id="csDot" width="128" height="128"></canvas>
        <button id="dotReroll" style="width:100%;margin-top:8px">ë„íŠ¸ ë¦¬ë¡¤</button>
      </div>

      <div>
        <div class="csMiniGrid">
          <select id="job">
            <option>ëœë¤</option>
            <option>íŒŒì´í„°</option>
            <option>ë ˆì¸ì €</option>
            <option>ìœ„ì €ë“œ</option>
            <option>ë¡œê·¸</option>
          </select>
          <select id="weapon">
            <option>ëœë¤</option>
            <option>ì¹´íƒ€ë‚˜</option>
            <option>ë¡±ì†Œë“œ</option>
            <option>ê·¸ë ˆì´íŠ¸ì†Œë“œ</option>
            <option>ë ˆì´í”¼ì–´</option>
            <option>ëŒ€ê±°</option>
            <option>ì›Œí•´ë¨¸</option>
            <option>ë©”ì´ìŠ¤</option>
            <option>ì§€íŒ¡ì´</option>
            <option>í¬ë¡œìŠ¤ë³´ìš°</option>
          </select>
        </div>

        <input id="name" placeholder="ì´ë¦„(ì„ íƒ)" style="margin-top:8px">
        <button id="genChar" style="margin-top:8px;width:100%">ì¹´ë“œ ìƒì„±</button>

        <textarea id="prompt" rows="4" style="margin-top:8px"></textarea>
        <button id="copyPrompt" style="margin-top:6px;width:100%">í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
      </div>
    </div>

    <div style="margin-top:14px;display:flex;gap:12px;flex-wrap:wrap">
      <img id="csIllust">
      <div>
        <b id="cardTitle">ì´ë¦„ ë¯¸ì •</b><br>
        <span id="cardLine"></span>
        <div class="csMiniBox" style="margin-top:8px">
          <span id="bio"></span>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
/* ================= UTIL ================= */
const $=id=>document.getElementById(id);
const rand=a=>a[Math.floor(Math.random()*a.length)];

/* ================= SETTINGS ================= */
$("openSettings").onclick=()=>settings.classList.add("open");
$("closeSettings").onclick=()=>settings.classList.remove("open");

/* ================= HUB ================= */
$("moveBtn").onclick=()=>log("ì´ë™í–ˆë‹¤.");
$("exploreBtn").onclick=()=>log("íƒí—˜ ì¤‘...");
$("eventBtn").onclick=()=>log("ì‚¬ê±´ ë°œìƒ.");
$("restBtn").onclick=()=>log("íœ´ì‹í–ˆë‹¤.");
function log(t){$("log").textContent=t}

/* ================= CHAR STUDIO ================= */
const ctx=$("csDot").getContext("2d");
function drawDot(){
  ctx.clearRect(0,0,128,128);
  ctx.fillStyle="#0f0f14";ctx.fillRect(0,0,128,128);
  ctx.fillStyle=["#f1c7a3","#d99f7d","#c78866"][Math.floor(Math.random()*3)];
  ctx.fillRect(44,28,40,40);
  ctx.fillStyle="#222";
  ctx.fillRect(56,46,6,6);ctx.fillRect(66,46,6,6);
  ctx.fillStyle="#333";
  ctx.fillRect(44,70,40,38);
}
drawDot();
$("dotReroll").onclick=drawDot;

$("genChar").onclick=()=>{
  const name=$("name").value||"ì´ë¦„ ë¯¸ì •";
  $("cardTitle").textContent=name;
  $("cardLine").textContent=$("job").value+" Â· "+$("weapon").value;
  $("bio").textContent=rand([
    "ìˆ²ê³¼ ìœ ì  ì‚¬ì´ë¥¼ ë– ë„ëŠ” ì—¬í–‰ì.",
    "ê³ ëŒ€ ìœ ë¬¼ì˜ ë¶€ë¦„ì„ ë“£ëŠ”ë‹¤.",
    "ì—ë²„ë¸”ë£¸ì˜ ìˆ¨ê²°ì„ ëŠë‚€ë‹¤."
  ]);
  $("prompt").value=[
    "Japanese anime style","fantasy character",
    $("job").value,$("weapon").value,
    "forest ruins","no text"
  ].join(", ");
};

/* ================= PET ================= */
let pet={species:"beast",stage:1,aff:0};
function renderPet(){
  $("petInfo").textContent=`${pet.species} | ë‹¨ê³„ ${pet.stage} | í˜¸ê° ${pet.aff}`;
}
renderPet();

  /* ===============================
   CHAR STUDIO DOT ENGINE (FIX)
   =============================== */

const csDot = document.getElementById("csDot");
const csCtx = csDot.getContext("2d");

let csSeed = Math.floor(Math.random() * 1e9);

/* seeded RNG */
function csRand(){
  csSeed ^= csSeed << 13;
  csSeed ^= csSeed >> 17;
  csSeed ^= csSeed << 5;
  return Math.abs(csSeed) / 0xffffffff;
}

function drawDot(){
  const S = csDot.width; // 192
  const r = csRand;

  // palette
  const skin = r() > 0.5 ? "#e6b899" : "#d9a57c";
  const hair = ["#1c1c28","#3b2a1a","#6b4b2a","#c8c8d8"][Math.floor(r()*4)];
  const cloth= ["#2a3f3a","#2f2a3a","#3a2a2f","#3a3a3a"][Math.floor(r()*4)];
  const eye  = ["#9ad5ff","#9affc3","#ffd59a","#c5b3ff"][Math.floor(r()*4)];

  csCtx.clearRect(0,0,S,S);

  // background
  csCtx.fillStyle = "#0f1218";
  csCtx.fillRect(0,0,S,S);

  // head
  csCtx.fillStyle = skin;
  csCtx.fillRect(64,40,64,64);

  // hair
  csCtx.fillStyle = hair;
  csCtx.fillRect(64,30,64,24);
  csCtx.fillRect(56,40,80,16);

  // eyes
  csCtx.fillStyle = "#111";
  csCtx.fillRect(82,72,8,8);
  csCtx.fillRect(102,72,8,8);
  csCtx.fillStyle = eye;
  csCtx.fillRect(84,74,4,4);
  csCtx.fillRect(104,74,4,4);

  // mouth
  csCtx.fillStyle = "#2a1e1e";
  csCtx.fillRect(92,96,8,2);

  // body
  csCtx.fillStyle = cloth;
  csCtx.fillRect(72,112,48,48);

  // arms
  csCtx.fillRect(56,116,16,40);
  csCtx.fillRect(120,116,16,40);

  // legs
  csCtx.fillStyle = "#1a1a24";
  csCtx.fillRect(80,160,16,24);
  csCtx.fillRect(96,160,16,24);
}

/* ====== EVENTS ====== */

// ë„íŠ¸ ë¦¬ë¡¤ ë²„íŠ¼
const rerollBtn = document.getElementById("dotReroll");
if(rerollBtn){
  rerollBtn.addEventListener("pointerup", () => {
    csSeed = Math.floor(Math.random() * 1e9);
    drawDot();
  });
}

// ìµœì´ˆ 1íšŒ ê·¸ë¦¬ê¸°
drawDot();

/* ================= COPY ================= */
$("copyPrompt").onclick=async()=>{
  try{await navigator.clipboard.writeText($("prompt").value);alert("ë³µì‚¬ë¨")}
  catch{alert("ê¸¸ê²Œ ëˆŒëŸ¬ ë³µì‚¬")}
};
</script>

</body>
</html>
