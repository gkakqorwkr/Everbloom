<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Everbloom Fantasy</title>

<style>
:root{
    --dark:#121212;
    --panel:#2a2a2a;
    --border:#444;
    --accent:#caa24d;
    --text:#e0e0e0;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
body{
    background:var(--dark);
    color:var(--text);
    height:100vh;
    overflow:hidden;
    font-family:system-ui, sans-serif;
}

/* SPLASH */
#splash{
    position:fixed; inset:0; z-index:10;
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    background:#000;
}
.start-hint{margin-top:40vh; animation:blink 1.5s infinite;}
@keyframes blink{50%{opacity:.4}}

/* GAME */
#game{
    display:none;
    height:100%;
    padding:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
}

/* VISUAL */
.visual-frame{
    height:34vh;
    background:#000;
    border:2px solid var(--border);
    border-radius:12px;
    display:flex;
    align-items:center;
    justify-content:center;
}
canvas{
    width:100%;
    height:100%;
    image-rendering:pixelated;
}

/* LOG */
.log-frame{
    flex:1;
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:12px;
    padding:12px;
    overflow-y:auto;
    font-size:.95rem;
}
.log-item{margin-bottom:6px; color:#aaa;}
.log-item.new{color:var(--accent); font-weight:bold;}

/* CONTROL */
.control-frame{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:12px;
    padding:12px;
}
.status{
    display:flex;
    justify-content:space-between;
    font-size:.8rem;
    margin-bottom:6px;
}
.bar-bg{
    height:8px;
    background:#111;
    border-radius:4px;
    overflow:hidden;
}
.bar-fill{
    height:100%;
    background:var(--accent);
    transition:.3s;
}
.btn-grid{
    margin-top:10px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:8px;
}
button{
    background:#3d3d3d;
    border:1px solid #555;
    color:#fff;
    padding:14px;
    border-radius:10px;
    font-weight:bold;
}
button:active{background:#555;}
</style>
</head>

<body onclick="init()">

<div id="splash">
    <h1>EVERBLOOM</h1>
    <div class="start-hint">TOUCH TO START</div>
</div>

<div id="game">

    <div class="visual-frame">
        <canvas id="gameCanvas" width="320" height="240"></canvas>
    </div>

    <div class="log-frame" id="logBox">
        <div class="log-item new">ì—ë²„ë¸”ë£¸ì˜ ê³ ëŒ€ ìˆ²ì— ë“¤ì–´ì„°ìŠµë‹ˆë‹¤.</div>
    </div>

    <div class="control-frame">
        <div class="status">
            <span>í„´ <b id="turn">1</b></span>
            <span>HP <b id="hp">100</b></span>
        </div>
        <div class="bar-bg">
            <div id="hpBar" class="bar-fill" style="width:100%"></div>
        </div>

        <div class="btn-grid">
            <button onclick="act('explore')">ğŸ” íƒí—˜</button>
            <button onclick="act('town')">ğŸ¡ ë§ˆì„</button>
            <button onclick="act('battle')">âš”ï¸ ì‚¬ê±´</button>
            <button onclick="act('pet')">ğŸ¾ êµê°</button>
        </div>
    </div>

</div>

<script>
/* ===== STATE ===== */
let started=false;
let turn=1;
let hp=100;
let enemyHp=0;
let inBattle=false;

const canvas=document.getElementById("gameCanvas");
const ctx=canvas.getContext("2d");
ctx.imageSmoothingEnabled=false;

/* ===== UTIL ===== */
function px(x,y,c){
    ctx.fillStyle=c;
    ctx.fillRect(x,y,1,1);
}
function log(msg,newFlag=false){
    const d=document.createElement("div");
    d.className="log-item"+(newFlag?" new":"");
    d.innerText="> "+msg;
    document.getElementById("logBox").prepend(d);
}

/* ===== DRAW ===== */
function drawForest(){
    for(let y=0;y<240;y++){
        for(let x=0;x<320;x++){
            px(x,y,Math.random()>.5?"#1b4332":"#163a2b");
        }
    }
    for(let y=200;y<240;y++)
        for(let x=0;x<320;x++)
            px(x,y,"#0b1d14");
}

function drawHero(x,y){
    const skin="#d7b38c", cloth="#7c2f2f", dark="#1b1b1b";
    for(let i=0;i<10;i++) for(let j=0;j<10;j++) px(x+i,y+j,skin);
    px(x+3,y+4,dark); px(x+6,y+4,dark);
    for(let i=0;i<12;i++) for(let j=0;j<14;j++) px(x-1+i,y+10+j,cloth);
}

function drawOrc(x,y){
    const g="#4a7c44", d="#1b1b1b";
    for(let i=0;i<16;i++) for(let j=0;j<16;j++) px(x+i,y+j,g);
    px(x+4,y+6,"red"); px(x+10,y+6,"red");
    px(x+3,y+12,d); px(x+12,y+12,d);
}

function render(){
    ctx.clearRect(0,0,320,240);
    drawForest();
    drawHero(140,110);
    if(inBattle) drawOrc(220,120);
}

/* ===== GAME LOGIC ===== */
function act(type){
    if(!started) return;

    turn++;
    document.getElementById("turn").innerText=turn;

    if(type==="explore"){
        inBattle=false;
        log("ìˆ²ì„ íƒí—˜í•˜ë©° ì˜¤ë˜ëœ ìœ ì ì„ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.",true);
    }

    if(type==="town"){
        inBattle=false;
        hp=Math.min(100,hp+25);
        log("ë§ˆì„ì—ì„œ íœ´ì‹ì„ ì·¨í•´ ì²´ë ¥ì„ íšŒë³µí–ˆìŠµë‹ˆë‹¤.");
    }

    if(type==="pet"){
        inBattle=false;
        log("í«ê³¼ êµê°í–ˆìŠµë‹ˆë‹¤. ë§ˆìŒì´ ì•ˆì •ë©ë‹ˆë‹¤.");
    }

    if(type==="battle"){
        if(!inBattle){
            enemyHp=30;
            inBattle=true;
            log("ì•¼ìƒ ì˜¤í¬ê°€ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤!",true);
        }else{
            enemyHp-=15;
            hp-=10;
            log("ì˜¤í¬ì™€ ê²©ë ¬í•œ ì „íˆ¬ë¥¼ ë²Œì˜€ìŠµë‹ˆë‹¤!",true);
            if(enemyHp<=0){
                inBattle=false;
                log("ì˜¤í¬ë¥¼ ì“°ëŸ¬ëœ¨ë ¸ìŠµë‹ˆë‹¤!");
            }
        }
    }

    hp=Math.max(0,hp);
    document.getElementById("hp").innerText=hp;
    document.getElementById("hpBar").style.width=hp+"%";

    render();
}

function init(){
    if(started) return;
    started=true;
    document.getElementById("splash").style.display="none";
    document.getElementById("game").style.display="flex";
    render();
}
</script>

</body>
</html>
